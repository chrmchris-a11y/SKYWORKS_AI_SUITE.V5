<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="missionPlanner.title">Skyworks Mission Planner (Phase 4 - Step 38)</title>
  
  <!-- i18n Scripts -->
  <script src="../i18n/i18n-loader.js?v=20251025-FINAL" onerror="console.error('Failed to load i18n-loader.js')"></script>
  <script src="../i18n/language-switcher.js?v=20251025" onerror="console.error('Failed to load language-switcher.js')"></script>
  
  <!-- Phase 4-5: PDRA/STS & OSO Components -->
  <script src="category-handler.js?v=20251025"></script>
  <script src="oso-manager-v2.js?v=20251025"></script>
  <script src="oso-ui-v2.js?v=20251025"></script>
  <script src="test-mission-loader.js?v=20251025"></script>
  <!-- Authoritative SAIL calculator (frontend JS) -->
  <script src="../assets/js/sail-calculator.js?v=20251025" onerror="console.error('Failed to load sail-calculator.js')"></script>
  <!-- SORA 2.5 ARC validation (added by Sonnet 4 - PROMPT 2) -->
  <script src="arc25-validation.js?v=20251030" onerror="console.error('Failed to load arc25-validation.js')"></script>
  
  <script>
    console.log('[mission.html] Scripts loaded, checking for window.i18n...');
    setTimeout(() => {
      if (typeof window.i18n === 'undefined') {
        console.error('[mission.html] window.i18n is NOT defined after 1 second!');
      } else {
        console.log('[mission.html] window.i18n is defined correctly');
        
        // Create debug panel
        const debugPanel = document.createElement('div');
        debugPanel.id = 'i18nDebugPanel';
        debugPanel.style.cssText = 'position:fixed;top:10px;right:10px;background:#fff;border:3px solid #f00;padding:10px;z-index:9999;max-width:400px;font-size:11px;box-shadow:0 4px 12px rgba(0,0,0,0.3);';
        
        const keys = Object.keys(window.i18n.translations || {});
        const hasMissionPlanner = window.i18n.translations?.missionPlanner;
        const hasCategory = window.i18n.translations?.missionPlanner?.category;
        const sora25value = window.i18n.translations?.missionPlanner?.category?.['SORA-2.5'];
        
        debugPanel.innerHTML = `
          <h3 style="margin:0 0 8px;color:#f00;">ğŸ” i18n Debug Info</h3>
          <div><strong>Translations loaded:</strong> ${keys.length > 0 ? 'YES âœ…' : 'NO âŒ'}</div>
          <div><strong>Top-level keys:</strong> ${keys.join(', ')}</div>
          <div><strong>missionPlanner exists:</strong> ${hasMissionPlanner ? 'YES âœ…' : 'NO âŒ'}</div>
          <div><strong>category exists:</strong> ${hasCategory ? 'YES âœ…' : 'NO âŒ'}</div>
          <div><strong>SORA-2.5 value:</strong> "${sora25value || 'UNDEFINED'}"</div>
          <div style="margin-top:8px;padding-top:8px;border-top:1px solid #ccc;">
            <strong>t() test:</strong> "${window.i18n.t('missionPlanner.category.SORA-2.5')}"
          </div>
          <button onclick="this.parentElement.remove()" style="margin-top:8px;padding:4px 8px;background:#f00;color:#fff;border:none;cursor:pointer;">Close</button>
        `;
        
        document.body.appendChild(debugPanel);
      }
    }, 1000);
  </script>
  
  <style>
    body { font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; margin: 16px; }
    h1 { margin: 0 0 8px; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .header h1 { margin: 0; }
    fieldset { border: 1px solid #ccc; padding: 12px; margin-bottom: 12px; }
    legend { font-weight: 600; }
    label { display:block; margin-top: 8px; }
    input, select, textarea { width: 100%; padding: 6px; margin-top: 4px; box-sizing: border-box; }
    .row { display:flex; gap:12px; }
    .col { flex:1; }
    button { padding: 8px 12px; cursor: pointer; }
    .ok { color: #0a7; }
    .bad { color: #c00; }
    pre { background: #f6f8fa; padding: 8px; overflow:auto; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    .pill { display:inline-block; padding:4px 12px; border-radius:16px; background:#e3f2fd; border:1px solid #90caf9; font-weight:600; color:#1976d2; }
    .result-box { background:#f8f9fa; border:1px solid #dee2e6; border-radius:8px; padding:12px; margin:8px 0; }
    .result-box strong { color:#495057; font-size:14px; display:block; margin-bottom:4px; }
    .result-box .pill { margin-top:4px; font-size:16px; }
    
    /* Loading Spinner */
    .spinner { display:inline-block; width:16px; height:16px; border:3px solid rgba(13,71,161,0.3); border-top-color:#0d47a1; border-radius:50%; animation:spin 0.8s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
    
    /* Enhanced Button Styling */
    #runBtn:hover:not(:disabled) {
      background: linear-gradient(135deg,#1976d2,#0d47a1) !important;
      box-shadow: 0 4px 8px rgba(33,150,243,0.5) !important;
      transform: translateY(-1px);
    }
    #runBtn:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(33,150,243,0.3) !important;
    }
    
    /* Enhanced Info Field Styling */
    .info:hover {
      transform: translateX(2px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.15) !important;
    }
    
    /* Error Message Styling */
    .error-message { background:#ffebee; border-left:4px solid #f44336; padding:12px; margin:8px 0; border-radius:6px; color:#c62828; }
    .error-message strong { display:block; margin-bottom:4px; }
    .error-message ul { margin:8px 0; padding-left:20px; }
    
    /* Responsive Design for Mobile */
    @media (max-width: 768px) {
      body { margin: 8px; }
      .header { flex-direction: column; align-items: flex-start; gap: 8px; }
      .header-right { flex-direction: column; width: 100%; }
      .grid { grid-template-columns: 1fr; }
      .row { flex-direction: column; gap: 8px; }
      #liveClock { min-width: auto; width: 100%; text-align: left; }
      #companyLogo { height: 36px; }
    }
    
    /* Accessibility - Focus Styles */
    button:focus, select:focus, input:focus, textarea:focus {
      outline: 2px solid #0d6efd;
      outline-offset: 2px;
    }
    
    /* High Contrast Mode Support */
    @media (prefers-contrast: high) {
      .result-box { border-width: 2px; }
      button { border: 2px solid currentColor; }
    }

    /* SORA 2.5 ARC Fields Styling - Added by Sonnet 4 */
    /* Hover effects for checkboxes */
    #arc25Fields label:has(input[type="checkbox"]):hover {
      background: #f0f0f0 !important;
    }

    /* Focus styles for accessibility */
    #arc25Fields input[type="checkbox"]:focus {
      outline: 2px solid #2196f3;
      outline-offset: 2px;
    }

    #arc25Fields select:focus {
      outline: 2px solid #2196f3;
      outline-offset: 1px;
      border-color: #2196f3;
    }

    /* Smooth transitions */
    #arc25Fields label:has(input[type="checkbox"]) {
      transition: background 0.2s ease;
    }
  </style>
</head>
<body>
  <div class="header" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
    <h1 class="brand-title" data-i18n="missionPlanner.title" style="margin:0; font-weight:800; letter-spacing:0.3px; color:#0d47a1;">
      Skyworks SORA Planner
    </h1>
    <div class="header-right" style="display:flex; align-items:center; gap:12px;">
      <div id="languageSwitcher"></div>
  <img id="companyLogo" src="../assets/skyworks-logo.png" alt="Skyworks" style="height:48px; width:auto; object-fit:contain; border-radius:8px; border:1px solid #e0e0e0; background:#ffffff;" onerror="this.style.display='none'" />
  <div id="liveClock" class="live-clock" style="min-width:200px; text-align:right; color:#0d47a1; font-weight:700; padding:6px 10px; border:1px solid #bbdefb; border-radius:8px; background:linear-gradient(180deg,#e3f2fd, #ffffff); box-shadow:0 1px 2px rgb(13 71 161 / 10%);"></div>
    </div>
  </div>
  <p data-i18n="missionPlanner.description">Submit SORA 2.0/2.5 inputs and inspect the full pipeline result (GRC â†’ ARC â†’ SAIL â†’ TMPR â†’ OSO â†’ Risk).</p>

  <fieldset>
    <legend data-i18n="missionPlanner.mission.title">Mission</legend>
    
    <!-- Test Mission Loader Container -->
    <div id="testMissionContainer" style="display:none; margin-bottom:16px; padding:12px; background:#fff9e6; border:1px solid #ffe082; border-radius:4px;">
      <!-- Populated by test-mission-loader.js -->
    </div>
    
    <div class="row">
      <div class="col">
        <label><span data-i18n="missionPlanner.mission.operationCategory">Operation Category</span>
          <select id="operationCategory" onchange="onCategoryChanged(this.value)">
            <option value="SORA-2.5" data-i18n="category">SORA 2.5 (JARUS Latest Version)</option>
            <option value="SORA-2.0" data-i18n="category">SORA 2.0 (Legacy AMC)</option>
            <option value="STS-01" data-i18n="category">STS-01 - VLOS over controlled ground</option>
            <option value="STS-02" data-i18n="category">STS-02 - BVLOS with airspace observers</option>
            <option value="PDRA-S01" data-i18n="category">PDRA-S01 - VLOS (custom UAS)</option>
            <option value="PDRA-S02" data-i18n="category">PDRA-S02 - BVLOS (custom UAS)</option>
            <option value="PDRA-G01" data-i18n="category">PDRA-G01 - Aerial survey BVLOS</option>
            <option value="PDRA-G02" data-i18n="category">PDRA-G02 - Aerial survey BVLOS extended</option>
            <option value="PDRA-G03" data-i18n="category">PDRA-G03 - BVLOS low altitude</option>
          </select>
        </label>
      </div>
      
      <!-- Live SAIL Result (Client-side preview using authoritative JS) -->
      <fieldset id="sailLive" style="margin-top:12px; background:#f8f9ff; border:2px solid #4a6cff; border-radius:8px;">
        <legend style="color:#1a237e; font-weight:800;">ğŸ§® SAIL â€” Live Breakdown (Preview)</legend>
        <div class="grid">
          <div class="result-box">
            <strong>Initial GRC (iGRC)</strong>
            <span id="sail_iGRC" class="pill">-</span>
          </div>
          <div class="result-box">
            <strong>Initial ARC</strong>
            <span id="sail_initialARC" class="pill">-</span>
          </div>
          <div class="result-box">
            <strong>Final GRC</strong>
            <span id="sail_finalGRC" class="pill">-</span>
          </div>
          <div class="result-box">
            <strong>Residual ARC</strong>
            <span id="sail_residualARC" class="pill">-</span>
          </div>
          <div class="result-box" style="grid-column: 1 / -1;">
            <strong>SAIL</strong>
            <span id="sail_level" class="pill" style="background:#e8f5e9;border-color:#66bb6a;color:#1b5e20;">-</span>
          </div>
        </div>
        <div id="sail_steps" style="margin-top:8px; padding:10px; background:#eef2ff; border:1px solid #c5cae9; border-radius:6px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:13px; white-space:pre-wrap;"></div>
        <div id="sail_warnings" style="margin-top:8px;"></div>
      </fieldset>
    </div>
    
    
    <!-- Drone selection (affects parameters if picked) -->
    <fieldset id="droneSelection" style="margin-top:12px; background:#fff9e6; border:2px solid #ff9800;">
      <legend style="color:#e65100; font-weight:700;">ğŸš Drone Selection</legend>
      <div class="grid">
        <div>
          <label>Drone Model
            <select id="droneModel">
              <option value="">âš™ï¸ Manual Input (Other)</option>
              <!-- Populated from /api/drones/dropdown -->
            </select>
          </label>
          <div style="font-size:12px; color:#666; margin-top:4px;">
            <span data-i18n="guides.droneSelection.help">ğŸ’¡ Select your drone model. MTOM, Max Speed, and Kinetic Energy fields will be automatically populated.</span>
          </div>
        </div>
        <div id="droneInfo" style="display:none;">
          <div class="row">
            <div class="col">
              <strong>Manufacturer:</strong> <span id="droneManufacturer">-</span>
            </div>
            <div class="col">
              <strong>Class:</strong> <span id="droneCClass">-</span>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <strong>MTOM (kg):</strong> <span id="droneMTOM">-</span>
            </div>
            <div class="col">
              <strong>Max Dimension (m):</strong> <span id="droneCharDim">-</span>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <strong>Max Speed (m/s):</strong> <span id="droneMaxSpeed">-</span>
            </div>
            <div class="col">
              <strong>KE (J):</strong> <span id="droneKE">-</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Manual Drone Specifications Override (for custom drones) -->
      <details style="margin-top:12px;">
        <summary style="cursor:pointer; color:#1976d2; font-weight:600;">âš™ï¸ Manual Drone Specifications (Custom/Override)</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #2196f3;">
          <div class="grid">
            <div>
              <label><strong>Max Dimension (m)</strong>
                <span class="help-icon" title="Maximum characteristic dimension: wingspan (fixed-wing), rotor diameter (rotorcraft), or max diagonal (multicopter)">?</span>
                <input id="maxDimensionManual" type="number" min="0.1" max="50" step="0.1" placeholder="Auto from drone model" onchange="updateiGRC()" />
              </label>
              <div style="font-size:11px; color:#666; margin-top:4px;">
                ğŸ“ For rotorcraft: blade diameter<br>
                ğŸ“ For fixed wing: wingspan<br>
                ğŸ“ For multicopters: max dimension
              </div>
            </div>
            <div>
              <label><strong>Cruise Speed (m/s)</strong>
                <span class="help-icon" title="Typical cruise speed in meters per second (affects SORA 2.5 dimension category)">?</span>
                <input id="cruiseSpeedManual" type="number" min="1" max="200" step="1" placeholder="Auto from drone model" onchange="updateiGRC()" />
              </label>
              <div style="font-size:11px; color:#666; margin-top:4px;">
                ğŸš€ Small: &lt;25 m/s (90 km/h)<br>
                ğŸš€ Medium: 25-35 m/s (126 km/h)<br>
                ğŸš€ Large: &gt;35 m/s (126+ km/h)
              </div>
            </div>
          </div>
          <div style="background:#fff3e0; padding:8px; border-radius:4px; margin-top:8px; border-left:4px solid #ff9800;">
            <strong style="color:#e65100;">ğŸ’¡ Note:</strong> If drone model is selected, these values auto-populate. 
            Manual override only needed for custom drones not in catalog.
          </div>
        </div>
      </details>
      
      <details style="margin-top:12px;">
        <summary style="cursor:pointer; color:#e65100; font-weight:600;">ğŸ“š Î¤Î¹ ÎµÏ€Î·ÏÎµÎ¬Î¶ÎµÎ¹ Ï„Î¿ Drone ÏƒÏ„Î¿Ï…Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿ÏÏ‚;</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #ff9800;">
          <strong style="color:#e65100;">Kinetic Energy (KE)</strong> = 0.5 Ã— MTOM(kg) Ã— MaxSpeedÂ²(m/s)<br><br>
          <strong>Î ÏÏ‚ ÎµÏ€Î·ÏÎµÎ¬Î¶ÎµÎ¹ Ï„Î¿ GRC (Ground Risk Class):</strong><br>
          â€¢ <strong>KE < 700J</strong>: Î§Î±Î¼Î·Î»ÏŒ ÎºÎ¯Î½Î´Ï…Î½Î¿ (1m class)<br>
          â€¢ <strong>700J â‰¤ KE < 34KJ</strong>: ÎœÎµÏƒÎ±Î¯Î¿ ÎºÎ¯Î½Î´Ï…Î½Î¿ (3m class)<br>
          â€¢ <strong>34KJ â‰¤ KE < 1084KJ</strong>: Î¥ÏˆÎ·Î»ÏŒ ÎºÎ¯Î½Î´Ï…Î½Î¿ (8m class)<br>
          â€¢ <strong>KE â‰¥ 1084KJ</strong>: Î Î¿Î»Ï Ï…ÏˆÎ·Î»ÏŒ ÎºÎ¯Î½Î´Ï…Î½Î¿ (>8m class)<br><br>
          <em style="color:#666; font-size:12px;">ÎŒÏƒÎ¿ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ Ï„Î¿ KE, Ï„ÏŒÏƒÎ¿ Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ Ï„Î¿ initial GRC ÎºÎ±Î¹ Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿Î¹ mitigations.</em>
        </div>
      </details>
      
      <!-- Live iGRC & ARC Display -->
      <div class="grid" style="margin-top:12px;">
        <div style="background:#e3f2fd; padding:16px; border-radius:8px; border:2px solid #1976d2; text-align:center;">
          <strong style="color:#0d47a1; display:block; margin-bottom:8px;">ğŸ“Š Intrinsic GRC (iGRC)</strong>
          <div id="iGRCDisplay" style="font-size:24px; font-weight:700; color:#1976d2;">
            Select drone & population
          </div>
          <div style="font-size:11px; color:#666; margin-top:6px;">
            Auto-calculated from SORA 2.5 Table 2<br>
            (UA specs + population density)
          </div>
        </div>
        <div style="background:#f3e5f5; padding:16px; border-radius:8px; border:2px solid #9c27b0; text-align:center;">
          <strong style="color:#6a1b9a; display:block; margin-bottom:8px;">âœˆï¸ Air Risk Class (ARC)</strong>
          <div id="arcDisplay" style="font-size:24px; font-weight:700; color:#7b1fa2;">
            Select airspace & environment
          </div>
          <div style="font-size:11px; color:#666; margin-top:6px;">
            Auto-updated from SORA 2.5 Step #4<br>
            (Airspace class + environment + typicality)
          </div>
        </div>
      </div>
    </fieldset>
    </div>

    <!-- Î•Ï€ÎµÎ¾Î·Î³Î®ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Dropdowns - Î‘ÎºÏÎ¹Î²ÏÏ‚ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Drone -->
    <fieldset style="background:#e8f5e9; border:2px solid #4caf50; margin-top:12px;">
      <legend style="color:#2e7d32; font-weight:700;" data-i18n="guides.title">ğŸ“š Dropdown & Field Guide</legend>
      
      <!-- Language warning for English users -->
      <div id="guideLanguageWarning" style="display:none; background:#fff3cd; border:2px solid #ffc107; padding:12px; margin-bottom:12px; border-radius:6px;">
        <strong>â„¹ï¸ Note:</strong> Guide content is currently available in <strong>Greek only</strong>. English translation is in progress. Switch to Greek (ğŸ‡¬ğŸ‡· Î•Î»Î»Î·Î½Î¹ÎºÎ¬) using the language selector above for full guide content.
      </div>
      
      <details open style="margin-bottom:8px;">
        <summary style="cursor:pointer; color:#1b5e20; font-weight:600; background:#c8e6c9; padding:8px; border-radius:4px;" data-i18n="guides.mitigations.title">ğŸ”§ Mitigations (Risk Mitigations) - HOW TO CHOOSE?</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #4caf50;">
          <strong style="color:#1b5e20;">SORA 2.0:</strong><br>
          â€¢ <strong>M1 (Strategic - Î£Ï„ÏÎ±Ï„Î·Î³Î¹ÎºÏŒÏ‚)</strong>:<br>
            &nbsp;&nbsp;- <strong>None (0)</strong>: ÎšÎ±Î¼Î¯Î± Î¼ÎµÎ¯Ï‰ÏƒÎ· Î±Î½Î¸ÏÏÏ€Ï‰Î½ ÏƒÎµ ÎºÎ¯Î½Î´Ï…Î½Î¿<br>
            &nbsp;&nbsp;- <strong>Low (-1)</strong>: Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î¼ÎµÎ¯Ï‰ÏƒÎ· (Ï€.Ï‡. ÏƒÎ®Î¼Î±Î½ÏƒÎ· Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚)<br>
            &nbsp;&nbsp;- <strong>Medium (-2)</strong>: ÎœÎ­Ï„ÏÎ¹Î± Î¼ÎµÎ¯Ï‰ÏƒÎ· (Ï€.Ï‡. Ï€ÏÎ¿ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚, Ï€ÎµÏÎ¯Ï†ÏÎ±Î¾Î·)<br>
            &nbsp;&nbsp;- <strong>High (-4)</strong>: Î¥ÏˆÎ·Î»Î® Î¼ÎµÎ¯Ï‰ÏƒÎ· (Ï€.Ï‡. Ï€Î»Î®ÏÎ·Ï‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚, ÎºÎ»ÎµÎ¹ÏƒÏ„ÏŒÏ‚ Ï‡ÏÏÎ¿Ï‚)<br>
            &nbsp;&nbsp;ğŸ“Œ <em>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ ÎµÎ»Î­Î³Ï‡Î¿Ï… Ï„Î·Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚ Ï€Ï„Î®ÏƒÎ·Ï‚</em><br><br>
          â€¢ <strong>M2 (Impact Reduction - ÎœÎµÎ¯Ï‰ÏƒÎ· Î”Ï…Î½Î±Î¼Î¹ÎºÎ®Ï‚ Î ÏÏŒÏƒÎºÏÎ¿Ï…ÏƒÎ·Ï‚)</strong>:<br>
            &nbsp;&nbsp;- <strong>None (0)</strong>: ÎšÎ±Î¼Î¯Î± Î¼ÎµÎ¯Ï‰ÏƒÎ· Î´Ï…Î½Î±Î¼Î¹ÎºÎ®Ï‚<br>
            &nbsp;&nbsp;- <strong>Medium (-1)</strong>: ÎœÎ­Ï„ÏÎ¹Î± Î¼ÎµÎ¯Ï‰ÏƒÎ· (Ï€.Ï‡. parachute, airbag)<br>
            &nbsp;&nbsp;- <strong>High (-2)</strong>: Î¥ÏˆÎ·Î»Î® Î¼ÎµÎ¯Ï‰ÏƒÎ· (Ï€.Ï‡. Ï€Î¿Î»Î»Î±Ï€Î»Î¬ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚)<br>
            &nbsp;&nbsp;ğŸ“Œ <em>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½ Ï„Î¿ drone Î­Ï‡ÎµÎ¹ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ (Î±Î»ÎµÎ¾Î¯Ï€Ï„Ï‰Ï„Î¿, ÎºÎ»Ï€)</em><br><br>
          â€¢ <strong>M3 (Emergency Response Plan - Î£Ï‡Î­Î´Î¹Î¿ ÎˆÎºÏ„Î±ÎºÏ„Î·Ï‚ Î‘Î½Î¬Î³ÎºÎ·Ï‚)</strong>:<br>
            &nbsp;&nbsp;- <strong>None (+1 penalty)</strong>: Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ‡Î­Î´Î¹Î¿ (Ï€Î¿Î¹Î½Î® +1 GRC)<br>
            &nbsp;&nbsp;- <strong>Medium (0)</strong>: Î’Î±ÏƒÎ¹ÎºÏŒ ÏƒÏ‡Î­Î´Î¹Î¿<br>
            &nbsp;&nbsp;- <strong>High (-1)</strong>: ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î¿ ÏƒÏ‡Î­Î´Î¹Î¿ Î¼Îµ Î¿Î¼Î¬Î´Î± Î­ÎºÏ„Î±ÎºÏ„Î·Ï‚ Î±Î½Î¬Î³ÎºÎ·Ï‚<br>
            &nbsp;&nbsp;ğŸ“Œ <em>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î·Î½ ÎµÏ„Î¿Î¹Î¼ÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Ï„Î¿ ÏƒÏ‡Î­Î´Î¹ÏŒ ÏƒÎ±Ï‚</em><br><br>
          <hr style="border:1px solid #4caf50; margin:12px 0;">
          <strong style="color:#0d47a1;">SORA 2.5:</strong><br>
          â€¢ <strong>M1(A) - Sheltering (Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± Î±Ï€ÏŒ ÎšÎ±Ï„Î±Ï†ÏÎ³Î¹Î±)</strong>:<br>
            &nbsp;&nbsp;- <strong>None (0)</strong>: Î‘Î½Î¿Î¹Ï‡Ï„Î® Ï€ÎµÏÎ¹Î¿Ï‡Î®, Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Ï„Î±Ï†ÏÎ³Î¹Î±<br>
            &nbsp;&nbsp;- <strong>Low (-1)</strong>: Î•Î»Î¬Ï‡Î¹ÏƒÏ„Î± ÎºÎ±Ï„Î±Ï†ÏÎ³Î¹Î± (Ï€.Ï‡. Î´Î­Î½Ï„ÏÎ±, ÏƒÏ„Î­Î³ÎµÏ‚)<br>
            &nbsp;&nbsp;- <strong>Medium (-2)</strong>: Î Î¿Î»Î»Î¬ ÎºÎ±Ï„Î±Ï†ÏÎ³Î¹Î± (Ï€.Ï‡. Î±ÏƒÏ„Î¹ÎºÎ® Ï€ÎµÏÎ¹Î¿Ï‡Î® Î¼Îµ ÎºÏ„Î¯ÏÎ¹Î±)<br>
            &nbsp;&nbsp;ğŸ“Œ <em>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ ÎºÎ±Ï„Î±Ï†Ï…Î³Î¯Ï‰Î½ ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î®</em><br><br>
          â€¢ <strong>M1(B) - Operational Restrictions (Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ¿Î¯ Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯)</strong>:<br>
            &nbsp;&nbsp;- <strong>None (0)</strong>: ÎšÎ±Î¼Î¯Î± Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚<br>
            &nbsp;&nbsp;- <strong>Medium (-1)</strong>: ÎœÎ­Ï„ÏÎ¹Î¿Î¹ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯ (Ï€.Ï‡. ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ ÏÏÎµÏ‚, ÏÏˆÎ¿Ï‚)<br>
            &nbsp;&nbsp;- <strong>High (-2)</strong>: Î‘Ï…ÏƒÏ„Î·ÏÎ¿Î¯ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯ (Ï€.Ï‡. NOTAM, TFR, ÎºÎ»ÎµÎ¹ÏƒÏ„Î® Ï€ÎµÏÎ¹Î¿Ï‡Î®)<br>
            &nbsp;&nbsp;ğŸ“Œ <em>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿Ï…Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ¿ÏÏ‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚ Ï€Î¿Ï… ÎµÏ†Î±ÏÎ¼ÏŒÎ¶ÎµÏ„Îµ</em><br><br>
          â€¢ <strong>M1(C) - Ground Observation (Î Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ· Î•Î´Î¬Ï†Î¿Ï…Ï‚)</strong>:<br>
            &nbsp;&nbsp;- <strong>None (0)</strong>: ÎšÎ±Î¼Î¯Î± Ï€Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ·<br>
            &nbsp;&nbsp;- <strong>Low (-1)</strong>: Î Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ· Î¼Îµ observers/ÎºÎ¬Î¼ÎµÏÎµÏ‚<br>
            &nbsp;&nbsp;ğŸ“Œ <em>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½ Î­Ï‡ÎµÏ„Îµ Ï€Î±ÏÎ±Ï„Î·ÏÎ·Ï„Î­Ï‚ Î® ÎºÎ¬Î¼ÎµÏÎµÏ‚ Î³Î¹Î± Ï„Î¿ Î­Î´Î±Ï†Î¿Ï‚</em><br><br>
          â€¢ <strong>M2 - Impact Dynamics Reduced (ÎœÎµÎ¯Ï‰ÏƒÎ· Î”Ï…Î½Î±Î¼Î¹ÎºÎ®Ï‚ Î ÏÏŒÏƒÎºÏÎ¿Ï…ÏƒÎ·Ï‚)</strong>:<br>
            &nbsp;&nbsp;- <strong>None (0)</strong>: ÎšÎ±Î¼Î¯Î± Î¼ÎµÎ¯Ï‰ÏƒÎ·<br>
            &nbsp;&nbsp;- <strong>Medium (-1)</strong>: ÎœÎ­Ï„ÏÎ¹Î± (Ï€.Ï‡. parachute)<br>
            &nbsp;&nbsp;- <strong>High (-2)</strong>: Î¥ÏˆÎ·Î»Î® (Ï€.Ï‡. Ï€Î¿Î»Î»Î±Ï€Î»Î¬ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î±)<br>
            &nbsp;&nbsp;ğŸ“Œ <em>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î± ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï„Î¿Ï… drone</em><br><br>
          <div style="background:#fff3e0; padding:8px; border-radius:4px; border:1px solid #ff9800; margin-top:8px;">
            <strong style="color:#e65100;">âš ï¸ Î£Î·Î¼Î±Î½Ï„Î¹ÎºÏŒ:</strong> M1(A) Medium Î”Î•Î Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÏ…Î½Î´Ï…Î±ÏƒÏ„ÎµÎ¯ Î¼Îµ M1(B) ÏƒÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ JARUS Annex B!
          </div>
        </div>
      </details>

      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; color:#1b5e20; font-weight:600; background:#c8e6c9; padding:8px; border-radius:4px;" data-i18n="guides.strategicMitigations.title">ğŸ¯ Strategic Mitigations - HOW TO CHOOSE?</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #4caf50;">
          Î£Ï„ÏÎ±Ï„Î·Î³Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„ÏÎ¹Î±ÏƒÎ¼Î¿Ï Ï€Î¿Ï… Ï€ÎµÏÎ¹Î¿ÏÎ¯Î¶Î¿Ï…Î½ Ï„Î·Î½ Î­ÎºÎ¸ÎµÏƒÎ· Î±Î½Î¸ÏÏÏ€Ï‰Î½/Ï€ÎµÏÎ¹Î¿Ï…ÏƒÎ¯Î±Ï‚:<br><br>
          â€¢ <strong>SM1</strong> - Controlled Ground Area / Î•Î»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î· Î ÎµÏÎ¹Î¿Ï‡Î® Î•Î´Î¬Ï†Î¿Ï…Ï‚<br>
          &nbsp;&nbsp;ğŸ“Œ <em>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½ Î· Ï€ÎµÏÎ¹Î¿Ï‡Î® ÎµÎ¯Î½Î±Î¹ Ï†Ï…ÏƒÎ¹ÎºÎ¬ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î· (Ï€ÎµÏÎ¯Ï†ÏÎ±Î¾Î·, guards)</em><br><br>
          â€¢ <strong>SM2</strong> - Operational Restrictions / Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ¿Î¯ Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯<br>
          &nbsp;&nbsp;ğŸ“Œ <em>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½ ÎµÏ†Î±ÏÎ¼ÏŒÎ¶ÎµÏ„Îµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚ (ÏÏÎµÏ‚, ÏÏˆÎ¿Ï‚, Ï„Î±Ï‡ÏÏ„Î·Ï„Î±)</em><br><br>
          <strong>Î ÏÏ‚ Î½Î± Ï„Î¹Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÏ„Îµ:</strong><br>
          Î“ÏÎ¬ÏˆÏ„Îµ Ï„Î¹Ï‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ ÏƒÎ±Ï‚ Ï‡Ï‰ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î¼Îµ ÎºÏŒÎ¼Î¼Î± (Ï€.Ï‡. <code>SM1,SM2</code> Î±Î½ ÎµÏ†Î±ÏÎ¼ÏŒÎ¶ÎµÏ„Îµ ÎºÎ±Î¹ Ï„Î¹Ï‚ Î´ÏÎ¿)
        </div>
      </details>

      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; color:#1b5e20; font-weight:600; background:#c8e6c9; padding:8px; border-radius:4px;" data-i18n="guides.typicality.title">ğŸ™ï¸ Typicality - HOW TO CHOOSE?</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #4caf50;">
          â€¢ <strong>Typical (Î¤Ï…Ï€Î¹ÎºÎ®)</strong>:<br>
          &nbsp;&nbsp;ğŸ“Œ Î— Ï€Ï„Î®ÏƒÎ· ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î·Î¸Î¹ÏƒÎ¼Î­Î½Î· Î³Î¹Î± Ï„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î®<br>
          &nbsp;&nbsp;ğŸ“Œ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: Î Ï„Î®ÏƒÎ· drone ÏƒÎµ Î±Î³ÏÎ¿Ï„Î¹ÎºÎ® Ï€ÎµÏÎ¹Î¿Ï‡Î® Î³Î¹Î± ÏˆÎµÎºÎ±ÏƒÎ¼ÏŒ<br>
          &nbsp;&nbsp;ğŸ“Œ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½: Î— Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ÎµÎ¯Î½Î±Î¹ Î³Î½Ï‰ÏƒÏ„Î® ÎºÎ±Î¹ Î±Î½Î±Î¼ÎµÎ½ÏŒÎ¼ÎµÎ½Î·<br><br>
          â€¢ <strong>Atypical (Î†Ï„Ï…Ï€Î·)</strong>:<br>
          &nbsp;&nbsp;ğŸ“Œ Î— Ï€Ï„Î®ÏƒÎ· ÎµÎ¯Î½Î±Î¹ Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„Î· Î³Î¹Î± Ï„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î®<br>
          &nbsp;&nbsp;ğŸ“Œ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: Î ÏÏÏ„Î· Ï€Ï„Î®ÏƒÎ· drone ÏƒÎµ Ï€Ï…ÎºÎ½Î¿ÎºÎ±Ï„Î¿Î¹ÎºÎ·Î¼Î­Î½Î· Ï€ÎµÏÎ¹Î¿Ï‡Î®<br>
          &nbsp;&nbsp;ğŸ“Œ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½: Î— Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ÎµÎ¯Î½Î±Î¹ Î½Î­Î± Î® Î±Ï€ÏÏŒÎ²Î»ÎµÏ€Ï„Î· Î³Î¹Î± Ï„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î®<br><br>
          <strong style="color:#e65100;">ÎšÏÎ¹Ï„Î®ÏÎ¹Î¿:</strong> Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Ï€Ï„Î®ÏƒÎµÏ‰Î½ ÎºÎ±Î¹ ÏƒÏ…Ï‡Î½ÏŒÏ„Î·Ï„Î± Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹Î¿Ï„Î®Ï„Ï‰Î½ ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î®
        </div>
      </details>

      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; color:#1b5e20; font-weight:600; background:#c8e6c9; padding:8px; border-radius:4px;" data-i18n="guides.controlledGroundArea.title">ğŸ”’ Controlled Ground Area - HOW TO CHOOSE?</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #4caf50;">
          â€¢ <strong>True (ÎÎ±Î¹)</strong>:<br>
          &nbsp;&nbsp;ğŸ“Œ Î— Ï€ÎµÏÎ¹Î¿Ï‡Î® ÎµÎ¯Î½Î±Î¹ Ï†Ï…ÏƒÎ¹ÎºÎ¬/Î½Î¿Î¼Î¹ÎºÎ¬ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î·<br>
          &nbsp;&nbsp;ğŸ“Œ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: Î ÎµÏÎ¯Ï†ÏÎ±Î¾Î·, Ï†ÏÎ»Î±ÎºÎµÏ‚, Î±Ï€Î±Î³ÏŒÏÎµÏ…ÏƒÎ· ÎµÎ¹ÏƒÏŒÎ´Î¿Ï…, Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ Î¿Î¹ÎºÏŒÏ€ÎµÎ´Î¿<br>
          &nbsp;&nbsp;ğŸ“Œ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½: ÎˆÏ‡ÎµÏ„Îµ Ï€Î»Î®ÏÎ· Î­Î»ÎµÎ³Ï‡Î¿ Ï„Î·Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚<br><br>
          â€¢ <strong>False (ÎŒÏ‡Î¹)</strong>:<br>
          &nbsp;&nbsp;ğŸ“Œ Î— Ï€ÎµÏÎ¹Î¿Ï‡Î® ÎµÎ¯Î½Î±Î¹ Î±Î½Î¿Î¹Ï‡Ï„Î® ÏƒÏ„Î¿ ÎºÎ¿Î¹Î½ÏŒ<br>
          &nbsp;&nbsp;ğŸ“Œ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: Î Î¬ÏÎºÎ¿, Î´ÏÏŒÎ¼Î¿Ï‚, Ï€Î±ÏÎ±Î»Î¯Î±, Ï€Î»Î±Ï„ÎµÎ¯Î±<br>
          &nbsp;&nbsp;ğŸ“Œ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½: Î— Ï€ÎµÏÎ¹Î¿Ï‡Î® ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î· Î±Ï€ÏŒ Î¬Î»Î»Î¿Ï…Ï‚<br><br>
          <strong style="color:#e65100;">ÎšÏÎ¹Ï„Î®ÏÎ¹Î¿:</strong> ÎÏ€Î±ÏÎ¾Î· Ï†Ï…ÏƒÎ¹ÎºÏÎ½/Î½Î¿Î¼Î¹ÎºÏÎ½ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏÎ½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚
        </div>
      </details>

      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; color:#1b5e20; font-weight:600; background:#c8e6c9; padding:8px; border-radius:4px;" data-i18n="guides.atypicalSegregated.title">ğŸš§ Atypical Segregated Area - HOW TO CHOOSE?</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #4caf50;">
          â€¢ <strong>True (ÎÎ±Î¹)</strong>:<br>
          &nbsp;&nbsp;ğŸ“Œ Î— Ï€ÎµÏÎ¹Î¿Ï‡Î® ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬ Î´Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼Î­Î½Î· Î³Î¹Î± Ï„Î·Î½ Ï€Ï„Î®ÏƒÎ·<br>
          &nbsp;&nbsp;ğŸ“Œ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: NOTAM, TFR, Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® Î±Ï€Î±Î³ÏŒÏÎµÏ…ÏƒÎ·<br>
          &nbsp;&nbsp;ğŸ“Œ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½: ÎˆÏ‡ÎµÏ„Îµ ÎµÎ¹Î´Î¹ÎºÎ® Î¬Î´ÎµÎ¹Î±/NOTAM Î³Î¹Î± Î´Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒ<br><br>
          â€¢ <strong>False (ÎŒÏ‡Î¹)</strong>:<br>
          &nbsp;&nbsp;ğŸ“Œ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½ÏŒÏ‚ Î´Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚<br>
          &nbsp;&nbsp;ğŸ“Œ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½: ÎšÎ±Î½Î¿Î½Î¹ÎºÎ® Ï€Ï„Î®ÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ ÎµÎ¹Î´Î¹ÎºÏŒ Î´Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒ<br><br>
          <strong style="color:#e65100;">ÎšÏÎ¹Ï„Î®ÏÎ¹Î¿:</strong> Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¿Î¯ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯ Î³Î¹Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Ï€Ï„Î®ÏƒÎ· (NOTAM, TFR)
        </div>
      </details>

      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; color:#1b5e20; font-weight:600; background:#c8e6c9; padding:8px; border-radius:4px;" data-i18n="guides.airspaceControl.title">âœˆï¸ Airspace Control - HOW TO CHOOSE?</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #4caf50;">
          â€¢ <strong>Controlled (Î•Î»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï‚)</strong>:<br>
          &nbsp;&nbsp;ğŸ“Œ ÎŸ ÎµÎ½Î±Î­ÏÎ¹Î¿Ï‚ Ï‡ÏÏÎ¿Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î±Ï€ÏŒ ATC<br>
          &nbsp;&nbsp;ğŸ“Œ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: CTR, TMA, Class A/B/C/D airspace<br>
          &nbsp;&nbsp;ğŸ“Œ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½: Î§ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ Î¬Î´ÎµÎ¹Î± ATC<br><br>
          â€¢ <strong>Uncontrolled (ÎœÎ· Î•Î»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï‚)</strong>:<br>
          &nbsp;&nbsp;ğŸ“Œ ÎŸ ÎµÎ½Î±Î­ÏÎ¹Î¿Ï‚ Ï‡ÏÏÎ¿Ï‚ Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ ATC<br>
          &nbsp;&nbsp;ğŸ“Œ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: Class E/F/G airspace<br>
          &nbsp;&nbsp;ğŸ“Œ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½: Î”ÎµÎ½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ Î¬Î´ÎµÎ¹Î± ATC<br><br>
          <strong style="color:#e65100;">ÎšÏÎ¹Ï„Î®ÏÎ¹Î¿:</strong> Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ airspace map Ï„Î·Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚ ÏƒÎ±Ï‚
        </div>
      </details>

      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; color:#1b5e20; font-weight:600; background:#c8e6c9; padding:8px; border-radius:4px;" data-i18n="guides.environment.title">ğŸ¢ Environment - HOW TO CHOOSE?</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #4caf50;">
          â€¢ <strong>Urban (Î‘ÏƒÏ„Î¹ÎºÏŒ)</strong>: Î ÏŒÎ»Î·, Ï€Ï…ÎºÎ½Î¿ÎºÎ±Ï„Î¿Î¹ÎºÎ·Î¼Î­Î½Î· Ï€ÎµÏÎ¹Î¿Ï‡Î®<br>
          â€¢ <strong>Rural (Î‘Î³ÏÎ¿Ï„Î¹ÎºÏŒ)</strong>: Î§Ï‰ÏÎ¹Î¬, Î±Î³ÏÎ¿Ï„Î¹ÎºÎ® Ï€ÎµÏÎ¹Î¿Ï‡Î®, Ï‡Ï‰ÏÎ¬Ï†Î¹Î±<br>
          â€¢ <strong>Suburban (Î ÏÎ¿Î±ÏƒÏ„Î¹Î±ÎºÏŒ)</strong>: Î ÏÎ¿Î¬ÏƒÏ„Î¹Î±, Î¼ÎµÏƒÎ±Î¯Î± Ï€Ï…ÎºÎ½ÏŒÏ„Î·Ï„Î±<br>
          â€¢ <strong>Industrial (Î’Î¹Î¿Î¼Î·Ï‡Î±Î½Î¹ÎºÏŒ)</strong>: Î’Î¹Î¿Î¼Î·Ï‡Î±Î½Î¹ÎºÎ­Ï‚ Î¶ÏÎ½ÎµÏ‚, ÎµÏÎ³Î¿ÏƒÏ„Î¬ÏƒÎ¹Î±<br><br>
          <strong style="color:#e65100;">ÎšÏÎ¹Ï„Î®ÏÎ¹Î¿:</strong> Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿Î½ Ï„ÏÏ€Î¿ Ï„Î·Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚ Ï€Ï„Î®ÏƒÎ·Ï‚
        </div>
      </details>

      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; color:#1b5e20; font-weight:600; background:#c8e6c9; padding:8px; border-radius:4px;">âœˆï¸ Airspace Class (ACE Categories) - HOW TO CHOOSE?</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #4caf50;">
          <strong style="color:#0d47a1;">ICAO Airspace Classification (A-G):</strong><br><br>
          
          â€¢ <strong>Class A</strong> - Î Î»Î®ÏÏ‰Ï‚ Î•Î»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï‚ (IFR Î¼ÏŒÎ½Î¿)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ:</strong> Î¥ÏˆÎ·Î»Î¬ flight levels (>18,000 ft ÏƒÏ…Î½Î®Î¸Ï‰Ï‚)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> ATC clearance, IFR flight plan, transponder Mode C/S<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> En-route airspace Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ FL180<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> Î¥ÏˆÎ·Î»ÏŒ ARC - Î‘Ï€Î±Î¹Ï„ÎµÎ¯ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ OSO mitigations<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î ÎµÏ„Î¬Ï„Îµ ÏƒÎµ Ï…ÏˆÎ·Î»ÏŒ flight level Î¼Îµ Ï€Î»Î®ÏÎ· ATC Î­Î»ÎµÎ³Ï‡Î¿<br><br>

          â€¢ <strong>Class B</strong> - Î•Î»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï‚ (IFR + VFR)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ:</strong> Î“ÏÏÏ‰ Î±Ï€ÏŒ Î¼ÎµÎ³Î¬Î»Î± Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î± (CTR)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> ATC clearance Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€Ï„Î®ÏƒÎµÎ¹Ï‚, transponder<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> London Heathrow CTR, JFK Terminal Control Area<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> Î¥ÏˆÎ·Î»ÏŒ ARC - ÎšÏÎ¯ÏƒÎ¹Î¼Î¿Ï‚ ÎµÎ½Î±Î­ÏÎ¹Î¿Ï‚ Ï‡ÏÏÎ¿Ï‚<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î ÎµÏ„Î¬Ï„Îµ ÎºÎ¿Î½Ï„Î¬ ÏƒÎµ Î¼ÎµÎ³Î¬Î»Î¿ Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î¿ Î¼Îµ Ï€Ï…ÎºÎ½Î® ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î±<br><br>

          â€¢ <strong>Class C</strong> - Î•Î»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï‚ (IFR + VFR)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ:</strong> Î ÎµÏÎ¹Î¿Ï‡Î¹ÎºÎ¬ Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î± (TMA)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> ATC clearance, radio contact, transponder<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> Athens TMA, Regional airport control zones<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> ÎœÎ­Ï„ÏÎ¹Î¿-Î¥ÏˆÎ·Î»ÏŒ ARC<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î ÎµÏ„Î¬Ï„Îµ ÏƒÎµ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î· Î¶ÏÎ½Î· Ï€ÎµÏÎ¹Î¿Ï‡Î¹ÎºÎ¿Ï Î±ÎµÏÎ¿Î´ÏÎ¿Î¼Î¯Î¿Ï…<br><br>

          â€¢ <strong>Class D</strong> - Î•Î»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï‚ (IFR + VFR)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ:</strong> ÎœÎ¹ÎºÏÎ¬ Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î± Î¼Îµ ATC<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> Radio contact, transponder (ÏŒÏ‡Î¹ Ï€Î¬Î½Ï„Î± Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÏŒ)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> Small controlled airports, military airfields<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> ÎœÎ­Ï„ÏÎ¹Î¿ ARC<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î ÎµÏ„Î¬Ï„Îµ ÎºÎ¿Î½Ï„Î¬ ÏƒÎµ Î¼Î¹ÎºÏÏŒ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿ Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î¿<br><br>

          â€¢ <strong>Class E</strong> - Î•Î»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î³Î¹Î± IFR, Î‘Î½Î¿Î¹Ï‡Ï„ÏŒÏ‚ Î³Î¹Î± VFR<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ:</strong> En-route airspace, ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï‚ ÎµÎ½Î±Î­ÏÎ¹Î¿Ï‚ Ï‡ÏÏÎ¿Ï‚<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> VFR Î´ÎµÎ½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ clearance, IFR Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> Continental control areas, TMA outer zones<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> Î§Î±Î¼Î·Î»ÏŒ-ÎœÎ­Ï„ÏÎ¹Î¿ ARC<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î ÎµÏ„Î¬Ï„Îµ ÏƒÎµ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿ Ï‡ÏÏÎ¿ Î±Î»Î»Î¬ ÎµÎºÏ„ÏŒÏ‚ CTR/TMA<br><br>

          â€¢ <strong>Class F</strong> - Advisory (Î£Ï…Î¼Î²Î¿Ï…Î»ÎµÏ…Ï„Î¹ÎºÏŒÏ‚)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ:</strong> Airspace Î¼Îµ flight information service<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> Î”ÎµÎ½ Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ clearance, ÏƒÏ…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹ radio contact<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> Advisory airspace, FIS zones<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> Î§Î±Î¼Î·Î»ÏŒ ARC<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î ÎµÏ„Î¬Ï„Îµ ÏƒÎµ Î·Î¼Î¹-ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿ Ï‡ÏÏÎ¿ Î¼Îµ ÏƒÏ…Î¼Î²Î¿Ï…Î»ÎµÏ…Ï„Î¹ÎºÎ­Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚<br><br>

          â€¢ <strong>Class G</strong> - Uncontrolled (ÎœÎ· Î•Î»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï‚) â­ Î£Î¥ÎÎ—Î˜Î•Î£Î¤Î•Î¡ÎŸ<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ:</strong> Î‘Î½Î¿Î¹Ï‡Ï„ÏŒÏ‚ ÎµÎ½Î±Î­ÏÎ¹Î¿Ï‚ Ï‡ÏÏÎ¿Ï‚, Ï‡Ï‰ÏÎ¯Ï‚ ATC<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> Î”ÎµÎ½ Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ clearance, VFR rules apply<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> Î‘Î³ÏÎ¿Ï„Î¹ÎºÎ­Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚, Ï‡Î±Î¼Î·Î»Î¬ ÏÏˆÎ· (<500ft AGL)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> Î§Î±Î¼Î·Î»ÏŒÏ„ÎµÏÎ¿ ARC (baseline)<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î ÎµÏ„Î¬Ï„Îµ Î¼Î±ÎºÏÎ¹Î¬ Î±Ï€ÏŒ Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î± ÏƒÎµ Î±Î½Î¿Î¹Ï‡Ï„ÏŒ Ï‡ÏÏÎ¿<br><br>

          <div style="background:#e3f2fd; padding:8px; border-radius:4px; border:1px solid #2196f3; margin-top:8px;">
            <strong style="color:#1565c0;">ğŸ’¡ Î ÏÏ‚ Î½Î± Ï„Î¿ Î²ÏÏ‰;</strong><br>
            1. Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ <strong>AIP (Aeronautical Information Publication)</strong> Ï„Î·Ï‚ Ï‡ÏÏÎ±Ï‚ ÏƒÎ±Ï‚<br>
            2. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ <strong>airspace map</strong> (Ï€.Ï‡. SkyDemon, ForeFlight, HCAA Hellas)<br>
            3. Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿ <strong>Ï„Î¿Ï€Î¹ÎºÏŒ ATC/FIS</strong> Î³Î¹Î± ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·
          </div>
        </div>
      </details>

      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; color:#d84315; font-weight:600; background:#ffccbc; padding:8px; border-radius:4px;">âš ï¸ Special Airspace Zones - HOW TO CHOOSE?</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #ff5722;">
          <strong style="color:#d84315;">Î•Î™Î”Î™ÎšÎ•Î£ Î–Î©ÎÎ•Î£ Î•ÎÎ‘Î•Î¡Î™ÎŸÎ¥ Î§Î©Î¡ÎŸÎ¥ (Special Airspace Zones):</strong><br>
          <em>Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Î¶ÏÎ½ÎµÏ‚ ÎµÏ€Î·ÏÎµÎ¬Î¶Î¿Ï…Î½ Ï„Î¿ ARC ÎºÎ±Î¹ Î±Ï€Î±Î¹Ï„Î¿ÏÎ½ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ OSO mitigations!</em><br><br>
          
          â€¢ <strong>ğŸ”´ Mode-S Veil / Transponder Mandatory Zone</strong><br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î¤Î¹ ÎµÎ¯Î½Î±Î¹:</strong> Î–ÏÎ½Î· Î³ÏÏÏ‰ Î±Ï€ÏŒ Î¼ÎµÎ³Î¬Î»Î± Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î± ÏŒÏ€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÏŒÏ‚ Î¿ transponder Mode-S<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹:</strong> Î£Ï…Î½Î®Î¸Ï‰Ï‚ ÏƒÎµ Î±ÎºÏ„Î¯Î½Î± 30nm Î³ÏÏÏ‰ Î±Ï€ÏŒ Î¼ÎµÎ³Î¬Î»Î± Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î± (Ï€.Ï‡. Athens International)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> Drone Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡ÎµÎ¹ SSR transponder Mode-S Î® ADS-B Out<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> <br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î‘Î½ AGL > 150ft (45m) â†’ <strong>ARC = AEC 2</strong> (Ï…ÏˆÎ·Î»ÏŒ)<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î‘Î½ AGL â‰¤ 150ft (45m) â†’ <strong>ARC = AEC 7</strong> (Î¼Î­Ï„ÏÎ¹Î¿)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>OSO Requirements:</strong> OSO#2 (C2 link), OSO#11 (See & Avoid), OSO#24 (Coordination)<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î ÎµÏ„Î¬Ï„Îµ ÎµÎ½Ï„ÏŒÏ‚ 30nm Î±Ï€ÏŒ Î¼ÎµÎ³Î¬Î»Î¿ Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î¿<br>
          &nbsp;&nbsp;ğŸ” <strong>Î ÏÏ‚ Î½Î± Ï„Î¿ Î²ÏÏ‰:</strong> Î•Î»Î­Î³Î¾Ï„Îµ AIP ENR 2.2 - "Transponder Mandatory Zones"<br><br>

          â€¢ <strong>ğŸ”´ TMZ (Transponder Mandatory Zone)</strong><br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î¤Î¹ ÎµÎ¯Î½Î±Î¹:</strong> ÎšÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î¶ÏÎ½Î· ÏŒÏ€Î¿Ï… ÏŒÎ»Î± Ï„Î± aircraft Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡Î¿Ï…Î½ ÎµÎ½ÎµÏÎ³ÏŒ transponder<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹:</strong> Terminal areas, busy airspace, CTR/TMA zones<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> SSR transponder (Mode A/C Î® Mode S) - **Î¥Î ÎŸÎ§Î¡Î•Î©Î¤Î™ÎšÎŸ**<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> ÎŠÎ´Î¹Î¿ Î¼Îµ Mode-S Veil (AEC 2 Î® 7 Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ ÏÏˆÎ¿Ï‚)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>OSO Requirements:</strong> OSO#2, OSO#11, OSO#24<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î¤Î¿ airspace chart Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ "TMZ" ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î® ÏƒÎ±Ï‚<br>
          &nbsp;&nbsp;ğŸ” <strong>Î ÏÏ‚ Î½Î± Ï„Î¿ Î²ÏÏ‰:</strong> AIP ENR 2.2, ICAO charts Î¼Îµ ÏƒÎ®Î¼Î±Î½ÏƒÎ· "TMZ"<br><br>

          â€¢ <strong>ğŸŸ¡ RMZ (Radio Mandatory Zone)</strong><br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î¤Î¹ ÎµÎ¯Î½Î±Î¹:</strong> Î–ÏÎ½Î· ÏŒÏ€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÎ® Î· ÏÎ±Î´Î¹Î¿ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± Î¼Îµ ATC/FIS<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹:</strong> Busy uncontrolled airspace, approach areas, aerodrome traffic zones<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> VHF radio 118-137 MHz + ÏƒÏ…Î½ÎµÏ‡Î®Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± Î¼Îµ ATC/FIS<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> Î”ÎµÎ½ ÎµÏ€Î·ÏÎµÎ¬Î¶ÎµÎ¹ Î¬Î¼ÎµÏƒÎ± Ï„Î¿ ARC, Î±Î»Î»Î¬ Î±Ï€Î±Î¹Ï„ÎµÎ¯:<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- OSO#2: C2 link performance (radio connection)<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- OSO#24: External services coordination<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> Class G airspace ÎºÎ¿Î½Ï„Î¬ ÏƒÎµ aerodrome Î¼Îµ AFIS<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î¤Î¿ chart Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ "RMZ" Î® "Radio Mandatory"<br>
          &nbsp;&nbsp;ğŸ” <strong>Î ÏÏ‚ Î½Î± Ï„Î¿ Î²ÏÏ‰:</strong> AIP AD 2 (Aerodromes), VFR charts<br><br>

          â€¢ <strong>ğŸ”´ Danger Area (Î•Ï€Î¹ÎºÎ¯Î½Î´Ï…Î½Î· Î ÎµÏÎ¹Î¿Ï‡Î®)</strong><br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î¤Î¹ ÎµÎ¯Î½Î±Î¹:</strong> Î ÎµÏÎ¹Î¿Ï‡Î® Î¼Îµ ÎµÏ€Î¹ÎºÎ¯Î½Î´Ï…Î½ÎµÏ‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ (military exercises, firing ranges, tests)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹:</strong> Î£Ï„ÏÎ±Ï„Î¹Ï‰Ï„Î¹ÎºÎ­Ï‚ Î¶ÏÎ½ÎµÏ‚, Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚ Î²Î¿Î»ÏÎ½, Î´Î¿ÎºÎ¹Î¼ÏÎ½ Ï€Ï…ÏÎ±ÏÎ»Ï‰Î½<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> <br>
          &nbsp;&nbsp;&nbsp;&nbsp;- ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ **NOTAM** (Notice to Airmen) Î³Î¹Î± activation times<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î£Ï…Î½Ï„Î¿Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î¼Îµ **military ATC** Î® **controlling authority**<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î Î¹Î¸Î±Î½Î® **Î±Î½Î±ÏƒÏ„Î¿Î»Î® Ï€Ï„Î®ÏƒÎ·Ï‚** ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î± activation<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> Î‘Ï€Î±Î¹Ï„ÎµÎ¯ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ OSO:<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- OSO#24: Coordination Î¼Îµ military authorities<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- OSO#11: Enhanced See & Avoid (radar, ADS-B)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> "D-401" (Danger Area 401), firing ranges, test zones<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> Î¤Î¿ chart Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ "D-XXX" Î® "Danger Area"<br>
          &nbsp;&nbsp;ğŸ” <strong>Î ÏÏ‚ Î½Î± Ï„Î¿ Î²ÏÏ‰:</strong> AIP ENR 5.1 - "Prohibited, Restricted and Danger Areas"<br><br>

          â€¢ <strong>ğŸš« Prohibited Area (Î‘Ï€Î±Î³Î¿ÏÎµÏ…Î¼Î­Î½Î· Î ÎµÏÎ¹Î¿Ï‡Î®)</strong><br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î¤Î¹ ÎµÎ¯Î½Î±Î¹:</strong> Î ÎµÏÎ¹Î¿Ï‡Î® ÏŒÏ€Î¿Ï… Î· Ï€Ï„Î®ÏƒÎ· ÎµÎ¯Î½Î±Î¹ **Î‘Î ÎŸÎ›Î¥Î¤Î‘ Î‘Î Î‘Î“ÎŸÎ¡Î•Î¥ÎœÎ•ÎÎ—**<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹:</strong> <br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î ÏÎ¿ÎµÎ´ÏÎ¹ÎºÎ¬ Î¼Î­Î³Î±ÏÎ± / ÎºÏ…Î²ÎµÏÎ½Î·Ï„Î¹ÎºÎ¬ ÎºÏ„Î¯ÏÎ¹Î±<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î Ï…ÏÎ·Î½Î¹ÎºÎ¿Î¯ ÏƒÏ„Î±Î¸Î¼Î¿Î¯ / ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ ÏƒÏ„ÏÎ±Ï„Î¹Ï‰Ï„Î¹ÎºÎ­Ï‚ ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î•Î¸Î½Î¹ÎºÎ®Ï‚ ÏƒÎ·Î¼Î±ÏƒÎ¯Î±Ï‚ Ï…Ï€Î¿Î´Î¿Î¼Î­Ï‚ (national security)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> **Î”Î•Î Î•Î Î™Î¤Î¡Î•Î Î•Î¤Î‘Î™ Î Î¤Î—Î£Î—** - ÎšÎ±Î¼Î¯Î± ÎµÎ¾Î±Î¯ÏÎµÏƒÎ·!<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>SORA Impact:</strong> <strong>âŒ SORA Assessment REJECTED</strong><br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï…Ï€Î¿Î²Î¬Î»ÎµÏ„Îµ SORA Î±Î½ Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® Ï€ÎµÏÎ½Î¬ÎµÎ¹ Î±Ï€ÏŒ Prohibited Area<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î‘Î»Î»Î¬Î¾Ï„Îµ Ï„Î¿ mission plan Î½Î± Î±Ï€Î¿Ï†ÏÎ³ÎµÏ„Îµ Ï„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î®!<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> "P-401" (Prohibited Area 401), "No-Fly Zone"<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> **ÎœÎ—Î** ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ - Î‘Î»Î»Î¬Î¾Ï„Îµ Î´Î¹Î±Î´ÏÎ¿Î¼Î® Î±Î½Ï„' Î±Ï…Ï„Î¿Ï!<br>
          &nbsp;&nbsp;ğŸ” <strong>Î ÏÏ‚ Î½Î± Ï„Î¿ Î²ÏÏ‰:</strong> AIP ENR 5.1, ICAO charts Î¼Îµ "P-XXX" marking<br><br>

          â€¢ <strong>ğŸŸ  Restricted Area (Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î ÎµÏÎ¹Î¿Ï‡Î®)</strong><br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î¤Î¹ ÎµÎ¯Î½Î±Î¹:</strong> Î ÎµÏÎ¹Î¿Ï‡Î® Î¼Îµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚ Ï€Ï„Î®ÏƒÎ·Ï‚ - Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ Î¼Îµ **ÎµÎ¹Î´Î¹ÎºÎ® Î¬Î´ÎµÎ¹Î±**<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏŒÏ„Îµ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹:</strong> <br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î£Ï„ÏÎ±Ï„Î¹Ï‰Ï„Î¹ÎºÎ­Ï‚ Î¶ÏÎ½ÎµÏ‚ Î¼Îµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î ÎµÏÎ¹Î¿Ï‡Î­Ï‚ Î¼Îµ Ï€ÎµÏÎ¹Î²Î±Î»Î»Î¿Î½Ï„Î¹ÎºÎ¿ÏÏ‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚ (wildlife reserves)<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î’Î¹Î¿Î¼Î·Ï‡Î±Î½Î¹ÎºÎ­Ï‚ Î¶ÏÎ½ÎµÏ‚ Î¼Îµ ÎµÎ¹Î´Î¹ÎºÎ¿ÏÏ‚ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î‘Ï€Î±Î¯Ï„Î·ÏƒÎ·:</strong> <br>
          &nbsp;&nbsp;&nbsp;&nbsp;- **Î ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· Î­Î³ÎºÏÎ¹ÏƒÎ·** Î±Ï€ÏŒ Î±ÏÎ¼ÏŒÎ´Î¹Î± Î±ÏÏ‡Î® (CAA, military, environmental agency)<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ **NOTAM** Î³Î¹Î± activation times<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î¤Î®ÏÎ·ÏƒÎ· **ÎµÎ¹Î´Î¹ÎºÏÎ½ ÏŒÏÏ‰Î½** (altitude limits, time windows)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ARC Impact:</strong> Î‘Ï€Î±Î¹Ï„ÎµÎ¯ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ OSO:<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- OSO#24: Coordination ÎºÎ±Î¹ approval process<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- OSO#19: Safe recovery from technical issues<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong> "R-401" (Restricted Area 401), national parks, military zones<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î±Î½:</strong> ÎˆÏ‡ÎµÏ„Îµ Î»Î¬Î²ÎµÎ¹ **Î³ÏÎ±Ï€Ï„Î® Î¬Î´ÎµÎ¹Î±** Î³Î¹Î± Ï€Ï„Î®ÏƒÎ· ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î®<br>
          &nbsp;&nbsp;ğŸ” <strong>Î ÏÏ‚ Î½Î± Ï„Î¿ Î²ÏÏ‰:</strong> AIP ENR 5.1, ICAO charts Î¼Îµ "R-XXX" marking<br><br>

          <div style="background:#fff3e0; padding:10px; border-radius:4px; border:2px solid #ff9800; margin-top:12px;">
            <strong style="color:#e65100;">âš ï¸ ÎšÎ¡Î™Î£Î™ÎœÎŸ - Î ÏÏ‚ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Î±Î½ Î²ÏÎ¯ÏƒÎºÎµÏƒÏ„Îµ ÏƒÎµ Special Zone:</strong><br>
            1. ğŸ“– <strong>AIP (Aeronautical Information Publication):</strong> ENR 2.2 (TMZ/RMZ), ENR 5.1 (P/R/D areas)<br>
            2. ğŸ—ºï¸ <strong>ICAO Charts / VFR Maps:</strong> Î‘Î½Î±Î¶Î·Ï„Î®ÏƒÏ„Îµ ÏƒÎ·Î¼Î¬Î½ÏƒÎµÎ¹Ï‚ P-XXX, R-XXX, D-XXX, TMZ, RMZ<br>
            3. ğŸ“¡ <strong>NOTAM Check:</strong> Î•Î»Î­Î³Î¾Ï„Îµ https://notaminfo.com Î® local NOTAM service<br>
            4. â˜ï¸ <strong>Contact ATC/FIS:</strong> Î–Î·Ï„Î®ÏƒÏ„Îµ confirmation Î³Î¹Î± Ï„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î® ÏƒÎ±Ï‚<br>
            5. ğŸ“± <strong>Aviation Apps:</strong> SkyDemon, ForeFlight, AirNav Pro (Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ zones)<br><br>
            
            <strong style="color:#d84315;">ğŸš¨ ÎœÎ—Î Î Î•Î¤Î‘ÎÎ•Î¤Î• Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î¹Ï‚ zones!</strong><br>
            - Î Î±ÏÎ¬Î²Î±ÏƒÎ· Prohibited Area â†’ Î Î¿Î¹Î½Î¹ÎºÎ­Ï‚ ÎºÏ…ÏÏÏƒÎµÎ¹Ï‚, ÎºÎ±Ï„Î¬ÏƒÏ‡ÎµÏƒÎ· drone<br>
            - Î Î±ÏÎ¬Î²Î±ÏƒÎ· TMZ/Mode-S Ï‡Ï‰ÏÎ¯Ï‚ transponder â†’ Î ÏÏŒÏƒÏ„Î¹Î¼Î¿, airspace violation<br>
            - Î Î±ÏÎ¬Î²Î±ÏƒÎ· Restricted Area Ï‡Ï‰ÏÎ¯Ï‚ Î¬Î´ÎµÎ¹Î± â†’ Î”Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÎ­Ï‚ ÎºÏ…ÏÏÏƒÎµÎ¹Ï‚<br>
            - Î Î±ÏÎ¬Î²Î±ÏƒÎ· Danger Area â†’ ÎšÎ¯Î½Î´Ï…Î½Î¿Ï‚ Î¶Ï‰Î®Ï‚ + Î½Î¿Î¼Î¹ÎºÎ­Ï‚ ÏƒÏ…Î½Î­Ï€ÎµÎ¹ÎµÏ‚
          </div>

          <div style="background:#e8f5e9; padding:10px; border-radius:4px; border:1px solid #4caf50; margin-top:12px;">
            <strong style="color:#2e7d32;">ğŸ’¡ Î£Ï…Î¼Î²Î¿Ï…Î»Î® Î³Î¹Î± Mission Planning:</strong><br>
            â€¢ Î Î¬Î½Ï„Î± ÎµÎ»Î­Î³Ï‡ÎµÏ„Îµ **AIP + NOTAM** Ï€ÏÎ¹Î½ Ï„Î¿ flight<br>
            â€¢ Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ **airspace planning apps** Î¼Îµ real-time updates<br>
            â€¢ ÎšÏÎ±Ï„Î®ÏƒÏ„Îµ **screenshots** Ï„Ï‰Î½ charts Î³Î¹Î± documentation<br>
            â€¢ Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ **ATC/FIS** 24-48 ÏÏÎµÏ‚ Ï€ÏÎ¹Î½ Î³Î¹Î± confirmation<br>
            â€¢ Î£Ï…Î¼Ï€ÎµÏÎ¹Î»Î¬Î²ÎµÏ„Îµ Ï„Î¹Ï‚ **special zones** ÏƒÏ„Î¿ SORA OSO analysis
          </div>
        </div>
      </details>

      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; color:#1565c0; font-weight:600; background:#bbdefb; padding:8px; border-radius:4px;">ğŸ“ Max Height AGL vs AMSL - Î ÎŸÎ™Î‘ Î— Î”Î™Î‘Î¦ÎŸÎ¡Î‘;</summary>
        <div style="padding:12px; background:#fff; border-radius:6px; margin-top:8px; border:1px solid #2196f3;">
          <strong style="color:#1565c0;">Î”Î¥ÎŸ Î”Î™Î‘Î¦ÎŸÎ¡Î•Î¤Î™ÎšÎ‘ Î¥Î¨Î— - Î§Î¡Î•Î™Î‘Î–ÎŸÎÎ¤Î‘Î™ ÎšÎ‘Î™ Î¤Î‘ Î”Î¥ÎŸ!</strong><br><br>

          â€¢ <strong>ğŸ“ Max Height AGL (Above Ground Level)</strong><br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î¤Î¹ ÎµÎ¯Î½Î±Î¹:</strong> Î¤Î¿ Î¼Î­Î³Î¹ÏƒÏ„Î¿ ÏÏˆÎ¿Ï‚ Ï€Ï„Î®ÏƒÎ·Ï‚ **Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î¿ Î­Î´Î±Ï†Î¿Ï‚**<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ÎœÎ¿Î½Î¬Î´Î±:</strong> ÎœÎ­Ï„ÏÎ± (m)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î§ÏÎ®ÏƒÎ·:</strong> Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ **ARC (Air Risk Class)** - Î¤Î¿ Ï€Î¹Î¿ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î³Î¹Î± SORA!<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ÎšÎ±Î½ÏŒÎ½ÎµÏ‚ ARC:</strong><br>
          &nbsp;&nbsp;&nbsp;&nbsp;- AGL â‰¤ 45m (150ft) â†’ <strong>AEC 7</strong> (Ï‡Î±Î¼Î·Î»ÏŒÏ„ÎµÏÎ¿ ARC)<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- AGL > 45m (150ft) â†’ <strong>AEC 2</strong> (Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ ARC)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong><br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î ÎµÏ„Î¬Ï„Îµ 60m Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î¿ Î­Î´Î±Ï†Î¿Ï‚ â†’ <strong>AGL = 60m</strong><br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±: ARC category = AEC 2 (ÎµÏ€ÎµÎ¹Î´Î® >45m)<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î ÏŒÏ„Îµ Î½Î± Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ:</strong> **Î Î‘ÎÎ¤Î‘** - Î•Î¯Î½Î±Î¹ Ï„Î¿ Î²Î±ÏƒÎ¹ÎºÏŒ ÏÏˆÎ¿Ï‚ Î³Î¹Î± ARC!<br><br>

          â€¢ <strong>ğŸŒŠ Max Height AMSL (Above Mean Sea Level)</strong><br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î¤Î¹ ÎµÎ¯Î½Î±Î¹:</strong> Î¤Î¿ Î¼Î­Î³Î¹ÏƒÏ„Î¿ ÏÏˆÎ¿Ï‚ Ï€Ï„Î®ÏƒÎ·Ï‚ **Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î· ÏƒÏ„Î¬Î¸Î¼Î· Ï„Î·Ï‚ Î¸Î¬Î»Î±ÏƒÏƒÎ±Ï‚**<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ÎœÎ¿Î½Î¬Î´Î±:</strong> ÎœÎ­Ï„ÏÎ± (m)<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î§ÏÎ®ÏƒÎ·:</strong> ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ **Î¾ÎµÏ€ÎµÏÎ½Î¬Ï„Îµ FL600 (18,000m)** - SORA 2.5 requirement<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>ÎšÎ±Î½ÏŒÎ½Î±Ï‚ SORA 2.5:</strong><br>
          &nbsp;&nbsp;&nbsp;&nbsp;- AMSL > 18,000m (FL600) â†’ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î± **Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ ARC**<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- AMSL â‰¤ 18,000m â†’ ÎšÎ±Î½Î¿Î½Î¹ÎºÏŒÏ‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ARC<br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î ÏÏ‚ Ï…Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÏ„Î±Î¹:</strong><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<code><strong>AMSL = AGL + Î¥ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿ Î ÎµÏÎ¹Î¿Ï‡Î®Ï‚</strong></code><br>
          &nbsp;&nbsp;ğŸ“Œ <strong>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:</strong><br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î ÎµÏÎ¹Î¿Ï‡Î® Î¼Îµ Ï…ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿ 500m (Ï€.Ï‡. Î»ÏŒÏ†Î¿Ï‚)<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î ÎµÏ„Î¬Ï„Îµ 60m AGL<br>
          &nbsp;&nbsp;&nbsp;&nbsp;- <strong>AMSL = 500 + 60 = 560m</strong><br>
          &nbsp;&nbsp;&nbsp;&nbsp;- Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±: 560m < 18,000m â†’ ÎšÎ±Î½Î¿Î½Î¹ÎºÏŒ ARC âœ…<br>
          &nbsp;&nbsp;âš ï¸ <strong>Î ÏŒÏ„Îµ Î½Î± Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ:</strong> **ÎœÏŒÎ½Î¿ Î³Î¹Î± SORA 2.5** ÎºÎ±Î¹ Î¿ÏÎµÎ¹Î½Î­Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚<br><br>

          <div style="background:#e3f2fd; padding:10px; border-radius:4px; border:1px solid #2196f3; margin-top:12px;">
            <strong style="color:#0d47a1;">ğŸ“Š Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ Î Î¯Î½Î±ÎºÎ±:</strong><br><br>
            <table style="width:100%; border-collapse:collapse; font-size:13px;">
              <thead>
                <tr style="background:#1976d2; color:#fff;">
                  <th style="padding:8px; border:1px solid #90caf9;">Î ÎµÎ´Î¯Î¿</th>
                  <th style="padding:8px; border:1px solid #90caf9;">Î£ÎºÎ¿Ï€ÏŒÏ‚</th>
                  <th style="padding:8px; border:1px solid #90caf9;">Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±</th>
                  <th style="padding:8px; border:1px solid #90caf9;">SORA Î•Ï†Î±ÏÎ¼Î¿Î³Î®</th>
                </tr>
              </thead>
              <tbody>
                <tr style="background:#e3f2fd;">
                  <td style="padding:8px; border:1px solid #90caf9;"><strong>AGL</strong></td>
                  <td style="padding:8px; border:1px solid #90caf9;">Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ARC category</td>
                  <td style="padding:8px; border:1px solid #90caf9;">60m AGL â†’ AEC 2</td>
                  <td style="padding:8px; border:1px solid #90caf9;"><strong>2.0 & 2.5</strong></td>
                </tr>
                <tr style="background:#fff;">
                  <td style="padding:8px; border:1px solid #90caf9;"><strong>AMSL</strong></td>
                  <td style="padding:8px; border:1px solid #90caf9;">ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ FL600 limit</td>
                  <td style="padding:8px; border:1px solid #90caf9;">2,100m AMSL < 18,000m âœ…</td>
                  <td style="padding:8px; border:1px solid #90caf9;"><strong>ÎœÏŒÎ½Î¿ 2.5</strong></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div style="background:#fff3e0; padding:10px; border-radius:4px; border:2px solid #ff9800; margin-top:12px;">
            <strong style="color:#e65100;">âš ï¸ Î£Î¥ÎÎ—Î˜Î— Î›Î‘Î˜Î— - Î ÏÏ‚ Î½Î± Ï„Î± Î±Ï€Î¿Ï†ÏÎ³ÎµÏ„Îµ:</strong><br><br>
            
            <strong>âŒ Î›Î‘Î˜ÎŸÎ£ #1:</strong> "Î’Î¬Î¶Ï‰ Î¼ÏŒÎ½Î¿ Ï„Î¿ AGL"<br>
            &nbsp;&nbsp;âœ… <strong>Î£Î©Î£Î¤ÎŸ:</strong> Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÎºÎ±Î¹ Ï„Î± Î´ÏÎ¿ Ï€ÎµÎ´Î¯Î± Î³Î¹Î± Ï€Î»Î®ÏÎ· Î±Î½Î¬Î»Ï…ÏƒÎ·!<br>
            &nbsp;&nbsp;&nbsp;&nbsp;- AGL: Î“Î¹Î± ARC category (Ï€.Ï‡. 60m)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;- AMSL: Î“Î¹Î± FL600 check (Ï€.Ï‡. 560m Î±Î½ Ï…ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿ 500m)<br><br>

            <strong>âŒ Î›Î‘Î˜ÎŸÎ£ #2:</strong> "Î”ÎµÎ½ Î¾Î­ÏÏ‰ Ï„Î¿ Ï…ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿ Ï„Î·Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚ Î¼Î¿Ï…"<br>
            &nbsp;&nbsp;âœ… <strong>Î£Î©Î£Î¤ÎŸ:</strong> Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;- ğŸ—ºï¸ Google Maps â†’ Right-click â†’ "What's here?" â†’ Î”ÎµÎ¯Ï‡Î½ÎµÎ¹ elevation<br>
            &nbsp;&nbsp;&nbsp;&nbsp;- ğŸ“± Aviation apps (SkyDemon, ForeFlight) â†’ Î”ÎµÎ¯Ï‡Î½Î¿Ï…Î½ AMSL real-time<br>
            &nbsp;&nbsp;&nbsp;&nbsp;- ğŸŒ Elevation tools: https://www.maps.ie/elevation/ <br><br>

            <strong>âŒ Î›Î‘Î˜ÎŸÎ£ #3:</strong> "Î’Î¬Î¶Ï‰ Ï„Î¿ AMSL Î±Î½Ï„Î¯ Î³Î¹Î± AGL"<br>
            &nbsp;&nbsp;âœ… <strong>Î£Î©Î£Î¤ÎŸ:</strong> <br>
            &nbsp;&nbsp;&nbsp;&nbsp;- <strong>AGL</strong> = ÎÏˆÎ¿Ï‚ drone Î±Ï€ÏŒ Ï„Î¿ Î­Î´Î±Ï†Î¿Ï‚ (Ï€.Ï‡. 60m)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;- <strong>AMSL</strong> = AGL + Î¥ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚ (Ï€.Ï‡. 60 + 500 = 560m)<br><br>

            <strong>âŒ Î›Î‘Î˜ÎŸÎ£ #4:</strong> "Î“Î¹Î± SORA 2.0 Î´ÎµÎ½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ AMSL"<br>
            &nbsp;&nbsp;âœ… <strong>Î£Î©Î£Î¤ÎŸ:</strong> Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î¿ Î³Î¹Î± documentation - Î§ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± future analysis!<br>
          </div>

          <div style="background:#e8f5e9; padding:10px; border-radius:4px; border:1px solid #4caf50; margin-top:12px;">
            <strong style="color:#2e7d32;">ğŸ’¡ Î ÏÎ±ÎºÏ„Î¹ÎºÏŒ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± - Î’Î®Î¼Î± Ï€ÏÎ¿Ï‚ Î’Î®Î¼Î±:</strong><br><br>
            
            <strong>Î£ÎµÎ½Î¬ÏÎ¹Î¿:</strong> Î Ï„Î®ÏƒÎ· ÏƒÎµ Î¿ÏÎµÎ¹Î½Î® Ï€ÎµÏÎ¹Î¿Ï‡Î®<br><br>
            
            <strong>Î’Î®Î¼Î± 1:</strong> Î’ÏÎµÎ¯Ï„Îµ Ï„Î¿ Ï…ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿ Ï„Î·Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚<br>
            &nbsp;&nbsp;â†’ Google Maps Î´ÎµÎ¯Ï‡Î½ÎµÎ¹: <strong>1,500m</strong> (Î¿ÏÎµÎ¹Î½Î® Ï€ÎµÏÎ¹Î¿Ï‡Î®)<br><br>
            
            <strong>Î’Î®Î¼Î± 2:</strong> ÎšÎ±Î¸Î¿ÏÎ¯ÏƒÏ„Îµ Ï„Î¿ ÏÏˆÎ¿Ï‚ Ï€Ï„Î®ÏƒÎ·Ï‚ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î¿ Î­Î´Î±Ï†Î¿Ï‚<br>
            &nbsp;&nbsp;â†’ Î˜Î­Î»ÎµÏ„Îµ Î½Î± Ï€ÎµÏ„Î¬Î¾ÎµÏ„Îµ: <strong>50m AGL</strong><br><br>
            
            <strong>Î’Î®Î¼Î± 3:</strong> Î¥Ï€Î¿Î»Î¿Î³Î¯ÏƒÏ„Îµ Ï„Î¿ AMSL<br>
            &nbsp;&nbsp;â†’ AMSL = 1,500m (Ï…ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿) + 50m (AGL) = <strong>1,550m</strong><br><br>
            
            <strong>Î’Î®Î¼Î± 4:</strong> Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î± Ï€ÎµÎ´Î¯Î±<br>
            &nbsp;&nbsp;â†’ <strong>Max Height AGL:</strong> 50<br>
            &nbsp;&nbsp;â†’ <strong>Max Height AMSL:</strong> 1550<br><br>
            
            <strong>Î’Î®Î¼Î± 5:</strong> ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ARC<br>
            &nbsp;&nbsp;â†’ 50m AGL > 45m â†’ <strong>ARC = AEC 2</strong> (Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿)<br>
            &nbsp;&nbsp;â†’ 1,550m AMSL < 18,000m â†’ <strong>FL600 OK âœ…</strong><br><br>
            
            <strong>Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±:</strong> Î— Ï€Ï„Î®ÏƒÎ· ÎµÎ¯Î½Î±Î¹ ÎµÎ½Ï„ÏŒÏ‚ Î¿ÏÎ¯Ï‰Î½ SORA, ARC category = AEC 2
          </div>

          <div style="background:#fce4ec; padding:10px; border-radius:4px; border:1px solid #e91e63; margin-top:12px;">
            <strong style="color:#c2185b;">ğŸ¯ ÎšÎ¡Î™Î£Î™ÎœÎŸ - Î ÏŒÏ„Îµ Î½Î± Î´ÏÏƒÎµÏ„Îµ Ï€ÏÎ¿ÏƒÎ¿Ï‡Î®:</strong><br><br>
            
            â€¢ <strong>ÎŸÏÎµÎ¹Î½Î­Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚ (>1,000m Ï…ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿):</strong><br>
            &nbsp;&nbsp;â†’ Î¤Î¿ AMSL Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï Ï…ÏˆÎ·Î»ÏŒ Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î³Î¹Î± Ï‡Î±Î¼Î·Î»ÏŒ AGL!<br>
            &nbsp;&nbsp;â†’ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: 30m AGL ÏƒÎµ Ï€ÎµÏÎ¹Î¿Ï‡Î® 2,000m â†’ AMSL = 2,030m<br><br>
            
            â€¢ <strong>Î Ï„Î®ÏƒÎµÎ¹Ï‚ ÎºÎ¿Î½Ï„Î¬ ÏƒÎµ Î²Î¿Ï…Î½Î¬:</strong><br>
            &nbsp;&nbsp;â†’ Î¤Î¿ Ï…ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿ Î±Î»Î»Î¬Î¶ÎµÎ¹ Î³ÏÎ®Î³Î¿ÏÎ± - Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ ÏƒÎ·Î¼ÎµÎ¯Î¿ Î¼Îµ Ï„Î¿ Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ AMSL!<br>
            &nbsp;&nbsp;â†’ Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ **Î¼Î­Î³Î¹ÏƒÏ„Î¿ AMSL** Ï„Î·Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚<br><br>
            
            â€¢ <strong>Î Î±ÏÎ¬ÎºÏ„Î¹ÎµÏ‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚ (0-100m Ï…ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿):</strong><br>
            &nbsp;&nbsp;â†’ AMSL â‰ˆ AGL (Î¼Î¹ÎºÏÎ® Î´Î¹Î±Ï†Î¿ÏÎ¬)<br>
            &nbsp;&nbsp;â†’ Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: 60m AGL ÏƒÎµ Ï€ÎµÏÎ¹Î¿Ï‡Î® 10m â†’ AMSL = 70m<br><br>
            
            <strong style="color:#d32f2f;">ğŸš¨ Î‘Î ÎÎ•Î Î•Î¡Î‘Î£Î•Î¤Î• FL600 (18,000m AMSL):</strong><br>
            &nbsp;&nbsp;â†’ Î¤Î¿ ARC Î±Ï…Î¾Î¬Î½ÎµÏ„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± (SORA 2.5)<br>
            &nbsp;&nbsp;â†’ Î‘Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ OSO mitigations<br>
            &nbsp;&nbsp;â†’ Î£Ï€Î¬Î½Î¹Î± Î³Î¹Î± drones - Î£Ï…Î½Î®Î¸Ï‰Ï‚ helicopters/aircraft
          </div>
        </div>
      </details>
    </fieldset>

    <!-- Mission identifiers -->
    <div class="grid">
      <div>
        <label style="display:flex; justify-content:space-between; align-items:center;">
          <span><strong>Mission ID (Auto-Generated)</strong></span>
          <button type="button" onclick="generateNewMissionId()" style="padding:4px 8px; font-size:12px; background:#2196f3; color:white; border:none; border-radius:4px; cursor:pointer;">ğŸ”„ New ID</button>
        </label>
        <input id="missionId" type="text" placeholder="M-YYYYMMDD-HHMM-###" readonly style="background:#e8f5e9; font-weight:600; cursor:not-allowed;" />
      </div>
      <div>
        <label>Mission Name / Description
          <input id="missionName" type="text" placeholder="Short description" />
        </label>
      </div>
    </div>

    <!-- Mission Type (Business field - operator requirement) -->
    <div style="margin-top:12px;">
      <label><strong>Mission Type</strong>
        <select id="missionType" style="font-weight:500; background:#f5f5f5;">
          <option value="">-- Select Mission Type --</option>
          <optgroup label="ğŸ§¹ Cleaning Services">
            <option value="Photovoltaic_Cleaning">Photovoltaic Park Cleaning</option>
            <option value="Solar_Panels_Cleaning">Solar Panels Cleaning</option>
            <option value="Facade_Cleaning">Facade Cleaning</option>
            <option value="Roof_Cleaning">Roof Cleaning</option>
            <option value="Generators_Cleaning">Generators Cleaning</option>
            <option value="Stadium_Cleaning">Stadium Cleaning</option>
          </optgroup>
          <optgroup label="ğŸ“¹ Media & Inspection">
            <option value="Inspection">Inspection</option>
            <option value="Videography">Videography / Photography</option>
            <option value="Mapping">Mapping / Surveying</option>
          </optgroup>
          <optgroup label="ğŸŒ¾ Agriculture">
            <option value="Agriculture_Spraying">Agriculture Spraying</option>
            <option value="Agriculture_Monitoring">Agriculture Monitoring</option>
          </optgroup>
          <optgroup label="ğŸ“¦ Other">
            <option value="Delivery">Delivery / Transport</option>
            <option value="Search_Rescue">Search & Rescue</option>
            <option value="Security">Security / Surveillance</option>
            <option value="Other">Other</option>
          </optgroup>
        </select>
      </label>
    </div>

    <!-- Population Density Dropdown (EASA Table 3) - SORA 2.5 ONLY -->
    <div id="populationDensityField" class="row" style="margin-top:12px; display:none;">
      <div class="col">
        <label><span data-i18n="missionPlanner.mission.populationDensity">Population Density (EASA SORA Table 3)</span>
          <select id="populationDensity" onchange="updateiGRC(); updatePopulationDensityHelp()">
            <option value="controlled">Controlled Ground Area - Î•Î»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î· Î ÎµÏÎ¹Î¿Ï‡Î®</option>
            <option value="4">< 5 people/kmÂ² - Remote (Î‘Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î·)</option>
            <option value="25">< 50 people/kmÂ² - Lightly Populated (Î‘ÏÎ±Î¹Î¿ÎºÎ±Ï„Î¿Î¹ÎºÎ·Î¼Î­Î½Î·)</option>
            <option value="250">< 500 people/kmÂ² - Sparsely Populated / Residential Lightly (Î‘ÏÎ±Î¹Î® ÎšÎ±Ï„Î¿Î¯ÎºÎ·ÏƒÎ·)</option>
            <option value="2500">< 5,000 people/kmÂ² - Suburban / Low Density Metropolitan (Î ÏÎ¿Î¬ÏƒÏ„Î¹Î±)</option>
            <option value="25000">< 50,000 people/kmÂ² - High Density Metropolitan (Î‘ÏƒÏ„Î¹ÎºÎ® Î ÎµÏÎ¹Î¿Ï‡Î®)</option>
            <option value="50001">> 50,000 people/kmÂ² - Assemblies of People (Î£Ï…Î³ÎºÎµÎ½Ï„ÏÏÏƒÎµÎ¹Ï‚ ÎšÏŒÏƒÎ¼Î¿Ï…)</option>
          </select>
        </label>
        <div id="populationDensityHelp" style="font-size:11px; color:#666; margin-top:4px;"></div>
        <div style="font-size:11px; color:#666; margin-top:4px;">
          ğŸ“Œ Î Î·Î³Î®: JARUS SORA 2.5 Main Body, Table 3 - Qualitative descriptors for population density estimation
        </div>
      </div>
    </div>
    <div id="anchorAfterMission"></div>

    <!-- Container for PDRA/STS category-specific fields -->
    <fieldset id="categoryFieldsContainer" style="display:none;background:linear-gradient(to bottom,#f8f9fa,#ffffff);border:2px solid #0d6efd;border-radius:8px;box-shadow:0 2px 8px rgba(13,110,253,0.15);">
      <legend data-i18n="missionPlanner.categoryFields.title" style="background:#0d6efd;color:white;padding:8px 16px;border-radius:6px;font-weight:700;font-size:16px;">
        ğŸ“‹ Category Specific Fields
      </legend>
      <div id="dynamicFieldsContent"></div>
    </fieldset>

    <!-- SORA 2.0 specific fields -->
    <fieldset id="grc20" style="display:none;">
      <legend>SORA 2.0 Fields</legend>
      <div class="grid">
        <div>
          <label>Scenario (V2.0)
            <select id="scenario20" onchange="updateiGRC()">
              <option value="ControlledGroundArea">Controlled Ground Area</option>
              <option value="VLOS_SparselyPopulated">VLOS Â· Sparsely Populated</option>
              <option value="BVLOS_SparselyPopulated">BVLOS Â· Sparsely Populated</option>
              <option value="VLOS_Populated">VLOS Â· Populated</option>
              <option value="BVLOS_Populated">BVLOS Â· Populated</option>
              <option value="VLOS_GatheringOfPeople">VLOS Â· Gathering of People</option>
              <option value="BVLOS_GatheringOfPeople">BVLOS Â· Gathering of People</option>
            </select>
          </label>
        </div>
        <div>
          <label>Max Characteristic Dimension (m)
            <input id="maxDimension20" type="number" min="0" step="0.1" />
          </label>
        </div>
        <div style="background:#fff3e0; padding:8px; border-radius:6px; border:1px solid #ff9800;">
          <strong style="color:#e65100;">ğŸ“Š Kinetic Energy (Auto-Computed)</strong>
          <div id="kineticEnergy20Display" style="font-size:18px; font-weight:600; color:#f57c00; margin-top:4px;">
            Select drone or enter MTOM/Speed
          </div>
          <div style="font-size:11px; color:#666; margin-top:4px;">
            Formula: KE = 0.5 Ã— MTOM(kg) Ã— maxSpeedÂ²(m/s)<br>
            Thresholds: <700J, <34KJ, <1084KJ, >1084KJ (JAR_doc_06 Table 2)
          </div>
        </div>
      </div>
      <!-- SORA 2.0 Mitigations (per JAR_doc_06 Table 3) -->
      <div style="background:#e8f5e9; padding:12px; border-radius:8px; margin-top:12px;">
        <strong style="color:#2e7d32;">Ground Risk Mitigations (Table 3 - SORA v2.0)</strong>
        <div class="grid" style="margin-top:8px;">
          <div>
            <label style="color:#1b5e20; font-weight:600;">M1 - Strategic (reduce people at risk)
              <select id="m1_20" onchange="calculateGRC20()">
                <option value="0">None (0)</option>
                <option value="-1">Low (-1)</option>
                <option value="-2">Medium (-2)</option>
                <option value="-4">High (-4)</option>
              </select>
            </label>
          </div>
          <div>
            <label style="color:#1b5e20; font-weight:600;">M2 - Impact reduction (e.g., parachute)
              <select id="m2_20" onchange="calculateGRC20()">
                <option value="0">None (0)</option>
                <option value="-1">Medium (-1)</option>
                <option value="-2">High (-2)</option>
              </select>
            </label>
            <div style="font-size:11px; color:#666; margin-top:4px;">
              âš ï¸ JARUS SORA 2.0: M2 has only <strong>None/Medium/High</strong> (no "Low")
            </div>
          </div>
          <div>
            <label style="color:#1b5e20; font-weight:600;">M3 - Emergency Response Plan
              <select id="m3_20" onchange="calculateGRC20()">
                <option value="1">None (+1 penalty)</option>
                <option value="0">Medium (0)</option>
                <option value="-1">High (-1)</option>
              </select>
            </label>
          </div>
        </div>
        <div id="grc20Calculation" style="margin-top:12px; padding:10px; background:#c8e6c9; border:1px solid #4caf50; border-radius:6px; display:none;">
          <strong style="color:#1b5e20;">GRC Calculation:</strong>
          <div id="grc20CalcDetails" style="color:#2e7d32; margin-top:4px;"></div>
        </div>
      </div>
    </fieldset>

    <!-- SORA 2.5 specific fields -->
    <fieldset id="grc25" style="display:none;">
      <legend>SORA 2.5 Fields</legend>
      <div id="manualMetrics25" class="grid">
        <div>
          <label>Max Characteristic Dimension (m)
            <div style="display:flex; gap:8px; align-items:center;">
              <input id="maxDimension" type="number" min="0" step="0.1" onchange="updateiGRC()" disabled />
              <label style="display:flex; gap:6px; align-items:center; font-size:12px; color:#555;">
                <input type="checkbox" id="editMaxDim" /> <span data-i18n="ui.editManually">Edit manually</span>
              </label>
            </div>
          </label>
        </div>
        <div>
          <label>Max Speed (m/s)
            <div style="display:flex; gap:8px; align-items:center;">
              <input id="maxSpeed" type="number" min="0" step="0.1" onchange="updateiGRC()" disabled />
              <label style="display:flex; gap:6px; align-items:center; font-size:12px; color:#555;">
                <input type="checkbox" id="editMaxSpeed" /> <span data-i18n="ui.editManually">Edit manually</span>
              </label>
            </div>
          </label>
        </div>
      </div>
      <!-- SORA 2.5 Mitigations (per JAR_doc_25 Table 5 & Annex B JAR_doc_27) -->
      <div style="background:#e3f2fd; padding:12px; border-radius:8px; margin-top:12px;">
        <strong style="color:#1565c0;">Ground Risk Mitigations (Table 5 - SORA v2.5)</strong>
        <div class="grid" style="margin-top:8px;">
          <div>
            <label style="color:#0d47a1; font-weight:600;">M1(A) - Sheltering
              <select id="m1a_25" onchange="calculateGRC25()">
                <option value="0">None (0)</option>
                <option value="-1">Low (-1)</option>
              </select>
            </label>
            <div style="font-size:11px; color:#666; margin-top:4px;">
              âš ï¸ JARUS SORA 2.5 Table 5: M1A has only <strong>None / Low (-1)</strong>. High sheltering = 0 credit (no mitigation needed).
            </div>
          </div>
          <div>
            <label style="color:#0d47a1; font-weight:600;">M1(B) - Operational restrictions
              <select id="m1b_25" onchange="calculateGRC25()">
                <option value="0">None (0)</option>
                <option value="-1">Medium (-1)</option>
                <option value="-2">High (-2)</option>
              </select>
            </label>
          </div>
          <div>
            <label style="color:#0d47a1; font-weight:600;">M1(C) - Ground observation
              <select id="m1c_25" onchange="calculateGRC25()">
                <option value="0">None (0)</option>
                <option value="-1">Low (-1)</option>
              </select>
            </label>
          </div>
          <div>
            <label style="color:#0d47a1; font-weight:600;">M2 - Impact dynamics reduced
              <select id="m2_25" onchange="calculateGRC25()">
                <option value="0">None (0)</option>
                <option value="-1">Medium (-1)</option>
                <option value="-2">High (-2)</option>
              </select>
            </label>
          </div>
        </div>
        <div id="grc25Calculation" style="margin-top:12px; padding:10px; background:#bbdefb; border:1px solid #2196f3; border-radius:6px; display:none;">
          <strong style="color:#0d47a1;">iGRC Calculation:</strong>
          <div id="grc25CalcDetails" style="color:#1565c0; margin-top:4px;"></div>
        </div>
        <div id="m1Validation" style="margin-top:8px; padding:8px; background:#fff3e0; border:1px solid #ff9800; border-radius:6px; color:#e65100; display:none;">
          <strong>âš ï¸ Validation Error:</strong> M1(A) Medium cannot be combined with M1(B) per JARUS Annex B rules.
        </div>
      </div>
    </fieldset>

    <!-- Air Risk (used in SORA) -->
    <fieldset id="airRiskSection">
      <legend data-i18n="missionPlanner.airRisk">Air Risk</legend>
      <div class="grid">
        <div>
          <label>Explicit ARC
            <span class="help-icon" data-i18n="help.explicitARC" data-i18n-attr="title" title="?">?</span>
            <select id="explicitARC">
              <option value="" data-i18n="dropdown.explicitARC.auto">Auto (derive)</option>
              <option value="ARC-a" data-i18n="dropdown.explicitARC.a">ARC-a</option>
              <option value="ARC-b" data-i18n="dropdown.explicitARC.b">ARC-b</option>
              <option value="ARC-c" data-i18n="dropdown.explicitARC.c">ARC-c</option>
              <option value="ARC-d" data-i18n="dropdown.explicitARC.d">ARC-d</option>
            </select>
          </label>
        </div>
        <div>
          <label>Airspace Control
            <span class="help-icon" data-i18n="help.airspaceControl.title" data-i18n-attr="title" title="?">?</span>
            <select id="airspaceControl" onchange="updateARC(); updateAirspaceControlHelp()">
              <option value="Uncontrolled" data-i18n="dropdown.airspaceControl.uncontrolled">Uncontrolled</option>
              <option value="Controlled" data-i18n="dropdown.airspaceControl.controlled">Controlled</option>
            </select>
          </label>
          <div id="airspaceControlHelp" style="font-size:11px; color:#0066cc; margin-top:4px; padding:6px; background:#f0f7ff; border-radius:4px;">
          </div>
        </div>
        <div>
          <label>Location Type
            <span class="help-icon" data-i18n="help.locationType.title" data-i18n-attr="title" title="?">?</span>
            <select id="locationType" onchange="updateARC(); updateLocationTypeHelp()">
              <option value="NonAirport" data-i18n="dropdown.locationType.nonAirport">NonAirport</option>
              <option value="Airport" data-i18n="dropdown.locationType.airport">Airport</option>
            </select>
          </label>
          <div id="locationTypeHelp" style="font-size:11px; color:#0066cc; margin-top:4px; padding:6px; background:#f0f7ff; border-radius:4px;">
          </div>
        </div>
        <div>
          <label>Environment (SORA 2.5 Step #4)
            <span class="help-icon" data-i18n="help.environment.title" data-i18n-attr="title" title="?">?</span>
            <select id="environment" onchange="updateARC(); updateEnvironmentHelp()">
              <option value="Urban" data-i18n="dropdown.environment.urban">Urban (>1,500 people/kmÂ² - JARUS SORA Table 3)</option>
              <option value="Suburban" data-i18n="dropdown.environment.suburban">Suburban (500-1,500 people/kmÂ²)</option>
              <option value="Rural" data-i18n="dropdown.environment.rural">Rural (<500 people/kmÂ² - Lower GRC)</option>
              <option value="Industrial" data-i18n="dropdown.environment.industrial">Industrial (Controlled access area)</option>
              <option value="Remote" data-i18n="dropdown.environment.remote">Remote/Desert (<5 people/kmÂ² - Minimal risk)</option>
              <option value="Coastal" data-i18n="dropdown.environment.coastal">Coastal/Maritime (Over water - Reduced ground risk)</option>
              <option value="Mountain" data-i18n="dropdown.environment.mountain">Mountain (Low traffic, terrain obstacles)</option>
              <option value="Forest" data-i18n="dropdown.environment.forest">Forest (Low traffic, natural obstacles)</option>
            </select>
          </label>
          <div id="environmentHelp" style="font-size:11px; color:#0066cc; margin-top:4px; padding:6px; background:#f0f7ff; border-radius:4px;">
          </div>
        </div>
        <div>
          <label>Typicality
            <span class="help-icon" data-i18n="help.typicality" data-i18n-attr="title" title="?">?</span>
            <select id="typicality" onchange="updateARC()">
              <option value="Typical" data-i18n="dropdown.typicality.typical">Typical</option>
              <option value="Atypical" data-i18n="dropdown.typicality.atypical">Atypical</option>
            </select>
          </label>
        </div>
        <div>
          <label>Max Height AGL (m)
            <span class="help-icon" data-i18n="help.maxHeightAGL" data-i18n-attr="title" title="?">?</span>
            <input id="maxHeightAGL" type="number" min="0" step="1" onchange="updateARC()" />
          </label>
        </div>
        <div>
          <label>Max Height AMSL (m)
            <span class="help-icon" title="Maximum altitude above mean sea level (for FL600 check)">?</span>
            <input id="maxHeightAMSL" type="number" min="0" step="1" onchange="updateARC()" placeholder="For FL600 check (18,000m)" />
          </label>
        </div>
      </div>
      
      <!-- NEW: Airspace Classification & Special Zones -->
      <div class="grid" style="background:#e3f2fd; padding:12px; border-radius:8px; margin-top:8px;">
        <div>
          <label><strong>Airspace Class (ACE Categories)</strong>
            <span class="help-icon" title="ICAO Airspace Classification A-G (applies to all SORA versions)">?</span>
            <select id="airspaceClass" onchange="updateARC(); updateAirspaceHelp()">
              <option value="G">Class G (Uncontrolled)</option>
              <option value="F">Class F (Advisory)</option>
              <option value="E">Class E (Controlled, IFR/VFR)</option>
              <option value="D">Class D (Controlled, IFR/VFR)</option>
              <option value="C">Class C (Controlled, IFR/VFR)</option>
              <option value="B">Class B (Controlled)</option>
              <option value="A">Class A (Controlled, IFR only)</option>
            </select>
          </label>
          <div id="airspaceHelp" style="font-size:11px; color:#1565c0; margin-top:4px; padding:6px; background:#e1f5fe; border-radius:4px;">
            Class G: Uncontrolled airspace, no ATC clearance required
          </div>
        </div>
        <div>
          <label><strong>Special Airspace Zones</strong>
            <span class="help-icon" title="Special airspace zones affect ARC and require additional mitigation measures">?</span>
          </label>
          <div style="margin-top:8px; display:grid; grid-template-columns:1fr 1fr; gap:4px;">
            <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" id="isModeS" onchange="updateARC()" />
              <span>Mode-S Veil / Transponder Mandatory</span>
            </label>
            <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" id="isTMZ" onchange="updateARC()" />
              <span>TMZ (Transponder Mandatory Zone)</span>
            </label>
            <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" id="isRMZ" onchange="updateARC()" />
              <span>RMZ (Radio Mandatory Zone)</span>
            </label>
            <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" id="isDangerArea" onchange="updateARC()" />
              <span>Danger Area</span>
            </label>
            <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" id="isProhibitedArea" onchange="updateARC()" />
              <span>Prohibited Area</span>
            </label>
            <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" id="isRestrictedArea" onchange="updateARC()" />
              <span>Restricted Area</span>
            </label>
          </div>
          <div style="font-size:11px; color:#d84315; margin-top:4px; padding:6px; background:#fff3e0; border-radius:4px;">
            âš ï¸ Mode-S/TMZ zones â†’ Higher ARC (AEC 2 or 7)
          </div>
        </div>
      </div>
      
      <!-- Aerodrome Proximity (Advisory fields for ARC) -->
      <div class="grid" style="background:#fff8e1; padding:12px; border-radius:8px; margin-top:8px; border:1px solid #ffe082;">
        <div style="grid-column:1 / -1; font-weight:700; color:#6d4c41; margin-bottom:6px;" data-i18n="missionPlanner.aerodromeProximity.title">Aerodrome Proximity (Advisory)</div>
        <div>
          <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
            <input type="checkbox" id="isInCtr" onchange="updateARC()" />
            <span>
              <strong data-i18n="missionPlanner.aerodromeProximity.isCtr">CTR / Terminal Control Area</strong><br>
              <small data-i18n="help.locationType.airport">Near or at airport - High air traffic risk. Requires coordination.</small>
            </span>
          </label>
        </div>
        <div>
          <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
            <input type="checkbox" id="isNearAerodrome" onchange="updateARC(); updateAerodromeProximityUI()" />
            <span>
              <strong data-i18n="missionPlanner.aerodromeProximity.isNear">Near Aerodrome</strong><br>
              <small data-i18n="guides.airspaceControl.controlled.guide">Select if: Requires ATC clearance</small>
            </span>
          </label>
        </div>
        <div id="distanceToAerodromeRow" style="display:none;">
          <label>
            <span data-i18n="missionPlanner.aerodromeProximity.distanceKm">Distance to Aerodrome (km)</span>
            <input id="distanceToAerodromeKm" type="number" min="0" step="0.1" data-i18n-placeholder="missionPlanner.aerodromeProximity.distancePlaceholder" placeholder="e.g. 3.5" onchange="updateARC()" style="margin-left:8px;" />
          </label>
          <div style="font-size:11px; color:#8d6e63; margin-top:4px; padding:6px; background:#fff3e0; border-radius:4px;" data-i18n="help.aerodromeProximity.note">For SORA 2.5 we use kilometers (km) for aerodrome proximity.</div>
        </div>
      </div>

      <!-- SORA 2.5 SPECIFIC ARC FIELDS - STYLED BY SONNET 4 -->
      <div id="arc25Fields" style="display:none; background:#e3f2fd; padding:16px; border-radius:8px; margin-top:12px; border:2px solid #2196f3;">
  <strong style="color:#0d47a1; font-size:16px; display:block; margin-bottom:16px;">
    ğŸ›°ï¸ SORA 2.5 Enhanced ARC Strategic Mitigations
  </strong>
  
  <!-- Field 1: U-space Services Available -->
  <label style="display:block; margin-bottom:16px;">
    <strong style="display:block; margin-bottom:6px; color:#1976d2;">U-space Services Available</strong>
    <select id="uSpaceServices" style="width:100%; padding:8px; border:1px solid #90caf9; border-radius:4px; font-size:14px;">
      <option value="false">No - Standard airspace operations</option>
      <option value="true">Yes - U-space services available and used</option>
    </select>
    <small style="display:block; color:#555; margin-top:6px; line-height:1.4;">
      ğŸ’¡ U-space services provide digital aviation support including geofencing, tracking, and conflict detection.<br>
      <strong>Reference:</strong> JAR_doc_34 (Annex H) - SORA Safety Services
    </small>
  </label>
  
  <!-- Field 2: Traffic Density Data Source -->
  <label style="display:block; margin-bottom:16px;">
    <strong style="display:block; margin-bottom:6px; color:#1976d2;">Traffic Density Data Source</strong>
    <select id="trafficDensitySource" style="width:100%; padding:8px; border:1px solid #90caf9; border-radius:4px; font-size:14px;">
      <option value="Empirical">Empirical - Direct observation (Highest reliability)</option>
      <option value="Statistical">Statistical - Historical data analysis (Medium reliability)</option>
      <option value="Expert">Expert - Expert judgment (Low density only)</option>
    </select>
    <small style="display:block; color:#555; margin-top:6px; line-height:1.4;">
      âš ï¸ <strong>Expert judgment is only valid for low traffic density areas</strong> and requires substantiation.<br>
      <strong>Reference:</strong> JAR_doc_25 Step #4 - Determination of Initial ARC
    </small>
  </label>
  
  <!-- Field 3: Airspace Containment -->
  <label style="display:block; margin-bottom:16px;">
    <strong style="display:block; margin-bottom:6px; color:#1976d2;">Airspace Containment</strong>
    <select id="airspaceContainment25" style="width:100%; padding:8px; border:1px solid #90caf9; border-radius:4px; font-size:14px;">
      <option value="None">None - No airspace restrictions</option>
      <option value="Operational">Operational - Temporary restrictions (NOTAMs, ANSP coordination)</option>
      <option value="Certified">Certified - Permanent segregated airspace (Highest assurance)</option>
    </select>
    <small style="display:block; color:#555; margin-top:6px; line-height:1.4;">
      ğŸ’¡ Higher containment levels provide greater ARC reduction but require ANSP coordination and approval.<br>
      <strong>Reference:</strong> JAR_doc_25 Step #5 - Application of Strategic Mitigations
    </small>
  </label>
  
  <!-- Fields 4 & 5: Segregation Checkboxes (Styled Container) -->
  <div style="background:#f5f5f5; padding:14px; border-radius:6px; margin-top:12px; border:1px solid #bdbdbd;">
    <strong style="display:block; margin-bottom:12px; color:#0d47a1; font-size:15px;">
      Strategic Segregation Mitigations
    </strong>
    
    <!-- Temporal Segregation Checkbox -->
    <label style="display:flex; align-items:flex-start; margin-bottom:14px; cursor:pointer; padding:10px; background:#ffffff; border-radius:4px; border:1px solid #e0e0e0; transition:background 0.2s;">
      <input type="checkbox" id="temporalSegregation" value="true" 
             style="width:20px; height:20px; margin-right:12px; margin-top:2px; cursor:pointer; flex-shrink:0;" />
      <span style="font-size:14px; line-height:1.5;">
        <strong style="color:#1976d2;">Temporal Segregation</strong><br>
        <small style="color:#666;">
          Operation conducted during time periods when manned aviation activity is significantly reduced or absent 
          (e.g., night operations, outside business hours, or during weather prohibitive to VFR).
        </small>
      </span>
    </label>
    
    <!-- Spatial Segregation Checkbox -->
    <label style="display:flex; align-items:flex-start; cursor:pointer; padding:10px; background:#ffffff; border-radius:4px; border:1px solid #e0e0e0; transition:background 0.2s;">
      <input type="checkbox" id="spatialSegregation" value="true" 
             style="width:20px; height:20px; margin-right:12px; margin-top:2px; cursor:pointer; flex-shrink:0;" />
      <span style="font-size:14px; line-height:1.5;">
        <strong style="color:#1976d2;">Spatial Segregation</strong><br>
        <small style="color:#666;">
          Operation conducted in airspace with defined boundaries that separate it from manned aviation traffic 
          (e.g., below minimum safe altitude, designated UAS zones, or lateral separation from airways).
        </small>
      </span>
    </label>
    
    <!-- Validation Warning Box -->
    <div style="margin-top:12px; padding:10px; background:#fff3cd; border-left:4px solid #ffc107; border-radius:4px; font-size:13px; line-height:1.5;">
      âš ï¸ <strong style="color:#856404;">Validation Required:</strong>
      <span style="color:#856404;">
        Both segregation types require documented procedures, evidence of reduced exposure, 
        and validation in your Concept of Operations (ConOps). ANSP coordination may be required.
      </span>
    </div>
    
    <small style="display:block; color:#666; margin-top:10px; font-size:12px;">
      <strong>Reference:</strong> SORA 1.0 Annex C (Strategic Mitigations) - Operational Restrictions
    </small>
  </div>
  
  <!-- Information Box with Correct JARUS References -->
  <div style="margin-top:16px; padding:12px; background:#e8f5e9; border-left:4px solid #4caf50; border-radius:4px;">
    <strong style="color:#2e7d32; font-size:14px;">âœ… SORA 2.5 Enhanced ARC Strategic Mitigations</strong><br>
    <small style="color:#555; line-height:1.5; display:block; margin-top:6px;">
      These fields are specific to <strong>SORA 2.5 ONLY</strong> per JARUS Main Body (JAR_doc_25) Step #5 and 
      supporting annexes. They represent enhanced strategic mitigations introduced in SORA 2.5.<br><br>
      <strong style="color:#c62828;">âš ï¸ Not applicable to SORA 2.0 AMC.</strong> 
      If you need these strategic mitigations, you must use the SORA 2.5 category.
    </small>
    <div style="margin-top:10px; padding-top:10px; border-top:1px solid #a5d6a7; font-size:12px; color:#666;">
      ğŸ“š <strong>Official References:</strong><br>
      â€¢ JAR_doc_25 (Main Body 2.5, Edition 22.11.2024) - Step #4 and Step #5<br>
      â€¢ JAR_doc_34 (Annex H) - SORA Safety Services (U-space)<br>
      â€¢ Annex C (v1.0) - Strategic Mitigations Collision Risk Assessment
    </div>
  </div>
</div>

      <div class="grid">
        <div>
          <label>Strategic Mitigations (csv)
            <span class="help-icon" data-i18n="help.strategicMitigations" data-i18n-attr="title" title="?">?</span>
            <input id="strategicMitigations" type="text" placeholder="SM1,SM2" />
          </label>
        </div>
        <div>
          <label>Atypical Segregated Area
            <span class="help-icon" data-i18n="help.isAtypicalSegregated" data-i18n-attr="title" title="?">?</span>
            <select id="isAtypicalSegregated">
              <option value="true" data-i18n="dropdown.isAtypicalSegregated.true">True</option>
              <option value="false" data-i18n="dropdown.isAtypicalSegregated.false">False</option>
            </select>
          </label>
        </div>
      </div>
    </fieldset>

    <!-- OSOs (SORA) - Auto-populated based on SAIL from backend response -->
    <fieldset id="osoSection" style="background:#f3e5f5; border:2px solid #9c27b0;">
      <legend style="color:#6a1b9a; font-weight:700;">ğŸ“‹ Operational Safety Objectives (OSOs)</legend>
      
      <div style="background:#fff; padding:12px; border-radius:8px; margin-bottom:12px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
          <strong style="color:#6a1b9a;">Required OSOs (Based on SAIL Level)</strong>
          <span id="sailIndicator" style="padding:4px 12px; background:#e1bee7; border:1px solid #9c27b0; border-radius:16px; font-weight:600; color:#4a148c;">
            Pending SAIL calculation...
          </span>
        </div>
        <div id="osoGrid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:8px; margin-top:12px;">
          <div style="text-align:center; color:#999; padding:20px;">
            Run evaluation to see required OSOs
          </div>
        </div>
      </div>
      
      <!-- Hidden textarea for API compatibility -->
      <textarea id="osos" style="display:none;"></textarea>
      
      <details style="margin-top:8px;">
        <summary style="cursor:pointer; color:#6a1b9a; font-weight:600;">ğŸ”§ Advanced: Manual OSO Override</summary>
        <div style="margin-top:8px; padding:8px; background:#fff9c4; border:1px solid #fbc02d; border-radius:4px;">
          <label style="font-size:13px; color:#666;">
            Manual OSO CSV (overrides auto-selection)
            <textarea id="ososManual" rows="2" placeholder="1:Low,3:Low,7:Low,8:Low,..." style="margin-top:4px; font-family:monospace;"></textarea>
          </label>
        </div>
      </details>
    </fieldset>

    <!-- Actions -->
    <fieldset>
      <legend>Actions</legend>
      <button id="runBtn" type="button" data-i18n="missionPlanner.actions.execute" 
              aria-label="Run SORA evaluation with current inputs" 
              title="Execute risk assessment based on selected operation category"
              style="background:linear-gradient(135deg,#2196f3,#1976d2);color:white;border:none;padding:12px 24px;border-radius:6px;font-size:16px;font-weight:600;cursor:pointer;box-shadow:0 2px 4px rgba(33,150,243,0.3);transition:all 0.2s;">
        â–¶ï¸ Run Evaluation
      </button>
    </fieldset>

    <!-- Results -->
    <fieldset>
      <legend data-i18n="missionPlanner.results.title">Results</legend>
      <div class="grid">
        <div class="result-box">
          <strong>Status</strong>
          <div id="status" role="status" aria-live="polite">-</div>
        </div>
        <div class="result-box">
          <strong>Summary</strong>
          <div id="summary" role="status" aria-live="polite">-</div>
        </div>
      </div>
      <div class="result-box">
        <strong>Warnings</strong>
        <div id="warnings" role="alert" aria-live="assertive"></div>
      </div>
      <!-- Professional 2-Column Results Layout: Initial vs Final -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
        
        <!-- Initial Assessment Column (Blue Theme) -->
        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border: 2px solid #2196f3; border-radius: 12px; padding: 16px; box-shadow: 0 4px 8px rgba(33,150,243,0.2);">
          <h3 style="margin: 0 0 12px 0; color: #0d47a1; font-size: 18px; border-bottom: 2px solid #2196f3; padding-bottom: 8px;" data-i18n="missionPlanner.results.initialAssessment">
            ğŸ“‹ Initial Assessment
          </h3>
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <div class="result-metric" style="background: #fff; border-left: 4px solid #1976d2; padding: 10px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
              <strong style="color: #0d47a1; font-size: 14px;" data-i18n="missionPlanner.results.iGRC">iGRC</strong>
              <span id="initialGRC" class="pill" style="background: #1976d2; color: #fff; padding: 6px 14px; border-radius: 16px; font-weight: 700; font-size: 16px; min-width: 50px; text-align: center;">-</span>
            </div>
            <div class="result-metric" style="background: #fff; border-left: 4px solid #1976d2; padding: 10px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
              <strong style="color: #0d47a1; font-size: 14px;" data-i18n="missionPlanner.results.initialARC">Initial ARC</strong>
              <span id="initialARC" class="pill" style="background: #1976d2; color: #fff; padding: 6px 14px; border-radius: 16px; font-weight: 700; font-size: 16px; min-width: 70px; text-align: center;">-</span>
            </div>
            <div class="result-metric" style="background: #fff; border-left: 4px solid #1976d2; padding: 10px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
              <strong style="color: #0d47a1; font-size: 14px;" data-i18n="missionPlanner.results.initialSAIL">Initial SAIL</strong>
              <span id="initialSAIL" class="pill" style="background: #1976d2; color: #fff; padding: 6px 14px; border-radius: 16px; font-weight: 700; font-size: 16px; min-width: 60px; text-align: center;">-</span>
            </div>
          </div>
        </div>

        <!-- Final Assessment Column (Green Theme) -->
        <div style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border: 2px solid #4caf50; border-radius: 12px; padding: 16px; box-shadow: 0 4px 8px rgba(76,175,80,0.2);">
          <h3 style="margin: 0 0 12px 0; color: #1b5e20; font-size: 18px; border-bottom: 2px solid #4caf50; padding-bottom: 8px;" data-i18n="missionPlanner.results.finalAssessment">
            âœ… Final Assessment (Post-Mitigations)
          </h3>
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <div class="result-metric" style="background: #fff; border-left: 4px solid #388e3c; padding: 10px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
              <strong style="color: #1b5e20; font-size: 14px;" data-i18n="missionPlanner.results.finalGRC">Final GRC</strong>
              <span id="finalGRC" class="pill" style="background: #388e3c; color: #fff; padding: 6px 14px; border-radius: 16px; font-weight: 700; font-size: 16px; min-width: 50px; text-align: center;">-</span>
            </div>
            <div class="result-metric" style="background: #fff; border-left: 4px solid #388e3c; padding: 10px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
              <strong style="color: #1b5e20; font-size: 14px;" data-i18n="missionPlanner.results.residualARC">Residual ARC</strong>
              <span id="finalARC" class="pill" style="background: #388e3c; color: #fff; padding: 6px 14px; border-radius: 16px; font-weight: 700; font-size: 16px; min-width: 70px; text-align: center;">-</span>
            </div>
            <div class="result-metric" style="background: #fff; border-left: 4px solid #388e3c; padding: 10px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
              <strong style="color: #1b5e20; font-size: 14px;" data-i18n="missionPlanner.results.finalSAIL">Final SAIL</strong>
              <span id="finalSAIL" class="pill" style="background: #388e3c; color: #fff; padding: 6px 14px; border-radius: 16px; font-weight: 700; font-size: 16px; min-width: 60px; text-align: center;">-</span>
            </div>
          </div>
        </div>

      </div>
      
      <!-- Quick Test Panel - JSON/Python Paste -->
      <details class="result-box" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; border:none; margin-bottom:15px;" open>
        <summary style="cursor:pointer; color:white; font-weight:700; font-size:16px; padding:10px;">
          ğŸš€ Quick Test - Paste JSON/Python Request
        </summary>
        <div style="padding:15px;">
          <div style="margin-bottom:10px; opacity:0.9; font-size:13px;">
            Paste your complete SORA request (JSON or Python dict format) and click Run Test
          </div>
          
          <textarea id="quickTestInput" 
                    placeholder='{
  "SoraVersion": "2.0",
  "DroneId": "DJI_MINI4PRO",
  "GroundRisk": {
    "MTOM_kg": 0.249,
    "Scenario_V2_0": "VLOS_Populated",
    "Mitigations": [
      {"Type": "M1", "Robustness": "Medium"},
      {"Type": "M2", "Robustness": "High"}
    ]
  },
  "AirRisk": {
    "AirspaceType": "Uncontrolled",
    "AdjacentAirspace": false,
    "AtcServiceAvailable": false,
    "TechnicalMitigations": []
  }
}'
                    style="width:100%; height:200px; padding:10px; border:2px solid rgba(255,255,255,0.3); 
                           border-radius:8px; font-family:Consolas,monospace; font-size:12px; 
                           background:rgba(255,255,255,0.95); color:#333; resize:vertical;"></textarea>
          
          <div style="display:flex; gap:10px; margin-top:10px;">
            <button onclick="runQuickTest()" 
                    style="flex:1; padding:12px; background:#4caf50; color:white; border:none; 
                           border-radius:6px; font-weight:700; cursor:pointer; font-size:14px;
                           box-shadow:0 4px 8px rgba(0,0,0,0.2); transition:all 0.2s;"
                    onmouseover="this.style.background='#45a049'; this.style.transform='translateY(-2px)';"
                    onmouseout="this.style.background='#4caf50'; this.style.transform='translateY(0)';">
              â–¶ï¸ Run Test
            </button>
            
            <button onclick="loadExampleTest('2.0')" 
                    style="padding:12px 20px; background:rgba(255,255,255,0.2); color:white; border:1px solid white; 
                           border-radius:6px; cursor:pointer; font-size:12px; transition:all 0.2s;"
                    onmouseover="this.style.background='rgba(255,255,255,0.3)';"
                    onmouseout="this.style.background='rgba(255,255,255,0.2)';">
              Example 2.0
            </button>
            
            <button onclick="loadExampleTest('2.5')" 
                    style="padding:12px 20px; background:rgba(255,255,255,0.2); color:white; border:1px solid white; 
                           border-radius:6px; cursor:pointer; font-size:12px; transition:all 0.2s;"
                    onmouseover="this.style.background='rgba(255,255,255,0.3)';"
                    onmouseout="this.style.background='rgba(255,255,255,0.2)';">
              Example 2.5
            </button>
            
            <button onclick="clearQuickTest()" 
                    style="padding:12px 20px; background:rgba(255,255,255,0.2); color:white; border:1px solid white; 
                           border-radius:6px; cursor:pointer; font-size:12px; transition:all 0.2s;"
                    onmouseover="this.style.background='rgba(255,255,255,0.3)';"
                    onmouseout="this.style.background='rgba(255,255,255,0.2)';">
              Clear
            </button>
          </div>
          
          <div id="quickTestStatus" style="margin-top:10px; padding:10px; border-radius:6px; display:none;"></div>
          <div id="quickTestResults" style="margin-top:10px; display:none;"></div>
        </div>
      </details>
      
      <details class="result-box" style="background:#fafafa;">
        <summary style="cursor:pointer; color:#555; font-weight:600;">Developer details (JSON)</summary>
        <pre id="json" style="margin-top:8px;">{}</pre>
      </details>
    </fieldset>

    <script>
  // Drone Selection Logic (optional UI)
  let dronesData = [];
  let currentDroneDetails = null; // detailed specs of the currently selected drone
      const droneModelSelect = document.getElementById('droneModel');
      const droneInfo = document.getElementById('droneInfo');

  async function updateDroneInfo() {
        if (!droneModelSelect || !droneInfo) return;
        const id = droneModelSelect.value;
        if (!id) { 
          droneInfo.style.display = 'none'; 
          if (typeof toggleManualMetrics === 'function') toggleManualMetrics(false);
          return; 
        }
        
        try {
          let d = null;
          // If this is a fallback drone, resolve locally without API
          if (id.startsWith('FALLBACK_') && Array.isArray(window.__fallbackDrones)) {
            d = window.__fallbackDrones.find(x => x.id === id) || null;
          } else {
            // Fetch detailed drone data from API
            const response = await fetch(`http://localhost:5210/api/drones/${id}`);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            d = await response.json();
          }
          currentDroneDetails = d;
          
          const setText = (elId, value) => { const el = document.getElementById(elId); if (el) el.textContent = value; };
          setText('droneManufacturer', d.manufacturer || '-');
          setText('droneCClass', d.cClass || '-');
          setText('droneMTOM', d.mTOM_kg ?? '-');
          setText('droneCharDim', d.characteristicDimension_m ?? '-');
          setText('droneMaxSpeed', d.maxSpeed_mps ?? '-');
          
          // Compute KE: 0.5 * m * v^2
          let ke = null;
          const mass = d.mTOM_kg;
          const v = d.maxSpeed_mps;
          if (mass != null && v != null && mass >= 0 && v >= 0) {
            ke = 0.5 * mass * v * v;
          }
          setText('droneKE', (ke !== null && !isNaN(ke)) ? Math.round(ke) : '-');
          
          // Autofill SORA inputs if present
          const md25 = document.getElementById('maxDimension');
          const ms25 = document.getElementById('maxSpeed');
          const md20 = document.getElementById('maxDimension20');
          const mtom20 = document.getElementById('mtom20');
          const ke20Display = document.getElementById('kineticEnergy20Display');
          
          // NEW: Auto-populate manual override fields
          const maxDimManual = document.getElementById('maxDimensionManual');
          const cruiseSpeedManual = document.getElementById('cruiseSpeedManual');
          
          if (md25 && d.characteristicDimension_m != null) {
            md25.value = d.characteristicDimension_m;
          }
          if (ms25 && d.maxSpeed_mps != null) {
            ms25.value = d.maxSpeed_mps;
          }
          if (md20 && d.characteristicDimension_m != null) {
            md20.value = d.characteristicDimension_m;
          }
          if (mtom20 && d.mTOM_kg != null) {
            mtom20.value = d.mTOM_kg;
          }
          if (ke20Display && ke !== null && !isNaN(ke)) {
            ke20Display.innerHTML = `<strong>${Math.round(ke)} J</strong>`;
          }
          
          // NEW: Auto-populate manual override fields
          if (maxDimManual && d.characteristicDimension_m != null) {
            maxDimManual.value = d.characteristicDimension_m;
            maxDimManual.placeholder = `${d.characteristicDimension_m}m (from ${d.model})`;
          }
          if (cruiseSpeedManual && d.maxSpeed_mps != null) {
            cruiseSpeedManual.value = d.maxSpeed_mps;
            cruiseSpeedManual.placeholder = `${d.maxSpeed_mps} m/s (from ${d.model})`;
          }
          
          // Update KE display for SORA 2.0 (if present)
          if (ke20Display && ke !== null && !isNaN(ke)) {
            const keRounded = Math.round(ke);
            let threshold = '';
            if (keRounded < 700) threshold = '<700J (1m class)';
            else if (keRounded < 34000) threshold = '<34KJ (3m class)';
            else if (keRounded < 1084000) threshold = '<1084KJ (8m class)';
            else threshold = '>1084KJ (>8m class)';
            ke20Display.innerHTML = `<strong>${keRounded} J</strong><br><span style="font-size:13px;">${threshold}</span>`;
          }
          
          droneInfo.style.display = 'block';
          if (typeof toggleManualMetrics === 'function') toggleManualMetrics(true);
          
          // Trigger iGRC and ARC updates
          if (typeof updateiGRC === 'function') updateiGRC();
          if (typeof updateARC === 'function') updateARC();
          if (typeof calculateGRC20 === 'function') calculateGRC20();
          if (typeof calculateGRC25 === 'function') calculateGRC25();
          
          console.log('[Drone Auto-Fill] Drone selected:', d.model);
          console.log('[Drone Auto-Fill] MTOM:', d.mTOM_kg, 'kg | Max Speed:', d.maxSpeed_mps, 'm/s | KE:', ke, 'J');
        } catch (err) {
          console.error('[Drone Auto-Fill] Failed to fetch drone details:', err);
          droneInfo.style.display = 'none';
        }
      }

      // Show/hide Distance to Aerodrome when 'Near Aerodrome' is toggled
      function updateAerodromeProximityUI() {
        const near = document.getElementById('isNearAerodrome');
        const row = document.getElementById('distanceToAerodromeRow');
        const input = document.getElementById('distanceToAerodromeKm');
        if (!near || !row || !input) return;
        const show = !!near.checked;
        row.style.display = show ? 'block' : 'none';
        if (!show) input.value = '';
      }

      // Load drones only if the selector exists on the page
      (async function loadDrones() {
        if (!droneModelSelect) { console.warn('[mission] Drone selector not present, skipping drone load'); return; }
        try {
          const response = await fetch('http://localhost:5210/api/drones/dropdown');
          const data = await response.json();
          dronesData = data.drones || [];

          // Populate dropdown - keep the default option from HTML
          droneModelSelect.innerHTML = '<option value="">âš™ï¸ Manual Input (Other)</option>';
          dronesData.forEach(d => {
            const option = document.createElement('option');
            option.value = d.id;
            option.textContent = d.displayName + ` (${d.cClass})`;
            droneModelSelect.appendChild(option);
          });
          droneModelSelect.addEventListener('change', updateDroneInfo);
          console.log('[Drone Load] Loaded', dronesData.length, 'drones successfully');
        } catch (err) {
          console.error('[Drone Load] Failed to load drones:', err);
          console.warn('[Drone Load] Backend API not available. Loading fallback sample drones.');
          // Provide a small local fallback so users can test calculations offline
          window.__fallbackDrones = [
            { id:'FALLBACK_DJI_MINI_2', manufacturer:'DJI', model:'Mini 2', cClass:'C0', mTOM_kg:0.249, characteristicDimension_m:0.245, maxSpeed_mps:16, notes:'Fallback sample' },
            { id:'FALLBACK_DJI_MAVIC_3', manufacturer:'DJI', model:'Mavic 3', cClass:'C2', mTOM_kg:0.9, characteristicDimension_m:0.35, maxSpeed_mps:19, notes:'Fallback sample' },
            { id:'FALLBACK_M300', manufacturer:'DJI', model:'Matrice 300 RTK', cClass:'C3', mTOM_kg:6.3, characteristicDimension_m:0.66, maxSpeed_mps:23, notes:'Fallback sample' }
          ];
          dronesData = window.__fallbackDrones.map(d => ({
            id: d.id, displayName: `${d.manufacturer} ${d.model}`, cClass: d.cClass
          }));
          droneModelSelect.innerHTML = '<option value="">âš™ï¸ Manual Input (Other)</option>';
          dronesData.forEach(d => {
            const option = document.createElement('option');
            option.value = d.id; option.textContent = d.displayName + ` (${d.cClass})`;
            droneModelSelect.appendChild(option);
          });
          droneModelSelect.addEventListener('change', updateDroneInfo);
          // Show an inline tip
          const tip = document.createElement('div');
          tip.style = 'font-size:12px; color:#c62828; margin-top:6px;';
          tip.textContent = 'API not running â€“ using sample drones. For full catalog start the Backend (Skyworks.Api).';
          droneModelSelect.parentElement.appendChild(tip);
        }
      })();

      // ===== Auto Mission ID Generation =====
      // Enable manual edit toggles for auto-filled fields
      (function setupManualToggles(){
        const dim = document.getElementById('maxDimension');
        const spd = document.getElementById('maxSpeed');
        const t1 = document.getElementById('editMaxDim');
        const t2 = document.getElementById('editMaxSpeed');
        if (t1 && dim) t1.addEventListener('change', () => { dim.disabled = !t1.checked; });
        if (t2 && spd) t2.addEventListener('change', () => { spd.disabled = !t2.checked; });
        // Initialize manual metrics visibility based on current selection
        if (typeof toggleManualMetrics === 'function') {
          const selectedId = document.getElementById('droneModel')?.value;
          toggleManualMetrics(!!selectedId);
        }
      })();
      // Show/hide manual SORA 2.5 metrics when a drone is selected
      function toggleManualMetrics(droneSelected) {
        const block = document.getElementById('manualMetrics25');
        if (!block) return;
        // If a drone is selected, hide manual inputs to avoid duplicate entry; else show them
        block.style.display = droneSelected ? 'none' : 'grid';
      }
      function generateNewMissionId() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        
        // Get sequential number from localStorage
        const storageKey = `skyworks_mission_seq_${year}${month}${day}`;
        let seq = parseInt(localStorage.getItem(storageKey) || '0') + 1;
        localStorage.setItem(storageKey, String(seq));
        
        const missionId = `M-${year}${month}${day}-${hours}${minutes}-${String(seq).padStart(3, '0')}`;
        const missionIdField = document.getElementById('missionId');
        if (missionIdField) {
          missionIdField.value = missionId;
        }
        return missionId;
      }

      // Auto-generate Mission ID on page load
      window.addEventListener('DOMContentLoaded', () => {
        const missionIdField = document.getElementById('missionId');
        if (missionIdField && !missionIdField.value) {
          generateNewMissionId();
        }
        
        // Start live clock (DD/MM/YYYY HH:mm:ss)
        const clockEl = document.getElementById('liveClock');
        if (clockEl) {
          const two = n => String(n).padStart(2,'0');
          const tick = () => {
            const now = new Date();
            const d = two(now.getDate());
            const m = two(now.getMonth()+1);
            const y = now.getFullYear();
            const hh = two(now.getHours());
            const mm = two(now.getMinutes());
            const ss = two(now.getSeconds());
            clockEl.textContent = `${d}/${m}/${y} ${hh}:${mm}:${ss}`;
          };
          tick();
          setInterval(tick, 1000);
        }

        // Run initial calculations to show the boxes
        console.log('[Init] Running initial mitigation calculations...');
        setTimeout(() => {
          if (typeof calculateGRC20 === 'function') calculateGRC20();
          if (typeof calculateGRC25 === 'function') calculateGRC25();
          if (typeof updateiGRC === 'function') updateiGRC();
          if (typeof updateARC === 'function') updateARC();
          if (typeof updateSAILPanel === 'function') updateSAILPanel();
        }, 100);
      });

      // ===== SORA 2.0 GRC Calculation (per JAR_doc_06 Table 3) =====
      function calculateGRC20() {
        // âœ… FIXED: Initialize window.soraResult early to prevent ReferenceError
        if (!window.soraResult) {
          window.soraResult = null;
        }
        
        const m1 = parseInt(document.getElementById('m1_20')?.value || '0');
        const m2 = parseInt(document.getElementById('m2_20')?.value || '0');
        const m3 = parseInt(document.getElementById('m3_20')?.value || '1');
        
        // âœ… FIXED: Use m2_value from API response if available, otherwise use dropdown value
        const m2Value = (window.soraResult && window.soraResult.m2_value !== undefined) 
          ? window.soraResult.m2_value 
          : m2;
        
        // Prefer detailed specs fetched from API (currentDroneDetails)
        const d = currentDroneDetails;
        
        const totalReduction = m1 + m2Value + m3;
        const calcBox = document.getElementById('grc20Calculation');
        const calcDetails = document.getElementById('grc20CalcDetails');
        
        if (calcBox && calcDetails) {
          calcBox.style.display = 'block';
          let droneInfo = '';
          if (d) {
            const mass = (typeof d.mTOM_kg === 'number') ? d.mTOM_kg : undefined;
            const speed = (typeof d.maxSpeed_mps === 'number') ? d.maxSpeed_mps : undefined;
            const ke = (typeof mass === 'number' && typeof speed === 'number') ? (0.5 * mass * speed * speed) : undefined;
            const displayName = `${d.manufacturer || ''} ${d.model || ''}`.trim() || (d.id || '');
            droneInfo = `
              <div style="background:#fff3e0; padding:8px; border-radius:4px; margin-bottom:8px; border:1px solid #ff9800;">
                <strong style="color:#e65100;">ğŸ“¦ Drone: ${displayName}</strong><br>
                <span style="font-size:12px; color:#666;">
                  MTOM: ${mass ?? '-'} kg | Max Speed: ${speed ?? '-'} m/s | KE: ${ke != null ? Math.round(ke) : '-'} J<br>
                  <em>Î¤Î¿ Kinetic Energy ÎµÏ€Î·ÏÎµÎ¬Î¶ÎµÎ¹ Ï„Î¿ initial GRC (ÏŒÏƒÎ¿ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿, Ï„ÏŒÏƒÎ¿ Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ GRC)</em>
                </span>
              </div>
            `;
          }
          
          // âœ… CORRECTED: Safe m2 label retrieval (JARUS SORA 2.0 AMC)
          let m2Label = 'Impact reduction';
          if (window.soraResult && window.soraResult.m2) {
            m2Label = window.soraResult.m2;
          } else {
            // Fallback: derive label from dropdown value (M2: None/Medium/High ONLY)
            if (m2 === 0) m2Label = 'None';
            else if (m2 === -1) m2Label = 'Medium';
            else if (m2 === -2) m2Label = 'High';
          }
          
          // âœ… ENHANCED: More detailed calculation display with API verification
          const apiVerification = (window.soraResult && window.soraResult.calculation) ? 
            `<br><small style="color:#1976d2;">âœ… API Verification: ${window.soraResult.calculation}</small>` : '';
          
          calcDetails.innerHTML = `
            ${droneInfo}
            <div style="font-family:monospace;">
              M1 (Strategic): <strong>${m1}</strong> GRC<br>
              M2 (${m2Label}): <strong>${m2Value}</strong> GRC<br>
              M3 (ERP): <strong>${m3}</strong> GRC<br>
              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>
              <strong style="font-size:16px;">Total Reduction: ${totalReduction} GRC</strong>${apiVerification}<br>
              <em style="font-size:12px; color:#666;">Applied sequentially per JARUS rules</em>
            </div>
          `;
        }
        // Refresh SAIL live panel
        try { if (typeof updateSAILPanel === 'function') updateSAILPanel(); } catch {}
      }

      // ===== OSO Requirements per SAIL (from SORA 2.5 Table 14 - JAR_doc_25) =====
      // SORA 2.0 OSO Requirements (24 OSOs total, from JARUS Table 6)
      const OSO_REQUIREMENTS_V20 = {
        'I': [
          {id: 3, name: 'UAS maintained by competent entity', req: 'L'},
          {id: 7, name: 'Inspection of UAS to keep it in safe state', req: 'L'},
          {id: 8, name: 'Operational procedures defined', req: 'L'},
          {id: 9, name: 'Remote crew trained and current', req: 'L'},
          {id: 10, name: 'Safe recovery from technical issue', req: 'L'},
          {id: 11, name: 'Handling deterioration of external systems', req: 'L'},
          {id: 12, name: 'UAS designed for deterioration', req: 'L'},
          {id: 13, name: 'External services supporting UAS adequate', req: 'L'},
          {id: 14, name: 'Operational procedures validated', req: 'L'},
          {id: 15, name: 'Remote crew trained/current', req: 'L'},
          {id: 16, name: 'Multi crew coordination', req: 'L'},
          {id: 17, name: 'Remote crew fit to operate', req: 'L'},
          {id: 21, name: 'Operational procedures for adverse conditions', req: 'L'},
          {id: 22, name: 'Crew trained for environmental conditions', req: 'L'},
          {id: 23, name: 'Environmental conditions defined', req: 'L'}
        ],
        'II': [
          {id: 1, name: 'Operator competent/proven', req: 'L'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'L'},
          {id: 6, name: 'C3 link appropriate', req: 'L'},
          {id: 7, name: 'Inspection of UAS', req: 'L'},
          {id: 8, name: 'Operational procedures defined', req: 'M'},
          {id: 9, name: 'Remote crew trained/current', req: 'L'},
          {id: 10, name: 'Safe recovery from technical issue', req: 'L'},
          {id: 11, name: 'Handling deterioration of external systems', req: 'L'},
          {id: 12, name: 'UAS designed for deterioration', req: 'L'},
          {id: 13, name: 'External services adequate', req: 'L'},
          {id: 14, name: 'Operational procedures validated', req: 'L'},
          {id: 15, name: 'Remote crew trained/current', req: 'L'},
          {id: 16, name: 'Multi crew coordination', req: 'L'},
          {id: 17, name: 'Remote crew fit to operate', req: 'L'},
          {id: 20, name: 'HMI appropriate for mission', req: 'L'},
          {id: 21, name: 'Operational procedures for adverse', req: 'L'},
          {id: 22, name: 'Crew trained environmental conditions', req: 'L'},
          {id: 23, name: 'Environmental conditions defined', req: 'L'}
        ],
        'III': [
          {id: 1, name: 'Operator competent/proven', req: 'M'},
          {id: 2, name: 'UAS manufactured by competent entity', req: 'L'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'M'},
          {id: 5, name: 'UAS designed with system safety', req: 'L'},
          {id: 6, name: 'C3 link appropriate', req: 'L'},
          {id: 7, name: 'Inspection of UAS', req: 'M'},
          {id: 8, name: 'Operational procedures defined', req: 'H'},
          {id: 9, name: 'Remote crew trained/current', req: 'M'},
          {id: 10, name: 'Safe recovery from technical issue', req: 'M'},
          {id: 11, name: 'Handling deterioration of external systems', req: 'M'},
          {id: 12, name: 'UAS designed for deterioration', req: 'M'},
          {id: 13, name: 'External services adequate', req: 'M'},
          {id: 14, name: 'Operational procedures validated', req: 'M'},
          {id: 15, name: 'Remote crew trained/current', req: 'M'},
          {id: 16, name: 'Multi crew coordination', req: 'M'},
          {id: 17, name: 'Remote crew fit to operate', req: 'M'},
          {id: 18, name: 'Auto protection from errors', req: 'L'},
          {id: 19, name: 'Safe recovery from error', req: 'L'},
          {id: 20, name: 'HMI appropriate for mission', req: 'L'},
          {id: 21, name: 'Operational procedures for adverse', req: 'M'},
          {id: 22, name: 'Crew trained environmental conditions', req: 'M'},
          {id: 23, name: 'Environmental conditions defined', req: 'M'},
          {id: 24, name: 'UAS qualified for adverse conditions', req: 'M'}
        ],
        'IV': [
          {id: 1, name: 'Operator competent/proven', req: 'H'},
          {id: 2, name: 'UAS manufactured by competent entity', req: 'M'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'M'},
          {id: 4, name: 'Components designed to ADS', req: 'L'},
          {id: 5, name: 'UAS designed with system safety', req: 'M'},
          {id: 6, name: 'C3 link appropriate', req: 'M'},
          {id: 7, name: 'Inspection of UAS', req: 'M'},
          {id: 8, name: 'Operational procedures defined', req: 'H'},
          {id: 9, name: 'Remote crew trained/current', req: 'M'},
          {id: 10, name: 'Safe recovery from technical issue', req: 'M'},
          {id: 11, name: 'Handling deterioration of external systems', req: 'H'},
          {id: 12, name: 'UAS designed for deterioration', req: 'H'},
          {id: 13, name: 'External services adequate', req: 'H'},
          {id: 14, name: 'Operational procedures validated', req: 'M'},
          {id: 15, name: 'Remote crew trained/current', req: 'M'},
          {id: 16, name: 'Multi crew coordination', req: 'M'},
          {id: 17, name: 'Remote crew fit to operate', req: 'M'},
          {id: 18, name: 'Auto protection from errors', req: 'M'},
          {id: 19, name: 'Safe recovery from error', req: 'M'},
          {id: 20, name: 'HMI appropriate for mission', req: 'M'},
          {id: 21, name: 'Operational procedures for adverse', req: 'H'},
          {id: 22, name: 'Crew trained environmental conditions', req: 'H'},
          {id: 23, name: 'Environmental conditions defined', req: 'M'},
          {id: 24, name: 'UAS qualified for adverse conditions', req: 'H'}
        ],
        'V': [
          {id: 1, name: 'Operator competent/proven', req: 'H'},
          {id: 2, name: 'UAS manufactured by competent entity', req: 'H'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'H'},
          {id: 4, name: 'Components designed to ADS', req: 'M'},
          {id: 5, name: 'UAS designed with system safety', req: 'H'},
          {id: 6, name: 'C3 link appropriate', req: 'H'},
          {id: 7, name: 'Inspection of UAS', req: 'H'},
          {id: 8, name: 'Operational procedures defined', req: 'H'},
          {id: 9, name: 'Remote crew trained/current', req: 'H'},
          {id: 10, name: 'Safe recovery from technical issue', req: 'H'},
          {id: 11, name: 'Handling deterioration of external systems', req: 'H'},
          {id: 12, name: 'UAS designed for deterioration', req: 'H'},
          {id: 13, name: 'External services adequate', req: 'H'},
          {id: 14, name: 'Operational procedures validated', req: 'H'},
          {id: 15, name: 'Remote crew trained/current', req: 'H'},
          {id: 16, name: 'Multi crew coordination', req: 'H'},
          {id: 17, name: 'Remote crew fit to operate', req: 'H'},
          {id: 18, name: 'Auto protection from errors', req: 'H'},
          {id: 19, name: 'Safe recovery from error', req: 'M'},
          {id: 20, name: 'HMI appropriate for mission', req: 'M'},
          {id: 21, name: 'Operational procedures for adverse', req: 'H'},
          {id: 22, name: 'Crew trained environmental conditions', req: 'H'},
          {id: 23, name: 'Environmental conditions defined', req: 'H'},
          {id: 24, name: 'UAS qualified for adverse conditions', req: 'H'}
        ],
        'VI': [
          {id: 1, name: 'Operator competent/proven', req: 'H'},
          {id: 2, name: 'UAS manufactured by competent entity', req: 'H'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'H'},
          {id: 4, name: 'Components designed to ADS', req: 'H'},
          {id: 5, name: 'UAS designed with system safety', req: 'H'},
          {id: 6, name: 'C3 link appropriate', req: 'H'},
          {id: 7, name: 'Inspection of UAS', req: 'H'},
          {id: 8, name: 'Operational procedures defined', req: 'H'},
          {id: 9, name: 'Remote crew trained/current', req: 'H'},
          {id: 10, name: 'Safe recovery from technical issue', req: 'H'},
          {id: 11, name: 'Handling deterioration of external systems', req: 'H'},
          {id: 12, name: 'UAS designed for deterioration', req: 'H'},
          {id: 13, name: 'External services adequate', req: 'H'},
          {id: 14, name: 'Operational procedures validated', req: 'H'},
          {id: 15, name: 'Remote crew trained/current', req: 'H'},
          {id: 16, name: 'Multi crew coordination', req: 'H'},
          {id: 17, name: 'Remote crew fit to operate', req: 'H'},
          {id: 18, name: 'Auto protection from errors', req: 'H'},
          {id: 19, name: 'Safe recovery from error', req: 'H'},
          {id: 20, name: 'HMI appropriate for mission', req: 'H'},
          {id: 21, name: 'Operational procedures for adverse', req: 'H'},
          {id: 22, name: 'Crew trained environmental conditions', req: 'H'},
          {id: 23, name: 'Environmental conditions defined', req: 'H'},
          {id: 24, name: 'UAS qualified for adverse conditions', req: 'H'}
        ]
      };

      // SORA 2.5 OSO Requirements (17 OSOs total, from JARUS Table 14)
      const OSO_REQUIREMENTS_V25 = {
        'I': [
          {id: 1, name: 'Operator competent/proven', req: 'NR'},
          {id: 2, name: 'UAS manufactured by competent entity', req: 'NR'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'L'},
          {id: 4, name: 'Components designed to ADS', req: 'NR'},
          {id: 5, name: 'UAS designed with system safety', req: 'NR'},
          {id: 6, name: 'C3 link appropriate', req: 'NR'},
          {id: 7, name: 'Conformity check of config', req: 'L'},
          {id: 8, name: 'Operational procedures defined', req: 'L'},
          {id: 9, name: 'Remote crew trained/current', req: 'L'},
          {id: 13, name: 'External services adequate', req: 'L'},
          {id: 16, name: 'Multi crew coordination', req: 'L'},
          {id: 17, name: 'Remote crew fit to operate', req: 'L'},
          {id: 18, name: 'Auto protection from errors', req: 'NR'},
          {id: 19, name: 'Safe recovery from error', req: 'NR'},
          {id: 20, name: 'HMI appropriate for mission', req: 'NR'},
          {id: 23, name: 'Environmental conditions defined', req: 'L'},
          {id: 24, name: 'UAS qualified for adverse conditions', req: 'NR'}
        ],
        'II': [
          {id: 1, name: 'Operator competent/proven', req: 'L'},
          {id: 2, name: 'UAS manufactured by competent entity', req: 'NR'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'L'},
          {id: 4, name: 'Components designed to ADS', req: 'NR'},
          {id: 5, name: 'UAS designed with system safety', req: 'NR'},
          {id: 6, name: 'C3 link appropriate', req: 'L'},
          {id: 7, name: 'Conformity check of config', req: 'L'},
          {id: 8, name: 'Operational procedures defined', req: 'M'},
          {id: 9, name: 'Remote crew trained/current', req: 'L'},
          {id: 13, name: 'External services adequate', req: 'L'},
          {id: 16, name: 'Multi crew coordination', req: 'L'},
          {id: 17, name: 'Remote crew fit to operate', req: 'L'},
          {id: 18, name: 'Auto protection from errors', req: 'NR'},
          {id: 19, name: 'Safe recovery from error', req: 'NR'},
          {id: 20, name: 'HMI appropriate for mission', req: 'L'},
          {id: 23, name: 'Environmental conditions defined', req: 'L'},
          {id: 24, name: 'UAS qualified for adverse conditions', req: 'NR'}
        ],
        'III': [
          {id: 1, name: 'Operator competent/proven', req: 'M'},
          {id: 2, name: 'UAS manufactured by competent entity', req: 'L'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'M'},
          {id: 4, name: 'Components designed to ADS', req: 'NR'},
          {id: 5, name: 'UAS designed with system safety', req: 'L'},
          {id: 6, name: 'C3 link appropriate', req: 'L'},
          {id: 7, name: 'Conformity check of config', req: 'M'},
          {id: 8, name: 'Operational procedures defined', req: 'H'},
          {id: 9, name: 'Remote crew trained/current', req: 'M'},
          {id: 13, name: 'External services adequate', req: 'M'},
          {id: 16, name: 'Multi crew coordination', req: 'M'},
          {id: 17, name: 'Remote crew fit to operate', req: 'M'},
          {id: 18, name: 'Auto protection from errors', req: 'L'},
          {id: 19, name: 'Safe recovery from error', req: 'L'},
          {id: 20, name: 'HMI appropriate for mission', req: 'L'},
          {id: 23, name: 'Environmental conditions defined', req: 'M'},
          {id: 24, name: 'UAS qualified for adverse conditions', req: 'M'}
        ],
        'IV': [
          {id: 1, name: 'Operator competent/proven', req: 'H'},
          {id: 2, name: 'UAS manufactured by competent entity', req: 'M'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'M'},
          {id: 4, name: 'Components designed to ADS', req: 'L'},
          {id: 5, name: 'UAS designed with system safety', req: 'M'},
          {id: 6, name: 'C3 link appropriate', req: 'M'},
          {id: 7, name: 'Conformity check of config', req: 'M'},
          {id: 8, name: 'Operational procedures defined', req: 'H'},
          {id: 9, name: 'Remote crew trained/current', req: 'M'},
          {id: 13, name: 'External services adequate', req: 'H'},
          {id: 16, name: 'Multi crew coordination', req: 'M'},
          {id: 17, name: 'Remote crew fit to operate', req: 'M'},
          {id: 18, name: 'Auto protection from errors', req: 'M'},
          {id: 19, name: 'Safe recovery from error', req: 'M'},
          {id: 20, name: 'HMI appropriate for mission', req: 'M'},
          {id: 23, name: 'Environmental conditions defined', req: 'M'},
          {id: 24, name: 'UAS qualified for adverse conditions', req: 'H'}
        ],
        'V': [
          {id: 1, name: 'Operator competent/proven', req: 'H'},
          {id: 2, name: 'UAS manufactured by competent entity', req: 'H'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'H'},
          {id: 4, name: 'Components designed to ADS', req: 'M'},
          {id: 5, name: 'UAS designed with system safety', req: 'H'},
          {id: 6, name: 'C3 link appropriate', req: 'H'},
          {id: 7, name: 'Conformity check of config', req: 'H'},
          {id: 8, name: 'Operational procedures defined', req: 'H'},
          {id: 9, name: 'Remote crew trained/current', req: 'H'},
          {id: 13, name: 'External services adequate', req: 'H'},
          {id: 16, name: 'Multi crew coordination', req: 'H'},
          {id: 17, name: 'Remote crew fit to operate', req: 'H'},
          {id: 18, name: 'Auto protection from errors', req: 'H'},
          {id: 19, name: 'Safe recovery from error', req: 'M'},
          {id: 20, name: 'HMI appropriate for mission', req: 'M'},
          {id: 23, name: 'Environmental conditions defined', req: 'H'},
          {id: 24, name: 'UAS qualified for adverse conditions', req: 'H'}
        ],
        'VI': [
          {id: 1, name: 'Operator competent/proven', req: 'H'},
          {id: 2, name: 'UAS manufactured by competent entity', req: 'H'},
          {id: 3, name: 'UAS maintained by competent entity', req: 'H'},
          {id: 4, name: 'Components designed to ADS', req: 'H'},
          {id: 5, name: 'UAS designed with system safety', req: 'H'},
          {id: 6, name: 'C3 link appropriate', req: 'H'},
          {id: 7, name: 'Conformity check of config', req: 'H'},
          {id: 8, name: 'Operational procedures defined', req: 'H'},
          {id: 9, name: 'Remote crew trained/current', req: 'H'},
          {id: 13, name: 'External services adequate', req: 'H'},
          {id: 16, name: 'Multi crew coordination', req: 'H'},
          {id: 17, name: 'Remote crew fit to operate', req: 'H'},
          {id: 18, name: 'Auto protection from errors', req: 'H'},
          {id: 19, name: 'Safe recovery from error', req: 'H'},
          {id: 20, name: 'HMI appropriate for mission', req: 'H'},
          {id: 23, name: 'Environmental conditions defined', req: 'H'},
          {id: 24, name: 'UAS qualified for adverse conditions', req: 'H'}
        ]
      };

      function renderOSOs(sail, soraVersion) {
        const sailIndicator = document.getElementById('sailIndicator');
        const osoGrid = document.getElementById('osoGrid');
        const ososField = document.getElementById('osos');
        
        // Determine SORA version (default to 2.5 if not specified)
        const version = soraVersion || 'SORA-2.5';
        
        // ===== USE CLASSIC OSO BADGE DESIGN =====
        // Simplified design with clickable badges showing full OSO text
        const isSORA20 = (version === 'SORA-2.0');
        const OSO_TABLE = isSORA20 ? OSO_REQUIREMENTS_V20 : OSO_REQUIREMENTS_V25;
        
        if (!sail || !OSO_TABLE[sail]) {
          osoGrid.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">Invalid SAIL level</div>';
          return;
        }
        
        const requirements = OSO_TABLE[sail];
        const totalOSOs = isSORA20 ? 24 : 17;
        const requiredCount = requirements.filter(o => o.req !== 'NR').length;
        
        sailIndicator.textContent = `SAIL ${sail} (${requiredCount}/${totalOSOs} OSOs)`;
        sailIndicator.style.background = sail === 'I' ? '#c8e6c9' : sail === 'II' ? '#fff9c4' : sail === 'III' ? '#ffccbc' : sail === 'IV' ? '#ffab91' : sail === 'V' ? '#ff8a65' : '#ff5252';
        sailIndicator.style.color = sail === 'I' || sail === 'II' ? '#1b5e20' : '#fff';
        
        console.log(`[OSO Display LEGACY] ${version} SAIL ${sail}: ${requiredCount}/${totalOSOs} OSOs required`);
        
        // Build OSO CSV for API
        const osoArray = [];
        
        osoGrid.innerHTML = requirements.map(oso => {
          const colorMap = {
            'NR': '#9e9e9e',
            'L': '#4caf50',
            'M': '#ff9800',
            'H': '#f44336'
          };
          const labelMap = (code) => {
            const fallback = { NR: 'Not Required', L: 'Low', M: 'Medium', H: 'High' };
            return fallback[code] || code;
          };
          
          // Get full OSO metadata if available
          const osoMeta = window.OSOManager && window.OSOManager.getOSOMetadata ? 
                          window.OSOManager.getOSOMetadata(oso.id) : null;
          const fullDescription = osoMeta ? osoMeta.description : oso.name;
          const category = osoMeta ? osoMeta.category : 'General';
          const categoryIcon = category === 'Technical' ? 'âš™ï¸' : 
                              category === 'Organizational' ? 'ğŸ¢' : 
                              category === 'Human Factors' ? 'ğŸ‘¥' : 'ğŸ“‹';
          
          // Map robustness codes to backend enum values
          const robustnessEnumMap = { 'NR': 'NotRequired', 'L': 'Low', 'M': 'Medium', 'H': 'High' };
          
          // Add to CSV (exclude NR)
          if (oso.req !== 'NR') {
            osoArray.push(`${oso.id}:${robustnessEnumMap[oso.req]}`);
          }
          
          return `
            <div class="oso-badge" 
                 style="padding:10px 14px; background:#fff; border-left:4px solid ${colorMap[oso.req]}; border-radius:6px; font-size:13px; cursor:pointer; transition:all 0.2s; box-shadow:0 1px 3px rgba(0,0,0,0.1);" 
                 tabindex="0" 
                 aria-label="${oso.name}"
                 onmouseenter="this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'; this.style.transform='translateY(-2px)'"
                 onmouseleave="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'"
                 onclick="showOSOModal(${oso.id}, '${oso.name.replace(/'/g, "\\'")}', '${fullDescription.replace(/'/g, "\\'")}', '${category}', '${labelMap(oso.req)}')" 
                 onkeypress="if(event.key==='Enter'){showOSOModal(${oso.id}, '${oso.name.replace(/'/g, "\\'")}', '${fullDescription.replace(/'/g, "\\'")}', '${category}', '${labelMap(oso.req)}')}">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
                <strong style="color:#333; font-size:14px;">${categoryIcon} OSO#${String(oso.id).padStart(2, '0')}</strong>
                <span style="padding:3px 10px; background:${colorMap[oso.req]}; color:#fff; border-radius:12px; font-size:11px; font-weight:600;">
                  ${labelMap(oso.req)}
                </span>
              </div>
              <div style="color:#666; font-size:12px; line-height:1.4;">${oso.name}</div>
              <div style="color:#999; font-size:11px; margin-top:4px;">ğŸ“– Click for full details</div>
            </div>
          `;
        }).join('');
        
        // Modal display function for full OSO details
        window.showOSOModal = function(osoId, name, description, category, robustness) {
          // Get full metadata if available
          const osoMeta = window.OSOManager && window.OSOManager.getOSOMetadata ? 
                          window.OSOManager.getOSOMetadata(osoId) : null;
          
          const categoryIcon = category === 'Technical' ? 'âš™ï¸' : 
                              category === 'Organizational' ? 'ğŸ¢' : 
                              category === 'Human Factors' ? 'ğŸ‘¥' : 'ğŸ“‹';
          
          // Build AMI examples list
          let amiList = '';
          if (osoMeta && osoMeta.ami_examples && osoMeta.ami_examples.length > 0) {
            amiList = '<div style="margin-top:12px;"><strong>ğŸ“‹ Acceptable Means of Implementation (AMI):</strong><ul style="margin:8px 0 0 20px; padding:0;">';
            osoMeta.ami_examples.forEach(ami => {
              amiList += `<li style="margin:4px 0;">${ami}</li>`;
            });
            amiList += '</ul></div>';
          }
          
          // Build JARUS reference
          const jarusRef = osoMeta && osoMeta.jarus_ref ? 
                          `<div style="margin-top:8px; font-size:12px; color:#666;">ğŸ“š <em>Reference: ${osoMeta.jarus_ref}</em></div>` : '';
          
          // Create modal overlay
          const modalHTML = `
            <div id="osoModal" style="position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.6); z-index:10000; display:flex; align-items:center; justify-content:center; padding:20px;" onclick="if(event.target.id==='osoModal') this.remove()">
              <div style="background:#fff; border-radius:12px; max-width:600px; width:100%; max-height:80vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,0,0,0.3); animation:slideIn 0.3s ease-out;" onclick="event.stopPropagation()">
                <div style="background:linear-gradient(135deg, #6a1b9a, #9c27b0); color:#fff; padding:20px; border-radius:12px 12px 0 0;">
                  <div style="display:flex; justify-content:space-between; align-items:start;">
                    <div>
                      <h2 style="margin:0 0 8px 0; font-size:24px;">${categoryIcon} OSO#${String(osoId).padStart(2, '0')}</h2>
                      <p style="margin:0; font-size:16px; opacity:0.9;">${name}</p>
                    </div>
                    <button onclick="document.getElementById('osoModal').remove()" style="background:rgba(255,255,255,0.2); border:none; color:#fff; font-size:24px; width:36px; height:36px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:background 0.2s;" onmouseenter="this.style.background='rgba(255,255,255,0.3)'" onmouseleave="this.style.background='rgba(255,255,255,0.2)'">Ã—</button>
                  </div>
                </div>
                
                <div style="padding:24px;">
                  <div style="display:inline-block; padding:6px 16px; background:${robustness === 'Low' ? '#4caf50' : robustness === 'Medium' ? '#ff9800' : robustness === 'High' ? '#f44336' : '#9e9e9e'}; color:#fff; border-radius:20px; font-weight:600; font-size:14px; margin-bottom:16px;">
                    Required Robustness: ${robustness}
                  </div>
                  
                  <div style="background:#f5f5f5; padding:16px; border-radius:8px; margin-bottom:16px;">
                    <strong style="color:#333; font-size:14px;">ğŸ“– Description:</strong>
                    <p style="margin:8px 0 0 0; line-height:1.6; color:#555;">${description}</p>
                  </div>
                  
                  <div style="background:#e3f2fd; padding:16px; border-radius:8px; margin-bottom:12px;">
                    <strong style="color:#1565c0; font-size:14px;">${categoryIcon} Category: ${category}</strong>
                  </div>
                  
                  ${amiList}
                  ${jarusRef}
                  
                  <div style="margin-top:20px; padding-top:16px; border-top:1px solid #eee; text-align:right;">
                    <button onclick="document.getElementById('osoModal').remove()" style="background:#9c27b0; color:#fff; border:none; padding:10px 24px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer; transition:background 0.2s;" onmouseenter="this.style.background='#7b1fa2'" onmouseleave="this.style.background='#9c27b0'">
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <style>
              @keyframes slideIn {
                from { transform: translateY(-50px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
              }
            </style>
          `;
          
          // Remove existing modal if any
          const existingModal = document.getElementById('osoModal');
          if (existingModal) existingModal.remove();
          
          // Add modal to body
          document.body.insertAdjacentHTML('beforeend', modalHTML);
        };
        
        // Remove old tooltip handlers
        document.querySelectorAll('.oso-tooltip').forEach(tip => tip.remove());
        
        // Update hidden field for API
        ososField.value = osoArray.join(',');
        console.log('[OSO] Auto-selected OSOs:', ososField.value);
      }

      // ===== SORA 2.5 iGRC Calculation (per JAR_doc_25 Table 5 & Annex B JAR_doc_27) =====
      function calculateGRC25() {
        const m1a = parseInt(document.getElementById('m1a_25')?.value || '0');
        const m1b = parseInt(document.getElementById('m1b_25')?.value || '0');
        const m1c = parseInt(document.getElementById('m1c_25')?.value || '0');
        const m2 = parseInt(document.getElementById('m2_25')?.value || '0');
        
        // Get iGRC (intrinsic GRC from Table 2)
        const iGRC = calculateiGRC();
        
        // Validate M1(A) Medium + M1(B) combination per JARUS Annex B 2.5
        const validationDiv = document.getElementById('m1Validation');
        let hasValidationError = false;
        if (m1a === -2 && m1b !== 0) {
          hasValidationError = true;
          if (validationDiv) {
            validationDiv.style.display = 'block';
            validationDiv.innerHTML = `
              <div style="background:#ffebee; border:1px solid #f44336; padding:12px; border-radius:6px; margin-top:8px;">
                <strong style="color:#c62828;">âš ï¸ VALIDATION ERROR (JARUS Annex B 2.5)</strong><br>
                <span style="font-size:13px; color:#d32f2f;">
                  M1(A) Medium (-2) CANNOT be combined with M1(B) (any level).<br>
                  Reason: To prevent double counting time-based restrictions.<br>
                  <em>Action: Set M1(A) to Low (-1) OR set M1(B) to None (0).</em>
                </span>
              </div>
            `;
          }
        } else {
          if (validationDiv) validationDiv.style.display = 'none';
        }
        
        // Calculate Final GRC = iGRC + mitigations (all negative values)
        let finalGRC = iGRC + m1a + m1b + m1c + m2;
        
        // Bounds check: Final GRC cannot be lower than controlled ground area value
        const popDensity = document.getElementById('populationDensity')?.value || 'controlled';
        // Use detailed specs if available, else fall back to manual inputs
        let maxDim = (currentDroneDetails && typeof currentDroneDetails.characteristicDimension_m === 'number')
          ? currentDroneDetails.characteristicDimension_m
          : parseFloat(document.getElementById('maxDimension')?.value || '0');
        let maxSpeed = (currentDroneDetails && typeof currentDroneDetails.maxSpeed_mps === 'number')
          ? currentDroneDetails.maxSpeed_mps
          : parseFloat(document.getElementById('maxSpeed')?.value || '0');
        
        let minGRC = 1; // Default for controlled ground
        if (maxDim <= 1 && maxSpeed <= 25) minGRC = 1;
        else if (maxDim <= 3 && maxSpeed <= 35) minGRC = 1;
        else if (maxDim <= 8 && maxSpeed <= 75) minGRC = 2;
        else if (maxDim <= 20 && maxSpeed <= 120) minGRC = 3;
        else if (maxDim <= 40 && maxSpeed <= 200) minGRC = 3;
        
        if (finalGRC < minGRC) {
          finalGRC = minGRC;
          console.warn(`[GRC25] Final GRC clamped to minimum (controlled ground area): ${minGRC}`);
        }
        
        // Bounds check: Final GRC > 7 is out of SORA scope
        let outOfScope = false;
        if (finalGRC > 7) {
          outOfScope = true;
          console.error('[GRC25] Final GRC > 7: OUT OF SORA SCOPE (Certified Category required)');
        }
        
        const totalReduction = m1a + m1b + m1c + m2;
        const calcBox = document.getElementById('grc25Calculation');
        const calcDetails = document.getElementById('grc25CalcDetails');
        
        if (calcBox && calcDetails) {
          calcBox.style.display = 'block';
          let errorMsg = '';
          if (outOfScope) {
            errorMsg = `
              <div style="background:#ffebee; border:2px solid #c62828; padding:12px; border-radius:6px; margin-top:8px;">
                <strong style="color:#c62828; font-size:16px;">ğŸš« OUT OF SORA SCOPE</strong><br>
                <span style="font-size:13px; color:#d32f2f;">
                  Final GRC = ${finalGRC} > 7<br>
                  This operation requires <strong>Certified Category</strong> approval.<br>
                  <em>Per JARUS SORA 2.5 Main Body: "A final GRC higher than 7 is out of the scope of SORA."</em>
                </span>
              </div>
            `;
          }
          calcDetails.innerHTML = `
            <div style="font-family:monospace;">
              <strong style="color:#0d47a1;">Initial iGRC (Table 2):</strong> <span style="font-size:18px; color:#1976d2;">${iGRC}</span><br><br>
              <strong>Mitigations Applied (Table 5):</strong><br>
              M1(A) (Sheltering): <strong>${m1a}</strong> iGRC<br>
              M1(B) (Operational restrictions): <strong>${m1b}</strong> iGRC<br>
              M1(C) (Ground observation): <strong>${m1c}</strong> iGRC<br>
              M2 (Impact dynamics): <strong>${m2}</strong> iGRC<br>
              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>
              <strong style="font-size:14px;">Total Reduction: ${totalReduction} iGRC</strong><br>
              <strong style="font-size:18px; color:${outOfScope ? '#c62828' : '#2e7d32'};">Final GRC: ${finalGRC}</strong>
              ${finalGRC === minGRC ? `<br><em style="font-size:11px; color:#666;">(Clamped to min: controlled ground area value)</em>` : ''}
              <br><br>
              <em style="font-size:12px; color:#666;">Calculations per JARUS SORA 2.5 Main Body (JAR_doc_25) & Annex B (JAR_doc_27)</em>
            </div>
            ${errorMsg}
          `;
        }
        // Refresh SAIL live panel
        try { if (typeof updateSAILPanel === 'function') updateSAILPanel(); } catch {}
      }

              function parseMitigations(csv, v) {
                if (!csv) return [];
                return csv.split(',').map(x => x.trim()).filter(Boolean).map(pair => {
                  const [t, r] = pair.split(':').map(s => (s||'').trim());
                  return { type: t, robustness: (r||'Low') };
                });
              }
              function parseOSOs(csv) {
                if (!csv) return [];
                return csv.split(',').map(x => x.trim()).filter(Boolean).map(pair => {
                  const [id, rob] = pair.split(':').map(s => (s||'').trim());
                  return { osoId: Number(id), achievedRobustness: (rob||'Low') };
                });
              }
              function parseList(csv) {
                if (!csv) return [];
                return csv.split(',').map(x => x.trim()).filter(Boolean);
              }

              // Category switching logic for SORA vs PDRA/STS
              function onCategoryChanged(category) {
                console.log('Category changed to:', category);

                const grc20 = document.getElementById('grc20');
                const grc25 = document.getElementById('grc25');
                const populationDensityField = document.getElementById('populationDensityField');
                const categoryFieldsContainer = document.getElementById('categoryFieldsContainer');
                const dynamicFieldsContent = document.getElementById('dynamicFieldsContent');
                const airRiskSection = document.getElementById('airRiskSection');
                const osoSection = document.getElementById('osoSection');

                // Handle legacy SORA 2.0/2.5 categories
                if (category === 'SORA-2.0') {
                  grc20.style.display = 'block';
                  grc25.style.display = 'none';
                  populationDensityField.style.display = 'none'; // HIDE population density for SORA 2.0
                  categoryFieldsContainer.style.display = 'none';
                  if (airRiskSection) airRiskSection.style.display = 'block';
                  if (osoSection) osoSection.style.display = 'block';
                  
                  // HIDE SORA 2.5 specific ARC fields
                  const arc25Fields = document.getElementById('arc25Fields');
                  if (arc25Fields) arc25Fields.style.display = 'none';
                  
                  updateiGRC(); // Recalculate iGRC for SORA 2.0
                  console.log('âœ… SORA 2.0: Showing scenario dropdown, hiding population density + ARC 2.5 fields');
                  try { if (typeof updateSAILPanel === 'function') updateSAILPanel(); } catch {}
                  return;
                }

                if (category === 'SORA-2.5') {
                  grc20.style.display = 'none';
                  grc25.style.display = 'block';
                  populationDensityField.style.display = 'block'; // SHOW population density for SORA 2.5
                  categoryFieldsContainer.style.display = 'none';
                  if (airRiskSection) airRiskSection.style.display = 'block';
                  if (osoSection) osoSection.style.display = 'block';
                  
                  // SHOW SORA 2.5 specific ARC fields (U-space, traffic density, containment)
                  const arc25Fields = document.getElementById('arc25Fields');
                  if (arc25Fields) arc25Fields.style.display = 'block';
                  
                  updateiGRC(); // Recalculate iGRC for SORA 2.5
                  console.log('âœ… SORA 2.5: Showing population density + ARC 2.5 fields, hiding scenario dropdown');
                  try { if (typeof updateSAILPanel === 'function') updateSAILPanel(); } catch {}
                  return;
                }

                // Hide SORA-specific fields for PDRA/STS categories
                grc20.style.display = 'none';
                grc25.style.display = 'none';
                populationDensityField.style.display = 'none'; // HIDE for PDRA/STS
                if (airRiskSection) airRiskSection.style.display = 'none';
                if (osoSection) osoSection.style.display = 'none';

                // Show category-specific fields container
                categoryFieldsContainer.style.display = 'block';

                // Render category-specific fields using CategoryHandler
                if (window.CategoryHandler) {
                  window.CategoryHandler.renderFields(category, dynamicFieldsContent);
                } else {
                  dynamicFieldsContent.innerHTML = '<p style="color:red">âš ï¸ CategoryHandler not loaded!</p>';
                }
                console.log(`âœ… ${category}: Showing pre-defined fields, hiding SORA fields`);
              }

              // Initialize on page load
              window.addEventListener('DOMContentLoaded', () => {
                const operationCategory = document.getElementById('operationCategory');
                if (operationCategory) {
                  onCategoryChanged(operationCategory.value);
                }
              });

              async function run() {
                const categorySelect = document.getElementById('operationCategory');
                const selectedCategory = categorySelect ? categorySelect.value : 'SORA-2.5';
                const droneId = (droneModelSelect && droneModelSelect.value) || undefined;

                const status = document.getElementById('status');
                const json = document.getElementById('json');
                const summary = document.getElementById('summary');
                const warnings = document.getElementById('warnings');
                const runBtn = document.getElementById('runBtn');

                // **LOADING STATE**
                status.innerHTML = '<span class="spinner"></span> <span style="color:#1976d2;font-weight:600">Running evaluation...</span>';
                summary.textContent = '';
                warnings.textContent = '';
                json.textContent = '';
                if (runBtn) {
                  runBtn.disabled = true;
                  runBtn.style.opacity = '0.6';
                  runBtn.style.cursor = 'not-allowed';
                }

                // **VALIDATION for PDRA/STS categories**
                if (!selectedCategory.startsWith('SORA-')) {
                  if (window.CategoryHandler && window.CategoryHandler.validateFields) {
                    const validation = window.CategoryHandler.validateFields(selectedCategory);
                    if (!validation.valid) {
                      status.innerHTML = '<span class="bad">âŒ Validation Failed</span>';
                      summary.innerHTML = '<div class="error-message"><strong>Please fix the following errors:</strong><ul>' + 
                        validation.errors.map(e => '<li>' + e + '</li>').join('') + '</ul></div>';
                      console.warn('[Validation] PDRA/STS validation failed:', validation.errors);
                      if (runBtn) {
                        runBtn.disabled = false;
                        runBtn.style.opacity = '1';
                        runBtn.style.cursor = 'pointer';
                      }
                      return;
                    }
                    if (validation.warnings && validation.warnings.length > 0) {
                      warnings.innerHTML = '<ul style="color:#ff9800;margin:8px 0;padding-left:20px;">' + 
                        validation.warnings.map(w => '<li>âš ï¸ ' + w + '</li>').join('') + '</ul>';
                      console.log('[Validation] Warnings:', validation.warnings);
                    }
                  }
                }

                // SORA flow
                if (selectedCategory === 'SORA-2.5' || selectedCategory === 'SORA-2.0') {
                  try {
                  const v = selectedCategory === 'SORA-2.5' ? '2.5' : '2.0';
                  const body = {
                    soraVersion: v,
                    missionId: document.getElementById('missionId').value || undefined,
                    missionName: document.getElementById('missionName').value || undefined,
                    droneId: droneId,
                    groundRisk: {},
                    airRisk: {},
                    implementedOSOs: parseOSOs(document.getElementById('osos').value)
                  };

                  if (v === '2.5') {
                    // Build SORA 2.5 mitigations from structured dropdowns
                    const mitigations25 = [];
                    const m1a = parseInt(document.getElementById('m1a_25')?.value || '0');
                    const m1b = parseInt(document.getElementById('m1b_25')?.value || '0');
                    const m1c = parseInt(document.getElementById('m1c_25')?.value || '0');
                    const m2 = parseInt(document.getElementById('m2_25')?.value || '0');
                    
                    // Map numeric values back to robustness levels for API
                    // âœ… CORRECTED: M1A Sheltering per JARUS SORA 2.5 Table 5
                    // M1A has ONLY: None (0) / Low (-1) - NO Medium!
                    if (m1a === -1) mitigations25.push({ type: 'M1A', robustness: 'Low' });
                    
                    if (m1b === -1) mitigations25.push({ type: 'M1B', robustness: 'Medium' });
                    else if (m1b === -2) mitigations25.push({ type: 'M1B', robustness: 'High' });
                    
                    if (m1c === -1) mitigations25.push({ type: 'M1C', robustness: 'Low' });
                    
                    if (m2 === -1) mitigations25.push({ type: 'M2', robustness: 'Medium' });
                    else if (m2 === -2) mitigations25.push({ type: 'M2', robustness: 'High' });
                    
                    body.groundRisk = {
                      populationDensity: Number(document.getElementById('populationDensity').value || 0),
                      // Derive controlled ground area from the selected population density option
                      // When "Controlled Ground Area" is selected, value === 'controlled'
                      isControlledGroundArea: (document.getElementById('populationDensity')?.value === 'controlled'),
                      maxCharacteristicDimension: Number(document.getElementById('maxDimension').value || 0),
                      maxSpeed: Number(document.getElementById('maxSpeed').value || 0),
                      mitigations: mitigations25
                    };
                  } else {
                    // Build SORA 2.0 mitigations from structured dropdowns
                    const mitigations20 = [];
                    const m1 = parseInt(document.getElementById('m1_20')?.value || '0');
                    const m2 = parseInt(document.getElementById('m2_20')?.value || '0');
                    const m3 = parseInt(document.getElementById('m3_20')?.value || '1');
                    
                    // Map numeric values back to robustness levels for API
                    // M1 - Strategic Mitigation (Reduce people at risk)
                    if (m1 === -1) mitigations20.push({ type: 'M1', robustness: 'Low' });
                    else if (m1 === -2) mitigations20.push({ type: 'M1', robustness: 'Medium' });
                    else if (m1 === -4) mitigations20.push({ type: 'M1', robustness: 'High' });
                    
                    // âœ… CORRECTED: M2 - Impact Reduction - JARUS SORA 2.0 AMC Annex F Table 3
                    // M2 has ONLY: None (0) / Medium (-1) / High (-2) - NO "Low" level!
                    if (m2 === -1) mitigations20.push({ type: 'M2', robustness: 'Medium' });  // Medium: -1 GRC
                    else if (m2 === -2) mitigations20.push({ type: 'M2', robustness: 'High' }); // High: -2 GRC
                    // Note: m2 === 0 means None (no mitigation)
                    
                    // M3 - Emergency Response Plan
                    if (m3 === 0) mitigations20.push({ type: 'M3', robustness: 'Medium' });
                    else if (m3 === -1) mitigations20.push({ type: 'M3', robustness: 'High' });
                    // Note: m3 === +1 means None (no mitigation), so we don't add it
                    
                    // Compute KE for SORA 2.0 (per JAR_doc_06 Table 2 guidance)
                    let ke20 = undefined;
                    if (currentDroneDetails) {
                      const mass = Number(currentDroneDetails.mTOM_kg);
                      const speed = Number(currentDroneDetails.maxSpeed_mps);
                      if (!isNaN(mass) && !isNaN(speed) && mass >= 0 && speed >= 0) {
                        ke20 = 0.5 * mass * speed * speed;
                      }
                    }
                    // If no drone selected or KE not computable, try to compute from manual inputs
                    // (This would require MTOM and maxSpeed fields for manual entry - future enhancement)
                    
                    // âœ… FIXED: Extract PopulationDensity from existing SORA 2.5 field or use safe default
                    const populationDensityElement = document.getElementById('populationDensity');
                    const populationDensity = populationDensityElement ? 
                        Number(populationDensityElement.value) || 5000 : 5000;

                    // âœ… FIXED: Extract Sheltering from existing field or use safe default
                    const shelteringElement = document.getElementById('sheltering');
                    const sheltering = shelteringElement ? shelteringElement.value || 'High' : 'High';
                    
                    body.groundRisk = {
                      scenario_V2_0: document.getElementById('scenario20').value,
                      maxCharacteristicDimension: Number(document.getElementById('maxDimension20').value || 0),
                      kineticEnergy: ke20 !== undefined ? Math.round(ke20) : undefined,
                      mitigations: mitigations20,
                      isControlledGroundArea: document.getElementById('controlledGround20')?.value === 'true' || false,
                      
                      // âœ… ADDED: Required fields for Backend API
                      populationDensity: populationDensity,
                      sheltering: sheltering
                    };
                  }

                  const explicitARC = document.getElementById('explicitARC').value;
                  body.airRisk = {
                    explicitARC: explicitARC || undefined,
                    airspaceControl: document.getElementById('airspaceControl').value,
                    airspaceClass: document.getElementById('airspaceClass')?.value || 'G',
                    locationType: document.getElementById('locationType').value,
                    environment: document.getElementById('environment').value,
                    typicality: document.getElementById('typicality').value,
                    maxHeightAGL: Number(document.getElementById('maxHeightAGL').value || 0),
                    maxHeightAMSL: Number(document.getElementById('maxHeightAMSL')?.value || 0),
                    isModeS_Veil: document.getElementById('isModeS')?.checked || false,
                    isTMZ: document.getElementById('isTMZ')?.checked || false,
                    // Aerodrome proximity (advisory)
                    isInCTR: document.getElementById('isInCtr')?.checked || false,
                    isNearAerodrome: document.getElementById('isNearAerodrome')?.checked || false,
                    distanceToAerodrome_km: (function(){
                      const v = document.getElementById('distanceToAerodromeKm')?.value;
                      return v ? Number(v) : undefined;
                    })(),
                    strategicMitigations: parseList(document.getElementById('strategicMitigations').value),
                    isAtypicalSegregated: document.getElementById('isAtypicalSegregated').value === 'true',
                    // NEW: Drone characteristics for GRC calculation
                    maxDimension: parseFloat(document.getElementById('maxDimensionManual')?.value || '0') || undefined,
                    cruiseSpeed: parseFloat(document.getElementById('cruiseSpeedManual')?.value || '0') || undefined
                  };

                  try {
                    console.log('[SORA Request Body]', JSON.stringify(body, null, 2));
                    const resp = await fetch('http://localhost:5210/api/sora/complete', {
                      method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body)
                    });
                    const data = await resp.json();
                    console.log('[SORA Response]', data);
                    json.textContent = JSON.stringify(data, null, 2);
                    
                    // Store SORA result globally for GRC calculation display
                    window.soraResult = data;
                    
                    if (resp.ok) {
                      status.innerHTML = `<span class="ok">${window.i18n.t('common.ok')}</span>`;
                      summary.textContent = data.summary || '';
                      
                      // **GREY CELL WARNING for SORA 2.5 assemblies**
                      const operationCategory = document.getElementById('operationCategory')?.value || 'SORA-2.5';
                      if (operationCategory === 'SORA-2.5') {
                        const popDensity = parseInt(document.getElementById('populationDensity')?.value || '0');
                        if (popDensity > 50000) {
                          const greyCellWarning = '<div style="background:#ffc107;border:2px solid #ff9800;padding:12px;margin:8px 0;border-radius:6px;color:#000;">' +
                            '<strong>âš ï¸ GREY CELL OPERATION DETECTED</strong><br>' +
                            '<span style="font-size:12px;">This operation involves assemblies > 50,000 people/kmÂ². Per JARUS SORA 2.5 Annex F Â§3.2, ' +
                            'additional regulatory scrutiny and enhanced mitigation measures are required for approval.</span>' +
                            '</div>';
                          if (data.warnings && data.warnings.length) {
                            warnings.innerHTML = greyCellWarning + data.warnings.map(w => `<span class="pill">${w}</span>`).join(' ');
                          } else {
                            warnings.innerHTML = greyCellWarning;
                          }
                        } else if (data.warnings && data.warnings.length) {
                          warnings.innerHTML = data.warnings.map(w => `<span class="pill">${w}</span>`).join(' ');
                        }
                      } else if (data.warnings && data.warnings.length) {
                        warnings.innerHTML = data.warnings.map(w => `<span class="pill">${w}</span>`).join(' ');
                      }
                      
                      // Support both snake_case and camelCase for backwards compatibility
                      document.getElementById('initialGRC').textContent = data.initial_grc ?? data.intrinsicGRC ?? data.initialGRC ?? '-';
                      document.getElementById('initialARC').textContent = data.initial_arc ?? data.initialARC ?? '-';
                      document.getElementById('initialSAIL').textContent = 'N/A';
                      document.getElementById('finalGRC').textContent = data.final_grc ?? data.finalGRC ?? '-';
                      document.getElementById('finalARC').textContent = data.residual_arc ?? data.residualARC ?? '-';
                      const finalSail = data.sail ?? data.SAIL ?? '-';
                      document.getElementById('finalSAIL').textContent = finalSail;
                      
                      // Auto-render OSOs based on SAIL with correct SORA version
                      if (finalSail && finalSail !== '-' && typeof renderOSOs === 'function') {
                        const operationCategory = document.getElementById('operationCategory')?.value || 'SORA-2.5';
                        renderOSOs(finalSail, operationCategory);
                        console.log(`[API Response] Rendering OSOs for ${operationCategory} SAIL ${finalSail}`);
                      }
                    } else {
                      status.innerHTML = `<span class="bad">âŒ ${window.i18n.t('missionPlanner.badRequest')}</span>`;
                      // Fix: errors might be array or string
                      const errorMsg = data.errors 
                        ? (Array.isArray(data.errors) ? data.errors.join(' | ') : String(data.errors))
                        : (data.error || window.i18n.t('missionPlanner.requestFailed'));
                      summary.innerHTML = '<div class="error-message"><strong>API Validation Error</strong><p>' + errorMsg + '</p></div>';
                      console.error('[API Validation]', data);
                      document.getElementById('initialGRC').textContent = '-';
                      document.getElementById('initialARC').textContent = '-';
                      document.getElementById('initialSAIL').textContent = 'N/A';
                      document.getElementById('finalGRC').textContent = '-';
                      document.getElementById('finalARC').textContent = '-';
                      document.getElementById('finalSAIL').textContent = '-';
                    }
                  } catch (e) {
                    status.innerHTML = `<span class="bad">âŒ ${window.i18n.t('common.error')}</span>`;
                    const isNetworkError = (e.message && e.message.includes('fetch')) || (e.name === 'TypeError');
                    
                    summary.innerHTML = '<div class="error-message">' +
                      '<strong>' + (isNetworkError ? 'ğŸŒ Network Connection Failed' : 'âš ï¸ Processing Error') + '</strong>' +
                      '<p>' + (e?.message || String(e)) + '</p>' +
                      (isNetworkError 
                        ? '<ul><li>Verify backend is running: <code>http://localhost:5210</code></li>' +
                          '<li>Check network connectivity</li>' +
                          '<li>Review browser console for details</li></ul>'
                        : '<p style="font-size:11px;color:#666;">See console for technical details</p>') +
                      '</div>';
                    console.error('[SORA API Error]', e);
                    
                    // Client-side fallback so user still sees values even if API is unreachable
                    try {
                      // Initial GRC (iGRC)
                      const iGRC = (typeof calculateiGRC === 'function') ? calculateiGRC() : undefined;
                      if (typeof iGRC !== 'undefined') {
                        document.getElementById('initialGRC').textContent = iGRC;
                      }

                      // Initial ARC (simplified)
                      const airspaceControl = document.getElementById('airspaceControl')?.value || 'Uncontrolled';
                      const environment = document.getElementById('environment')?.value || 'Rural';
                      const typicality = document.getElementById('typicality')?.value || 'Typical';
                      let arc = 'b';
                      if (typicality === 'Atypical') arc = 'a';
                      else if (airspaceControl === 'Controlled') arc = (environment === 'Urban' || environment === 'Industrial') ? 'd' : 'c';
                      else if (environment === 'Urban') arc = 'c';
                      document.getElementById('initialARC').textContent = `ARC-${arc}`;

                      // Final GRC (SORA 2.5 only)
                      if (selectedCategory === 'SORA-2.5') {
                        const m1a = parseInt(document.getElementById('m1a_25')?.value || '0');
                        const m1b = parseInt(document.getElementById('m1b_25')?.value || '0');
                        const m1c = parseInt(document.getElementById('m1c_25')?.value || '0');
                        const m2 = parseInt(document.getElementById('m2_25')?.value || '0');
                        let finalGRC = (typeof iGRC === 'number' ? iGRC : 0) + m1a + m1b + m1c + m2;
                        if (finalGRC > 7) {
                          // out of scope â€“ keep 7+ as is
                        }
                        document.getElementById('finalGRC').textContent = finalGRC;
                        // Residual ARC (keep same simplified initial for now)
                        document.getElementById('finalARC').textContent = `ARC-${arc}`;
                        // SAIL indicator not computed client-side here
                        document.getElementById('finalSAIL').textContent = '-';
                      }
                    } catch (fallbackErr) {
                      console.warn('[Run] Local fallback computation failed:', fallbackErr);
                    }
                  } finally {
                    // **RESTORE BUTTON STATE (SORA flow)**
                    const btnRestoreSORA = document.getElementById('runBtn');
                    if (btnRestoreSORA) {
                      btnRestoreSORA.disabled = false;
                      btnRestoreSORA.style.opacity = '1';
                      btnRestoreSORA.style.cursor = 'pointer';
                    }
                  }
                  } catch (soraError) {
                    console.error('[SORA Flow] Unexpected error:', soraError);
                    status.innerHTML = '<span class="bad">âŒ Error</span>';
                    summary.innerHTML = '<div class="error-message"><strong>SORA Flow Error</strong><p>' + 
                      (soraError?.message || String(soraError)) + '</p></div>';
                  }

                  return;
                }

                // PDRA/STS flow (authoritative fixed metrics)
                const base = {
                  category: selectedCategory,
                  missionId: document.getElementById('missionId').value || undefined,
                  description: document.getElementById('missionName').value || undefined,
                  droneId: droneId
                };

                // Read dynamic fields rendered by CategoryHandler
                const categoryDef = window.CategoryHandler && window.CategoryHandler.CATEGORIES[selectedCategory];
                const payload = { ...base };
                if (categoryDef && Array.isArray(categoryDef.fields)) {
                  const additional = {};
                  categoryDef.fields.forEach(f => {
                    const el = document.getElementById('field_' + f.name);
                    if (!el) return;
                    let val;
                    if (el.type === 'checkbox') val = el.checked;
                    else if (el.type === 'number') val = el.value ? Number(el.value) : undefined;
                    else val = el.value;

                    // Map to request model if recognized property name, else into AdditionalRequirements
                    const knownProps = [
                      'uasClass','maxDimension','mtom','controlledGroundArea','groundRiskBuffer','populationDensity',
                      'vlos','maxHeight','maxSpeed','flightRange','airspaceObservers','meteorologicalVisibility','launchRecoveryVlos',
                      'controlledAirspace','atcCoordination','tetheredOperation','tetherLength','automaticMode'
                    ];
                    if (knownProps.includes(f.name)) {
                      payload[f.name] = val;
                    } else {
                      additional[f.name] = String(val);
                    }
                  });
                  if (Object.keys(additional).length) payload['additionalRequirements'] = additional;
                }

                try {
                  const resp = await fetch('/api/pdra-sts/evaluate', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
                  });
                  const data = await resp.json();
                  json.textContent = JSON.stringify(data, null, 2);
                  if (resp.ok) {
                    status.innerHTML = `<span class="ok">${window.i18n.t('common.ok')}</span>`;
                    summary.textContent = `${selectedCategory} evaluation completed`;
                    // PDRA/STS: set final metrics directly from API (already final/fixed)
                    document.getElementById('initialGRC').textContent = '-';
                    document.getElementById('initialARC').textContent = '-';
                    document.getElementById('initialSAIL').textContent = 'N/A';
                    document.getElementById('finalGRC').textContent = data.grc ?? '-';
                    document.getElementById('finalARC').textContent = data.arc ?? '-';
                    document.getElementById('finalSAIL').textContent = data.sail ?? '-';
                  } else {
                    status.innerHTML = `<span class="bad">${window.i18n.t('missionPlanner.badRequest')}</span>`;
                    // Fix: errors might be array or string
                    const errorMsg = data.errors 
                      ? (Array.isArray(data.errors) ? data.errors.join(' | ') : String(data.errors))
                      : (data.error || window.i18n.t('missionPlanner.requestFailed'));
                    summary.textContent = errorMsg;
                    document.getElementById('initialGRC').textContent = '-';
                    document.getElementById('initialARC').textContent = '-';
                    document.getElementById('initialSAIL').textContent = 'N/A';
                    document.getElementById('finalGRC').textContent = '-';
                    document.getElementById('finalARC').textContent = '-';
                    document.getElementById('finalSAIL').textContent = '-';
                  }
                } catch (e) {
                  status.innerHTML = `<span class="bad">âŒ ${window.i18n.t('common.error')}</span>`;
                  const isNetworkError = (e.message && e.message.includes('fetch')) || (e.name === 'TypeError');
                  const errorHtml = '<div class="error-message">' +
                    '<strong>' + (isNetworkError ? 'ğŸŒ Network Error' : 'âš ï¸ Evaluation Error') + '</strong>' +
                    '<p>' + (e?.message || String(e)) + '</p>';
                  
                  if (isNetworkError) {
                    summary.innerHTML = errorHtml + 
                      '<ul><li>âœ… Check backend server is running (http://localhost:5210)</li>' +
                      '<li>âœ… Verify network connectivity</li>' +
                      '<li>âœ… Review browser console for details</li></ul></div>';
                  } else {
                    summary.innerHTML = errorHtml + '<p style="font-size:11px;color:#666;">Check console for technical details</p></div>';
                  }
                  console.error('[API Error]', e);
                } finally {
                  // **RESTORE BUTTON STATE**
                  const btnRestore = document.getElementById('runBtn');
                  if (btnRestore) {
                    btnRestore.disabled = false;
                    btnRestore.style.opacity = '1';
                    btnRestore.style.cursor = 'pointer';
                  }
                }
              }

              // Hook Run button
              (() => {
                const evalButton = document.getElementById('runBtn');
                if (evalButton) evalButton.addEventListener('click', run);
              })();

              // ===== NEW CALCULATION FUNCTIONS (EASA/JARUS SORA 2.5 Compliant) =====
      
              // Live SAIL panel updater (uses authoritative SAILCalculator)
              window.updateSAILPanel = function() {
                try {
                  if (!window.SAILCalculator) return; // Script not loaded yet
                  const category = (document.getElementById('operationCategory')?.value || 'SORA-2.5');
                  const soraVersion = category === 'SORA-2.0' ? '2.0' : '2.5';

                  // Drone parameters (prefer selected drone model)
                  let mass = (window.currentDroneDetails && typeof currentDroneDetails.mTOM_kg === 'number') ? currentDroneDetails.mTOM_kg : undefined;
                  let maxDimension = (window.currentDroneDetails && typeof currentDroneDetails.characteristicDimension_m === 'number') ? currentDroneDetails.characteristicDimension_m : undefined;
                  let maxSpeed = (window.currentDroneDetails && typeof currentDroneDetails.maxSpeed_mps === 'number') ? currentDroneDetails.maxSpeed_mps : undefined;

                  // Manual overrides (when provided)
                  const mdMan = parseFloat(document.getElementById('maxDimensionManual')?.value || '');
                  const spMan = parseFloat(document.getElementById('cruiseSpeedManual')?.value || '');
                  if (!isNaN(mdMan) && mdMan > 0) maxDimension = mdMan;
                  if (!isNaN(spMan) && spMan > 0) maxSpeed = spMan;

                  if (typeof maxDimension !== 'number' || maxDimension <= 0) maxDimension = parseFloat(document.getElementById('maxDimension')?.value || document.getElementById('maxDimension20')?.value || '0') || 0;
                  if (typeof maxSpeed !== 'number' || maxSpeed <= 0) maxSpeed = parseFloat(document.getElementById('maxSpeed')?.value || document.getElementById('maxSpeed20')?.value || '0') || 0;
                  if (typeof mass !== 'number') mass = parseFloat(document.getElementById('mtom20')?.value || '0') || 0;

                  const drone = { maxDimension, maxSpeed, mass };

                  // Operation parameters
                  const op = {
                    soraVersion,
                    // Air risk inputs
                    maxHeightAGL: parseFloat(document.getElementById('maxHeightAGL')?.value || '0') || 0,
                    maxHeightAMSL: parseFloat(document.getElementById('maxHeightAMSL')?.value || '0') || 0,
                    airspaceClass: document.getElementById('airspaceClass')?.value || 'G',
                    locationType: document.getElementById('locationType')?.value || 'NonAirport',
                    environment: document.getElementById('environment')?.value || 'Rural',
                    isModeS: document.getElementById('isModeS')?.checked || false,
                    isTMZ: document.getElementById('isTMZ')?.checked || false,
                    typicality: document.getElementById('typicality')?.value || 'Typical',
                    vlos: (document.getElementById('operationCategory')?.value || 'SORA-2.5') === 'SORA-2.0'
                  };

                  if (soraVersion === '2.0') {
                    // Map mitigation dropdowns to levels (JARUS SORA 2.0 AMC Annex F Table 3)
                    const m1 = parseInt(document.getElementById('m1_20')?.value || '0');
                    const m2 = parseInt(document.getElementById('m2_20')?.value || '0');
                    const m3 = parseInt(document.getElementById('m3_20')?.value || '1');
                    const numToLevel = (v, map) => map[v] || 'None';
                    op.M1_level = numToLevel(m1, { 0:'None', '-1':'Low', '-2':'Medium', '-4':'High' });
                    op.M2_level = numToLevel(m2, { 0:'None', '-1':'Medium', '-2':'High' }); // M2 has NO "Low"!
                    op.M3_level = numToLevel(m3, { '1':'None', '0':'Medium', '-1':'High' }); // None = +1 penalty
                  } else {
                    const m1a = parseInt(document.getElementById('m1a_25')?.value || '0');
                    const m1b = parseInt(document.getElementById('m1b_25')?.value || '0');
                    const m1c = parseInt(document.getElementById('m1c_25')?.value || '0');
                    const m2 = parseInt(document.getElementById('m2_25')?.value || '0');
                    const numToLevel = (v, map) => map[v] || 'None';
                    op.M1A_level = numToLevel(m1a, { 0:'None', '-1':'Low', '-2':'Medium' });
                    op.M1B_level = numToLevel(m1b, { 0:'None', '-1':'Medium', '-2':'High' });
                    op.M1C_level = numToLevel(m1c, { 0:'None', '-1':'Low' });
                    op.M2_level  = numToLevel(m2,  { 0:'None', '-1':'Medium', '-2':'High' });
                    op.sheltering = (m1c === -1);
                    // 2.5 ground params
                    op.populationDensity = (document.getElementById('populationDensity')?.value === 'controlled')
                      ? 0 : parseFloat(document.getElementById('populationDensity')?.value || '0') || 0;
                    op.isControlledGround = (document.getElementById('populationDensity')?.value === 'controlled');
                  }

                  // Calculate
                  const calc = soraVersion === '2.0'
                    ? window.SAILCalculator.calculateSAIL_v2_0(drone, op)
                    : window.SAILCalculator.calculateSAIL_v2_5(drone, op);

                  // Update UI
                  const set = (id, val, prefix='') => { const el = document.getElementById(id); if (el) el.textContent = val!=null? (prefix?prefix:'')+val : '-'; };
                  set('sail_iGRC', calc.iGRC);
                  set('sail_initialARC', calc.initialARC ? `ARC-${calc.initialARC.arc}` : '-');
                  set('sail_finalGRC', calc.finalGRC);
                  set('sail_residualARC', calc.residualARC ? `ARC-${calc.residualARC}` : '-');
                  set('sail_level', calc.SAIL || '-');

                  const stepsDiv = document.getElementById('sail_steps');
                  if (stepsDiv) {
                    stepsDiv.innerHTML = (calc.steps || []).map(s => `â€¢ ${s}`).join('\n');
                  }
                  const warnDiv = document.getElementById('sail_warnings');
                  if (warnDiv) {
                    warnDiv.innerHTML = (calc.warnings || []).map(w => `<span class="pill" style="margin:2px 6px 0 0;background:#fff3cd;border-color:#ffecb5;color:#775500;">${w}</span>`).join('');
                  }
                } catch (e) {
                  console.warn('[SAIL Live] Failed to update:', e);
                }
              }
              
              /**
               * Calculate iGRC (intrinsic Ground Risk Class) from SORA 2.0 or 2.5 Table 2
               * Based on: JARUS SORA 2.0 (JAR_doc_06) or SORA 2.5 Main Body (JAR_doc_25), Table 2
               */
              function calculateiGRC() {
                // Check SORA version
                const operationCategory = document.getElementById('operationCategory')?.value || 'SORA-2.5';
                const isSORA20 = operationCategory === 'SORA-2.0';
                
                // Get drone parameters
                let maxDim = parseFloat(document.getElementById('maxDimension')?.value || document.getElementById('maxDimension20')?.value || '');
                let maxSpeed = parseFloat(document.getElementById('maxSpeed')?.value || document.getElementById('maxSpeed20')?.value || '');
                
                if (isNaN(maxDim) || maxDim <= 0) {
                  maxDim = (currentDroneDetails && typeof currentDroneDetails.characteristicDimension_m === 'number')
                    ? currentDroneDetails.characteristicDimension_m : 0;
                }
                if (isNaN(maxSpeed) || maxSpeed <= 0) {
                  maxSpeed = (currentDroneDetails && typeof currentDroneDetails.maxSpeed_mps === 'number')
                    ? currentDroneDetails.maxSpeed_mps : 0;
                }
                
                // SORA 2.0 calculation (scenario-based)
                if (isSORA20) {
                  const scenario = document.getElementById('scenario20')?.value || 'VLOS_SparselyPopulated';
                  
                  // SORA 2.0 Table 2: 7 scenarios Ã— 4 dimensions
                  const scenarioMap = {
                    'ControlledGroundArea': 0,
                    'VLOS_SparselyPopulated': 1,
                    'BVLOS_SparselyPopulated': 2,
                    'VLOS_Populated': 3,
                    'BVLOS_Populated': 4,
                    'VLOS_Gathering': 5,
                    'BVLOS_Gathering': 6
                  };
                  
                  const iGRCTable_V20 = [
                    [1, 2, 3, 4],   // Controlled ground area (1m, 3m, 8m, >8m)
                    [2, 3, 4, 5],   // VLOS sparsely populated
                    [3, 4, 5, 6],   // BVLOS sparsely populated
                    [4, 5, 6, 8],   // VLOS populated
                    [5, 6, 8, 10],  // BVLOS populated
                    [7, 99, 99, 99], // VLOS gathering (only 1m)
                    [8, 99, 99, 99]  // BVLOS gathering (only 1m)
                  ];
                  
                  // Dimension category (SORA 2.0 has only 4 columns)
                  let dimIndex = 0;
                  if (maxDim <= 1) dimIndex = 0;
                  else if (maxDim <= 3) dimIndex = 1;
                  else if (maxDim <= 8) dimIndex = 2;
                  else dimIndex = 3; // >8m
                  
                  const scenarioIndex = scenarioMap[scenario] || 1;
                  const iGRC = iGRCTable_V20[scenarioIndex][dimIndex];
                  
                  console.log(`[iGRC SORA 2.0] Scenario: ${scenario}, Dimension: ${maxDim}m â†’ iGRC = ${iGRC}`);
                  return iGRC === 99 ? 10 : iGRC; // Out of scope
                }
                
                // SORA 2.5 calculation (population density based)
                const popDensity = document.getElementById('populationDensity')?.value || 'controlled';
                
                // SORA 2.5 Table 2 - iGRC Matrix
                // Columns: 1m/25m/s, 3m/35m/s, 8m/75m/s, 20m/120m/s, 40m/200m/s
                // Primary criterion: characteristic dimension (speed is secondary constraint)
                let columnIndex = 0;
                if (maxDim <= 1) columnIndex = 0;
                else if (maxDim <= 3) columnIndex = 1;
                else if (maxDim <= 8) columnIndex = 2;
                else if (maxDim <= 20) columnIndex = 3;
                else if (maxDim <= 40) columnIndex = 4;
                else {
                  console.warn('[iGRC] UA dimension exceeds SORA 2.5 Table 2 limits (>40m)');
                  return 10; // Out of scope
                }
                
                // Rows: population density bands
                const iGRCTable = {
                  // [controlled, <5, <50, <500, <5000, <50000, >50000]
                  0: [1, 2, 3, 4, 5, 6, 7], // 1m / 25 m/s
                  1: [1, 3, 4, 5, 6, 7, 8], // 3m / 35 m/s
                  2: [2, 4, 5, 6, 7, 8, 99], // 8m / 75 m/s (99 = out of scope)
                  3: [3, 5, 6, 7, 8, 9, 99], // 20m / 120 m/s
                  4: [3, 6, 7, 8, 9, 10, 99]  // 40m / 200 m/s
                };
                
                // Map dropdown values to row indices (updated to match new midpoint values)
                let rowIndex = 0;
                const popValue = parseFloat(popDensity);
                if (popDensity === 'controlled') rowIndex = 0;
                else if (popValue < 5) rowIndex = 1;      // value=4 â†’ <5 people/kmÂ²
                else if (popValue < 50) rowIndex = 2;     // value=25 â†’ <50 people/kmÂ²
                else if (popValue < 500) rowIndex = 3;    // value=250 â†’ <500 people/kmÂ²
                else if (popValue < 5000) rowIndex = 4;   // value=2500 â†’ <5,000 people/kmÂ²
                else if (popValue < 50000) rowIndex = 5;  // value=25000 â†’ <50,000 people/kmÂ²
                else rowIndex = 6;                        // value=50001 â†’ >50,000 people/kmÂ²
                
                const iGRC = iGRCTable[columnIndex][rowIndex];
                
                // Special rule: UA â‰¤ 250g AND â‰¤ 25 m/s = iGRC 1
                const mtom = (currentDroneDetails?.mTOM_kg ?? null) ?? parseFloat(document.getElementById('mtom20')?.value || '0');
                if (mtom <= 0.25 && maxSpeed <= 25) {
                  console.log('[iGRC] Special rule: â‰¤250g & â‰¤25m/s â†’ iGRC = 1');
                  return 1;
                }
                
                console.log(`[iGRC SORA 2.5] Column: ${columnIndex}, Row: ${rowIndex}, iGRC: ${iGRC}`);
                return iGRC;
              }
              
              /**
               * Update iGRC display when drone or population density changes
               */
              function updateiGRC() {
                const iGRC = calculateiGRC();
                const display = document.getElementById('iGRCDisplay');
                if (display) {
                  if (iGRC === 99 || iGRC === 10) {
                    display.innerHTML = '<span style="color:#c00; font-weight:700;">OUT OF SCOPE (>8 or assemblies)</span>';
                  } else {
                    display.innerHTML = `<span style="color:#1976d2; font-weight:700; font-size:20px;">${iGRC}</span>`;
                  }
                }
                try { if (typeof updateSAILPanel === 'function') updateSAILPanel(); } catch {}
              }
              
              /**
               * Update ARC (Air Risk Class) display based on inputs
               * FULL 12-CATEGORY IMPLEMENTATION matching backend logic
               * Based on SORA Annex C Table 1 + comprehensive documentation
               */
              function updateARC() {
                const airspaceClass = document.getElementById('airspaceClass')?.value || 'G';
                const environment = document.getElementById('environment')?.value || 'Rural';
                const typicality = document.getElementById('typicality')?.value || 'Typical';
                const maxHeightAGL = parseFloat(document.getElementById('maxHeightAGL')?.value || '0');
                const maxHeightAMSL = parseFloat(document.getElementById('maxHeightAMSL')?.value || '0');
                const locationType = document.getElementById('locationType')?.value || 'NonAirport';
                const isModeS = document.getElementById('isModeS')?.checked || false;
                const isTMZ = document.getElementById('isTMZ')?.checked || false;
                const isInCtr = document.getElementById('isInCtr')?.checked || false;
                const isNearAerodrome = document.getElementById('isNearAerodrome')?.checked || false;
                const distanceKm = parseFloat(document.getElementById('distanceToAerodromeKm')?.value || '');
                
                let arc = 'b'; // Default
                let aec = 10;  // Default AEC
                let densityRating = 1;
                let explanation = '';
                
                // Step 1: Check FL600 (>18,000m AMSL)
                if (maxHeightAMSL > 18000) {
                  arc = 'b';
                  aec = 11;
                  densityRating = 1;
                  explanation = 'AEC 11: Above FL600 (>18,000m AMSL)';
                }
                // Step 2: Atypical/Segregated airspace
                else if (typicality === 'Atypical') {
                  arc = 'a';
                  aec = 12;
                  densityRating = 1;
                  explanation = 'AEC 12: Atypical/Segregated airspace';
                }
                // Step 2.5: CTR/TMA or Near Aerodrome proximity override (advisory)
                else if (isInCtr || (isNearAerodrome && !isNaN(distanceKm) && distanceKm <= 5)) {
                  const isControlled = (airspaceClass === 'A' || airspaceClass === 'B' || airspaceClass === 'C' || airspaceClass === 'D' || airspaceClass === 'E');
                  if (isModeS || isTMZ || isControlled) {
                    arc = 'd';
                    aec = 1;
                    densityRating = Math.max(densityRating, 5);
                    explanation = isInCtr ? 'AEC 1: CTR/TMA near airport (Controlled)' : 'AEC 1: â‰¤5km from aerodrome in controlled/Mode-S/TMZ airspace';
                  } else {
                    arc = 'c';
                    aec = 6;
                    densityRating = Math.max(densityRating, 3);
                    explanation = isInCtr ? 'AEC 6: CTR/TMA in advisory/uncontrolled' : 'AEC 6: â‰¤5km from aerodrome in E/F/G airspace';
                  }
                }
                // Step 3: Airport/Heliport
                else if (locationType === 'Airport') {
                  if (airspaceClass === 'B' || airspaceClass === 'C' || airspaceClass === 'D') {
                    arc = 'd';
                    aec = 1;
                    densityRating = 5;
                    explanation = 'AEC 1: Airport/Heliport Class B/C/D';
                  } else {
                    arc = 'c';
                    aec = 6;
                    densityRating = 3;
                    explanation = 'AEC 6: Airport/Heliport Class E/F/G';
                  }
                }
                // Step 4: Above 500ft (152m) AGL
                else if (maxHeightAGL > 152) {
                  if (isModeS || isTMZ) {
                    arc = 'd';
                    aec = 2;
                    densityRating = 5;
                    explanation = 'AEC 2: >500ft in Mode-S/TMZ zone';
                  } else if (airspaceClass === 'A' || airspaceClass === 'B' || airspaceClass === 'C' || 
                             airspaceClass === 'D' || airspaceClass === 'E') {
                    arc = 'd';
                    aec = 3;
                    densityRating = 5;
                    explanation = 'AEC 3: >500ft in Controlled airspace';
                  } else if (environment === 'Urban' || environment === 'Suburban') {
                    arc = 'c';
                    aec = 4;
                    densityRating = 3;
                    explanation = 'AEC 4: >500ft Uncontrolled Urban/Suburban';
                  } else {
                    arc = 'c';
                    aec = 5;
                    densityRating = 2;
                    explanation = 'AEC 5: >500ft Uncontrolled Rural';
                  }
                }
                // Step 5: Below 500ft (VLL - Very Low Level)
                else {
                  if (isModeS || isTMZ) {
                    arc = 'c';
                    aec = 7;
                    densityRating = 3;
                    explanation = 'AEC 7: <500ft in Mode-S/TMZ zone';
                  } else if (airspaceClass === 'A' || airspaceClass === 'B' || airspaceClass === 'C' || 
                             airspaceClass === 'D' || airspaceClass === 'E') {
                    arc = 'c';
                    aec = 8;
                    densityRating = 3;
                    explanation = 'AEC 8: <500ft in Controlled airspace';
                  } else if (environment === 'Urban' || environment === 'Suburban') {
                    arc = 'c';
                    aec = 9;
                    densityRating = 2;
                    explanation = 'AEC 9: <500ft Uncontrolled Urban/Suburban';
                  } else {
                    arc = 'b';
                    aec = 10;
                    densityRating = 1;
                    explanation = 'AEC 10: <500ft Uncontrolled Rural (Reference Environment)';
                  }
                }
                
                // Update display
                const arcDisplay = document.getElementById('arcDisplay');
                if (arcDisplay) {
                  arcDisplay.innerHTML = `
                    <div style="display:flex; align-items:center; gap:12px;">
                      <span style="color:#0d47a1; font-weight:700; font-size:20px;">ARC-${arc}</span>
                      <div style="font-size:11px; color:#666; line-height:1.4;">
                        <strong>AEC ${aec}</strong> | Density: ${densityRating}/5<br/>
                        ${explanation}
                      </div>
                    </div>
                  `;
                }
                
                console.log(`[ARC] AEC ${aec}, ARC-${arc}, Density ${densityRating}: ${explanation}`);
                try { if (typeof updateSAILPanel === 'function') updateSAILPanel(); } catch {}
              }

              /**
               * Update airspace class help text
               */
              function updateAirspaceHelp() {
                const airspaceClass = document.getElementById('airspaceClass')?.value || 'G';
                const helpDiv = document.getElementById('airspaceHelp');
                if (!helpDiv) return;
                
                const helpTexts = {
                  'G': 'Class G: Uncontrolled airspace, no ATC clearance required (lowest ARC)',
                  'F': 'Class F: Advisory service, mixed IFR/VFR operations',
                  'E': 'Class E: Controlled airspace, IFR/VFR separation (ARC-d if >500ft)',
                  'D': 'Class D: Controlled, IFR/VFR with ATC clearance (ARC-d if >500ft or at airport)',
                  'C': 'Class C: Controlled, all aircraft require clearance (ARC-d)',
                  'B': 'Class B: High-density controlled airspace (ARC-d)',
                  'A': 'Class A: IFR-only controlled airspace (ARC-d)'
                };
                
                helpDiv.textContent = helpTexts[airspaceClass] || 'Select airspace class';
              }


          // Move Drone Selection below Mission Type/Population Density
      (function reflowSections(){
        const anchor = document.getElementById('anchorAfterMission');
        const drone = document.getElementById('droneSelection');
        if (anchor && drone && drone.parentNode) {
          anchor.parentNode.insertBefore(drone, anchor.nextSibling);
        }
      })();

      // Update Population Density help text
      function updatePopulationDensityHelp() {
        const sel = document.getElementById('populationDensity');
        const help = document.getElementById('populationDensityHelp');
        if (!sel || !help) return;
        const v = sel.value || 'controlled';
        
        // **GREY CELL WARNING for assemblies > 50,000 people/kmÂ²**
        if (parseInt(v) > 50000) {
          help.innerHTML = '<div style="background:#ffc107;border-left:4px solid #ff9800;padding:12px;margin-top:8px;border-radius:6px;color:#000;">' +
            '<strong>âš ï¸ GREY CELL AREA - INCREASED SCRUTINY REQUIRED</strong><br>' +
            '<span style="font-size:12px;">Per JARUS Annex F Â§3.2: Assemblies exceeding 50,000 people/kmÂ² require additional risk mitigation measures. ' +
            'This operation falls in a "grey cell" zone requiring heightened regulatory review.</span><br>' +
            '<span style="font-size:11px;color:#d32f2f;font-weight:bold;">ğŸ“ Reference: JARUS SORA 2.5 Annex F, Paragraph 3.2 (Extremely dense assemblies)</span>' +
            '</div>';
          console.warn('[Grey Cell] Population density > 50,000/kmÂ² detected - increased scrutiny required');
        } else {
          const key = `help.populationDensity.${v}`;
          try {
            help.textContent = (window.i18n && window.i18n.t) ? window.i18n.t(key) : '';
          } catch { help.textContent = ''; }
        }
      }

      function updateEnvironmentHelp() {
        const sel = document.getElementById('environment');
        const help = document.getElementById('environmentHelp');
        if (!sel || !help) return;
        const v = sel.value.toLowerCase() || 'urban';
        const key = `help.environment.${v}`;
        try {
          help.textContent = (window.i18n && window.i18n.t) ? window.i18n.t(key) : '';
        } catch { help.textContent = ''; }
      }

      function updateAirspaceControlHelp() {
        const sel = document.getElementById('airspaceControl');
        const help = document.getElementById('airspaceControlHelp');
        if (!sel || !help) return;
        const v = sel.value.toLowerCase() || 'uncontrolled';
        const key = `help.airspaceControl.${v}`;
        try {
          help.textContent = (window.i18n && window.i18n.t) ? window.i18n.t(key) : '';
        } catch { help.textContent = ''; }
      }

      function updateLocationTypeHelp() {
        const sel = document.getElementById('locationType');
        const help = document.getElementById('locationTypeHelp');
        if (!sel || !help) return;
        const v = sel.value === 'Airport' ? 'airport' : 'nonAirport';
        const key = `help.locationType.${v}`;
        try {
          help.textContent = (window.i18n && window.i18n.t) ? window.i18n.t(key) : '';
        } catch { help.textContent = ''; }
      }

      // Improve ARC derivation and wire events
      (function setupARC(){
        const explicit = document.getElementById('explicitARC');
        if (explicit) explicit.addEventListener('change', updateARC);
        // Initialize aerodrome proximity UI
        try { updateAerodromeProximityUI(); } catch {}
        window.addEventListener('i18nReady', () => { 
          updateARC(); 
          updateiGRC();
          updatePopulationDensityHelp(); 
          updateEnvironmentHelp();
          updateAirspaceControlHelp();
          updateLocationTypeHelp();
          try { updateAerodromeProximityUI(); } catch {}
          try { if (typeof updateSAILPanel === 'function') updateSAILPanel(); } catch {}
        });
        window.addEventListener('languageChanged', () => { 
          updateARC(); 
          updateiGRC();
          updatePopulationDensityHelp(); 
          updateEnvironmentHelp();
          updateAirspaceControlHelp();
          updateLocationTypeHelp();
          try { updateAerodromeProximityUI(); } catch {}
          updateGuideLanguageWarning();
          try { if (typeof updateSAILPanel === 'function') updateSAILPanel(); } catch {}
        });
        
        // Function to show/hide guide language warning
        function updateGuideLanguageWarning() {
          const warning = document.getElementById('guideLanguageWarning');
          if (warning && window.i18n) {
            const currentLang = window.i18n.getCurrentLanguage();
            warning.style.display = (currentLang !== 'el') ? 'block' : 'none';
          }
        }
        
        // Initial call
        setTimeout(updateGuideLanguageWarning, 1500);
      })();

      function updateARC() {
        // Use explicit ARC if provided
        const explicit = document.getElementById('explicitARC')?.value || '';
        let arc = '';
        if (explicit) {
          arc = explicit.replace('ARC-','');
        } else {
          const airspaceControl = document.getElementById('airspaceControl')?.value || 'Uncontrolled';
          const locationType = document.getElementById('locationType')?.value || 'NonAirport';
          const environment = document.getElementById('environment')?.value || 'Rural';
          const typicality = document.getElementById('typicality')?.value || 'Typical';
          const isInCtr = document.getElementById('isInCtr')?.checked || false;
          const isNearAerodrome = document.getElementById('isNearAerodrome')?.checked || false;
          const distanceKm = parseFloat(document.getElementById('distanceToAerodromeKm')?.value || '');

          let score = 1; // b
          if (airspaceControl === 'Controlled') score += 1;
          if (locationType === 'Airport') score += 1;
          if (environment === 'Urban' || environment === 'Industrial') score += 1;
          if (environment === 'Remote' || environment === 'Forest' || environment === 'Mountain') score -= 1;
          if (typicality === 'Atypical') score += 1;
          if (isInCtr) score += 1;
          if (isNearAerodrome && !isNaN(distanceKm) && distanceKm <= 5) score += 1;
          if (score < 0) score = 0; if (score > 3) score = 3;
          arc = ['a','b','c','d'][score];
        }
        const arcDisplay = document.getElementById('arcDisplay');
        if (arcDisplay) {
          arcDisplay.innerHTML = `<span style="color:#0d47a1; font-weight:700; font-size:18px;">ARC-${arc || 'b'}</span>`;
        }
        try { if (typeof updateSAILPanel === 'function') updateSAILPanel(); } catch {}
      }

      // ============================================
      // QUICK TEST FUNCTIONS
      // ============================================
      
      /**
       * Run quick test from pasted JSON/Python
       */
      async function runQuickTest() {
        const input = document.getElementById('quickTestInput');
        const status = document.getElementById('quickTestStatus');
        const results = document.getElementById('quickTestResults');
        
        if (!input || !status || !results) return;
        
        // Clear previous results
        results.style.display = 'none';
        results.innerHTML = '';
        
        // Show loading status
        status.style.display = 'block';
        status.style.background = 'rgba(255,255,255,0.2)';
        status.style.color = 'white';
        status.innerHTML = 'â³ Running test...';
        
        try {
          let requestBody;
          const rawInput = input.value.trim();
          
          if (!rawInput) {
            throw new Error('Please paste a request body first');
          }
          
          // Try to parse as JSON
          try {
            // Handle Python dict format (convert to JSON)
            let jsonString = rawInput;
            
            // Python True/False/None â†’ JSON true/false/null
            jsonString = jsonString.replace(/:\s*True\b/g, ': true');
            jsonString = jsonString.replace(/:\s*False\b/g, ': false');
            jsonString = jsonString.replace(/:\s*None\b/g, ': null');
            
            // Python single quotes â†’ JSON double quotes
            jsonString = jsonString.replace(/'/g, '"');
            
            requestBody = JSON.parse(jsonString);
          } catch (parseError) {
            throw new Error(`Invalid JSON/Python format: ${parseError.message}`);
          }
          
          // Validate required fields
          if (!requestBody.SoraVersion) {
            throw new Error('Missing SoraVersion field');
          }
          if (!requestBody.DroneId) {
            throw new Error('Missing DroneId field');
          }
          if (!requestBody.GroundRisk) {
            throw new Error('Missing GroundRisk field');
          }
          if (!requestBody.AirRisk) {
            throw new Error('Missing AirRisk field');
          }
          
          // Make API call
          const baseUrl = window.location.origin;
          const apiUrl = `${baseUrl}/api/sora/complete`;
          
          console.log('ğŸš€ Quick Test Request:', requestBody);
          
          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestBody)
          });
          
          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`HTTP ${response.status}: ${errorText}`);
          }
          
          const result = await response.json();
          console.log('âœ… Quick Test Response:', result);
          
          // Update main UI with results
          updateUIWithQuickTestResults(result);
          
          // Show success status
          status.style.background = '#4caf50';
          status.innerHTML = 'âœ… Test completed successfully!';
          
          // Display detailed results
          displayQuickTestResults(result, requestBody);
          
          // Auto-hide status after 3 seconds
          setTimeout(() => {
            status.style.display = 'none';
          }, 3000);
          
        } catch (error) {
          console.error('âŒ Quick Test Error:', error);
          
          status.style.background = '#f44336';
          status.innerHTML = `âŒ Error: ${error.message}`;
        }
      }
      
      /**
       * Update main UI with test results
       */
      function updateUIWithQuickTestResults(result) {
        // Update Initial Assessment
        const iGRCDisplay = document.getElementById('iGRCDisplay');
        if (iGRCDisplay) {
          iGRCDisplay.textContent = result.intrinsicGRC || '-';
        }
        
        const initialARCDisplay = document.getElementById('initialARCDisplay');
        if (initialARCDisplay) {
          initialARCDisplay.textContent = result.initialARC || '-';
        }
        
        const initialSAILDisplay = document.getElementById('initialSAILDisplay');
        if (initialSAILDisplay) {
          initialSAILDisplay.textContent = 'N/A';
        }
        
        // Update Final Assessment
        const finalGRCDisplay = document.getElementById('finalGRCDisplay');
        if (finalGRCDisplay) {
          finalGRCDisplay.textContent = result.finalGRC || '-';
        }
        
        const residualARCDisplay = document.getElementById('residualARCDisplay');
        if (residualARCDisplay) {
          residualARCDisplay.textContent = result.residualARC || '-';
        }
        
        const finalSAILDisplay = document.getElementById('finalSAILDisplay');
        if (finalSAILDisplay) {
          finalSAILDisplay.textContent = result.sail || '-';
        }
        
        // Update JSON display
        const jsonDisplay = document.getElementById('json');
        if (jsonDisplay) {
          jsonDisplay.textContent = JSON.stringify(result, null, 2);
        }
      }
      
      /**
       * Display detailed results in Quick Test panel
       */
      function displayQuickTestResults(result, request) {
        const resultsDiv = document.getElementById('quickTestResults');
        if (!resultsDiv) return;
        
        const statusIcon = result.isSuccessful ? 'âœ…' : 'âŒ';
        const statusColor = result.isSuccessful ? '#4caf50' : '#f44336';
        const complianceIcon = result.isCompliant ? 'âœ…' : 'âš ï¸';
        const complianceColor = result.isCompliant ? '#4caf50' : '#ff9800';
        
        resultsDiv.style.display = 'block';
        resultsDiv.innerHTML = `
          <div style="background:rgba(255,255,255,0.95); padding:15px; border-radius:8px; color:#333;">
            <h4 style="margin:0 0 12px; color:#333; display:flex; align-items:center; gap:8px;">
              ${statusIcon} Test Results - ${request.DroneId}
            </h4>
            
            <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-bottom:12px;">
              <div style="background:#e3f2fd; padding:10px; border-radius:6px; border-left:4px solid #2196f3;">
                <div style="font-size:11px; color:#666; margin-bottom:4px;">SORA Version</div>
                <div style="font-weight:700; font-size:16px; color:#1976d2;">${result.soraVersion}</div>
              </div>
              
              <div style="background:${result.intrinsicGRC > 0 ? '#e8f5e9' : '#ffebee'}; padding:10px; border-radius:6px; border-left:4px solid ${result.intrinsicGRC > 0 ? '#4caf50' : '#f44336'};">
                <div style="font-size:11px; color:#666; margin-bottom:4px;">Intrinsic GRC</div>
                <div style="font-weight:700; font-size:16px; color:${result.intrinsicGRC > 0 ? '#2e7d32' : '#c62828'};">
                  ${result.intrinsicGRC}
                </div>
              </div>
              
              <div style="background:#e8f5e9; padding:10px; border-radius:6px; border-left:4px solid #4caf50;">
                <div style="font-size:11px; color:#666; margin-bottom:4px;">Final GRC</div>
                <div style="font-weight:700; font-size:16px; color:#2e7d32;">${result.finalGRC}</div>
              </div>
              
              <div style="background:#f3e5f5; padding:10px; border-radius:6px; border-left:4px solid #9c27b0;">
                <div style="font-size:11px; color:#666; margin-bottom:4px;">SAIL</div>
                <div style="font-weight:700; font-size:16px; color:#6a1b9a;">${result.sail || 'N/A'}</div>
              </div>
              
              <div style="background:#fff3e0; padding:10px; border-radius:6px; border-left:4px solid #ff9800;">
                <div style="font-size:11px; color:#666; margin-bottom:4px;">Initial ARC</div>
                <div style="font-weight:700; font-size:16px; color:#e65100;">${result.initialARC || 'N/A'}</div>
              </div>
              
              <div style="background:#fff3e0; padding:10px; border-radius:6px; border-left:4px solid #ff9800;">
                <div style="font-size:11px; color:#666; margin-bottom:4px;">Residual ARC</div>
                <div style="font-weight:700; font-size:16px; color:#e65100;">${result.residualARC || 'N/A'}</div>
              </div>
            </div>
            
            <div style="background:#fafafa; padding:10px; border-radius:6px; margin-bottom:10px;">
              <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
                <span style="font-size:12px; color:#666;">Required OSOs:</span>
                <strong style="color:#333;">${result.requiredOSOCount || 0}</strong>
              </div>
              <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
                <span style="font-size:12px; color:#666;">Implemented OSOs:</span>
                <strong style="color:#333;">${result.implementedOSOCount || 0}</strong>
              </div>
              <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
                <span style="font-size:12px; color:#666;">TMPR:</span>
                <strong style="color:#333;">${result.tmpr || 'N/A'}</strong>
              </div>
              <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
                <span style="font-size:12px; color:#666;">Risk Score:</span>
                <strong style="color:#333;">${result.riskScore || 'N/A'}</strong>
              </div>
              <div style="display:flex; justify-content:space-between;">
                <span style="font-size:12px; color:#666;">Risk Band:</span>
                <strong style="color:#333;">${result.riskBand || 'N/A'}</strong>
              </div>
            </div>
            
            <div style="background:${complianceColor}; color:white; padding:10px; border-radius:6px; text-align:center; font-weight:700;">
              ${complianceIcon} ${result.isCompliant ? 'COMPLIANT' : 'NOT COMPLIANT'}
            </div>
            
            ${result.errors && result.errors.length > 0 ? `
              <div style="background:#ffebee; border-left:4px solid #f44336; padding:10px; margin-top:10px; border-radius:4px;">
                <strong style="color:#c62828;">Errors:</strong>
                <ul style="margin:5px 0 0 20px; padding:0;">
                  ${result.errors.map(err => `<li style="color:#d32f2f; font-size:12px;">${err}</li>`).join('')}
                </ul>
              </div>
            ` : ''}
            
            ${result.warnings && result.warnings.length > 0 ? `
              <div style="background:#fff3e0; border-left:4px solid #ff9800; padding:10px; margin-top:10px; border-radius:4px;">
                <strong style="color:#e65100;">Warnings:</strong>
                <ul style="margin:5px 0 0 20px; padding:0;">
                  ${result.warnings.map(warn => `<li style="color:#ef6c00; font-size:12px;">${warn}</li>`).join('')}
                </ul>
              </div>
            ` : ''}
          </div>
        `;
      }
      
      /**
       * Load example test data
       */
      function loadExampleTest(version) {
        const input = document.getElementById('quickTestInput');
        if (!input) return;
        
        if (version === '2.0') {
          input.value = `{
  "SoraVersion": "2.0",
  "DroneId": "DJI_MINI4PRO",
  "GroundRisk": {
    "MTOM_kg": 0.249,
    "Scenario_V2_0": "VLOS_Populated",
    "Mitigations": [
      {"Type": "M1", "Robustness": "Medium"},
      {"Type": "M2", "Robustness": "High"}
    ]
  },
  "AirRisk": {
    "AirspaceType": "Uncontrolled",
    "AdjacentAirspace": false,
    "AtcServiceAvailable": false,
    "TechnicalMitigations": []
  }
}`;
        } else if (version === '2.5') {
          input.value = `{
  "SoraVersion": "2.5",
  "DroneId": "DJI_MAVIC3_ENTERPRISE",
  "GroundRisk": {
    "CharacteristicDimension_m": 0.45,
    "MaxSpeed_ms": 20,
    "PopulationDensity": 5000,
    "Mitigations": [
      {"Type": "M1A", "Robustness": "High"},
      {"Type": "M1B", "Robustness": "High"},
      {"Type": "M2", "Robustness": "Medium"}
    ]
  },
  "AirRisk": {
    "AirspaceType": "Controlled",
    "AdjacentAirspace": true,
    "AtcServiceAvailable": true,
    "TechnicalMitigations": ["TM1", "TM2"]
  }
}`;
        }
        
        // Auto-focus textarea
        input.focus();
      }
      
      /**
       * Clear quick test input and results
       */
      function clearQuickTest() {
        const input = document.getElementById('quickTestInput');
        const status = document.getElementById('quickTestStatus');
        const results = document.getElementById('quickTestResults');
        
        if (input) input.value = '';
        if (status) status.style.display = 'none';
        if (results) {
          results.style.display = 'none';
          results.innerHTML = '';
        }
      }

    </script>
  </body>
  </html>
