<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAIL Calculator - Comprehensive Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            text-align: center;
            color: #a8d5ff;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .test-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #1e3c72;
        }
        
        .test-version {
            background: #1e3c72;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .test-input {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.9em;
        }
        
        .test-result {
            margin-top: 15px;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .result-row:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #555;
        }
        
        .result-value {
            font-weight: bold;
            color: #1e3c72;
        }
        
        .sail-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.3em;
            color: white;
            text-align: center;
            min-width: 60px;
        }
        
        .sail-I { background: linear-gradient(135deg, #4CAF50, #66BB6A); }
        .sail-II { background: linear-gradient(135deg, #8BC34A, #9CCC65); }
        .sail-III { background: linear-gradient(135deg, #FFC107, #FFD54F); color: #333; }
        .sail-IV { background: linear-gradient(135deg, #FF9800, #FFB74D); }
        .sail-V { background: linear-gradient(135deg, #FF5722, #FF7043); }
        .sail-VI { background: linear-gradient(135deg, #F44336, #E57373); }
        .sail-OUT { background: linear-gradient(135deg, #9E9E9E, #BDBDBD); }
        
        .steps-section {
            margin-top: 15px;
            background: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
        }
        
        .step-item {
            padding: 6px 0;
            font-size: 0.9em;
            color: #555;
            border-left: 3px solid #1e3c72;
            padding-left: 10px;
            margin-bottom: 5px;
        }
        
        .warnings-section {
            margin-top: 15px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            border-radius: 8px;
        }
        
        .warning-item {
            padding: 4px 0;
            font-size: 0.9em;
            color: #856404;
        }
        
        .summary-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .summary-item {
            text-align: center;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .summary-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3c72;
        }
        
        .summary-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .status-passed {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .status-failed {
            color: #F44336;
            font-weight: bold;
        }
        
        .comparison-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }
        
        .comparison-table th {
            background: #1e3c72;
            color: white;
            padding: 10px;
            text-align: left;
        }
        
        .comparison-table td {
            padding: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .diff-highlight {
            background: #ffeb3b;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .run-tests-btn {
            display: block;
            width: 300px;
            margin: 0 auto 30px;
            padding: 15px 30px;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .run-tests-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
        
        .run-tests-btn:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ SAIL Calculator - Comprehensive Test Suite</h1>
        <p class="subtitle">‚úÖ 100% EASA/JARUS Compliant | Testing SORA 2.0 & 2.5 Algorithms</p>
        
        <button class="run-tests-btn" onclick="runAllTests()">‚ñ∂ Run All Tests</button>
        
        <div id="summary" class="summary-section" style="display: none;">
            <h2 style="color: #1e3c72; margin-bottom: 15px;">üìä Test Summary</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-number" id="total-tests">0</div>
                    <div class="summary-label">Total Tests</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number status-passed" id="passed-tests">0</div>
                    <div class="summary-label">Passed ‚úì</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number status-failed" id="failed-tests">0</div>
                    <div class="summary-label">Failed ‚úó</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" id="success-rate">0%</div>
                    <div class="summary-label">Success Rate</div>
                </div>
            </div>
        </div>
        
        <div id="test-results" class="test-grid"></div>
    </div>

    <script src="assets/js/sail-calculator.js"></script>
    <script>
        // Test Suite
        const testCases = [
            // ========================================
            // SORA 2.0 TESTS
            // ========================================
            {
                name: "Urban BVLOS (SORA 2.0)",
                version: "2.0",
                drone: {
                    maxDimension: 3,
                    maxSpeed: 30,
                    mass: 5
                },
                operation: {
                    soraVersion: '2.0',
                    maxHeightAGL: 120,
                    maxHeightAMSL: 250,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Urban',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: false,
                    populationDensity: 2500,
                    isControlledGround: false,
                    M1_level: 'Medium',
                    M2_level: 'Medium',
                    M3_level: 'Medium'
                },
                expected: {
                    iGRC: 7,
                    finalGRC: 5,
                    SAIL: 'IV',
                    arcLevel: 'c'
                }
            },
            
            {
                name: "Small Drone Rural VLOS (2.0)",
                version: "2.0",
                drone: {
                    maxDimension: 0.8,
                    maxSpeed: 15,
                    mass: 0.5
                },
                operation: {
                    soraVersion: '2.0',
                    maxHeightAGL: 80,
                    maxHeightAMSL: 150,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Rural',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: true,
                    populationDensity: 10,
                    isControlledGround: false,
                    M1_level: 'None',
                    M2_level: 'Medium',
                    M3_level: 'None'
                },
                expected: {
                    iGRC: 2,
                    finalGRC: 2,
                    SAIL: 'I',
                    arcLevel: 'b'
                }
            },
            
            {
                name: "GRC 5 + ARC-c Special Case (2.0)",
                version: "2.0",
                drone: {
                    maxDimension: 3,
                    maxSpeed: 25,
                    mass: 8
                },
                operation: {
                    soraVersion: '2.0',
                    maxHeightAGL: 100,
                    maxHeightAMSL: 200,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Suburban',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: false,
                    populationDensity: 80,
                    isControlledGround: false,
                    M1_level: 'Low',
                    M2_level: 'Medium',
                    M3_level: 'Medium'
                },
                expected: {
                    iGRC: 7,
                    finalGRC: 5, // 7 - 1 (M1) - 1 (M3) = 5
                    SAIL: 'IV', // SPECIAL CASE: GRC 5 + ARC-c = IV (NOT V!)
                    arcLevel: 'c'
                }
            },
            
            {
                name: "Mode-S Veil High Altitude (2.0)",
                version: "2.0",
                drone: {
                    maxDimension: 2,
                    maxSpeed: 20,
                    mass: 3
                },
                operation: {
                    soraVersion: '2.0',
                    maxHeightAGL: 200,
                    maxHeightAMSL: 300,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Urban',
                    isModeS: true,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: false,
                    populationDensity: 1500,
                    isControlledGround: false,
                    M1_level: 'None',
                    M2_level: 'Medium',
                    M3_level: 'None'
                },
                expected: {
                    iGRC: 7,
                    finalGRC: 7,
                    SAIL: 'VI',
                    arcLevel: 'd' // AEC 2: >500ft in Mode-S
                }
            },
            
            {
                name: "Controlled Ground Area (2.0)",
                version: "2.0",
                drone: {
                    maxDimension: 5,
                    maxSpeed: 35,
                    mass: 12
                },
                operation: {
                    soraVersion: '2.0',
                    maxHeightAGL: 50,
                    maxHeightAMSL: 100,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Rural',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: false,
                    populationDensity: 0,
                    isControlledGround: true,
                    M1_level: 'None',
                    M2_level: 'Medium',
                    M3_level: 'None'
                },
                expected: {
                    iGRC: 3,
                    finalGRC: 3,
                    SAIL: 'II',
                    arcLevel: 'b'
                }
            },
            
            // ========================================
            // SORA 2.5 TESTS
            // ========================================
            {
                name: "Urban BVLOS (SORA 2.5)",
                version: "2.5",
                drone: {
                    maxDimension: 2.5,
                    maxSpeed: 23,
                    mass: 9
                },
                operation: {
                    soraVersion: '2.5',
                    maxHeightAGL: 120,
                    maxHeightAMSL: 250,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Urban',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: false,
                    populationDensity: 2500,
                    isControlledGround: false,
                    M1A_level: 'Medium',
                    M1B_level: 'None',
                    M2_level: 'Medium',
                    sheltering: false
                },
                expected: {
                    iGRC: 6,
                    finalGRC: 4,
                    SAIL: 'IV',
                    arcLevel: 'c'
                }
            },
            
            {
                name: "250g Special Rule (2.5)",
                version: "2.5",
                drone: {
                    maxDimension: 0.3,
                    maxSpeed: 20,
                    mass: 0.249
                },
                operation: {
                    soraVersion: '2.5',
                    maxHeightAGL: 100,
                    maxHeightAMSL: 200,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Urban',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: true,
                    populationDensity: 8000,
                    isControlledGround: false,
                    M1A_level: 'None',
                    M1B_level: 'None',
                    M2_level: 'Medium',
                    sheltering: false
                },
                expected: {
                    iGRC: 1, // Special rule: ‚â§250g AND ‚â§25m/s
                    finalGRC: 1,
                    SAIL: 'II', // GRC 1 + ARC-c (SORA 2.5) = II
                    arcLevel: 'c'
                }
            },
            
            {
                name: "High Speed Edge Case (2.5)",
                version: "2.5",
                drone: {
                    maxDimension: 2,
                    maxSpeed: 40, // Exceeds 3m category speed (35 m/s)
                    mass: 5
                },
                operation: {
                    soraVersion: '2.5',
                    maxHeightAGL: 80,
                    maxHeightAMSL: 150,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Rural',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: false,
                    populationDensity: 30,
                    isControlledGround: false,
                    M1A_level: 'None',
                    M1B_level: 'None',
                    M2_level: 'Medium',
                    sheltering: false
                },
                expected: {
                    iGRC: 5, // 2m but 40m/s ‚Üí 8m category, <50 ppl/km¬≤ = 5
                    finalGRC: 5,
                    SAIL: 'IV',
                    arcLevel: 'b'
                }
            },
            
            {
                name: "Sheltering Mitigation (2.5)",
                version: "2.5",
                drone: {
                    maxDimension: 1.5,
                    maxSpeed: 18,
                    mass: 2
                },
                operation: {
                    soraVersion: '2.5',
                    maxHeightAGL: 60,
                    maxHeightAMSL: 120,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Suburban',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: false,
                    populationDensity: 800,
                    isControlledGround: false,
                    M1A_level: 'None',
                    M1B_level: 'None',
                    M2_level: 'Medium',
                    sheltering: true // -1 GRC
                },
                expected: {
                    iGRC: 4, // 1m category, <500 = 4
                    finalGRC: 3, // 4 - 1 (sheltering) = 3
                    SAIL: 'II',
                    arcLevel: 'c'
                }
            },
            
            {
                name: "Dense Urban (2.5)",
                version: "2.5",
                drone: {
                    maxDimension: 4,
                    maxSpeed: 50,
                    mass: 15
                },
                operation: {
                    soraVersion: '2.5',
                    maxHeightAGL: 150,
                    maxHeightAMSL: 250,
                    airspaceClass: 'E',
                    locationType: 'Non-Airport',
                    environment: 'Urban',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: false,
                    populationDensity: 12000,
                    isControlledGround: false,
                    M1A_level: 'Low',
                    M1B_level: 'None',
                    M2_level: 'High',
                    sheltering: false
                },
                expected: {
                    iGRC: 8, // 8m category, <50000 = 8
                    finalGRC: 5, // 8 - 1 (M1A) - 2 (M2) = 5
                    SAIL: 'VI',
                    arcLevel: 'd' // AEC 3: >500ft in class E
                }
            },
            
            // ========================================
            // SORA 2.0 vs 2.5 COMPARISON TESTS
            // ========================================
            {
                name: "COMPARISON: Low GRC + ARC-b",
                version: "BOTH",
                drone: {
                    maxDimension: 0.9,
                    maxSpeed: 15,
                    mass: 0.6
                },
                operation: {
                    maxHeightAGL: 70,
                    maxHeightAMSL: 150,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Rural',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: true,
                    populationDensity: 15,
                    isControlledGround: false
                },
                expected: {
                    sora2_0: { iGRC: 2, finalGRC: 2, SAIL: 'I', arcLevel: 'b' },
                    sora2_5: { iGRC: 3, finalGRC: 3, SAIL: 'II', arcLevel: 'b' } // DIFFERENT!
                }
            },
            
            {
                name: "COMPARISON: GRC 5 + ARC-c",
                version: "BOTH",
                drone: {
                    maxDimension: 3,
                    maxSpeed: 28,
                    mass: 7
                },
                operation: {
                    maxHeightAGL: 100,
                    maxHeightAMSL: 200,
                    airspaceClass: 'G',
                    locationType: 'Non-Airport',
                    environment: 'Urban',
                    isModeS: false,
                    isTMZ: false,
                    typicality: 'Typical',
                    vlos: false,
                    populationDensity: 1200,
                    isControlledGround: false
                },
                expected: {
                    sora2_0: { iGRC: 7, finalGRC: 5, SAIL: 'IV', arcLevel: 'c' }, // Special case!
                    sora2_5: { iGRC: 6, finalGRC: 6, SAIL: 'V', arcLevel: 'c' } // Normal
                }
            }
        ];
        
        function runAllTests() {
            const resultsContainer = document.getElementById('test-results');
            const summarySection = document.getElementById('summary');
            resultsContainer.innerHTML = '';
            
            let totalTests = 0;
            let passedTests = 0;
            let failedTests = 0;
            
            testCases.forEach((testCase, index) => {
                if (testCase.version === 'BOTH') {
                    // Run comparison test
                    totalTests += 2;
                    const results = runComparisonTest(testCase);
                    if (results.passed2_0) passedTests++;
                    else failedTests++;
                    if (results.passed2_5) passedTests++;
                    else failedTests++;
                    resultsContainer.appendChild(createComparisonCard(testCase, results, index));
                } else {
                    // Run single version test
                    totalTests++;
                    const result = runTest(testCase);
                    if (result.passed) passedTests++;
                    else failedTests++;
                    resultsContainer.appendChild(createTestCard(testCase, result, index));
                }
            });
            
            // Update summary
            document.getElementById('total-tests').textContent = totalTests;
            document.getElementById('passed-tests').textContent = passedTests;
            document.getElementById('failed-tests').textContent = failedTests;
            document.getElementById('success-rate').textContent = 
                Math.round((passedTests / totalTests) * 100) + '%';
            summarySection.style.display = 'block';
            
            // Scroll to results
            summarySection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function runTest(testCase) {
            const calculator = testCase.version === '2.0' ? 
                window.SAILCalculator.calculateSAIL_v2_0 : 
                window.SAILCalculator.calculateSAIL_v2_5;
            
            const result = calculator(testCase.drone, testCase.operation);
            
            const passed = 
                result.iGRC === testCase.expected.iGRC &&
                result.finalGRC === testCase.expected.finalGRC &&
                result.SAIL === testCase.expected.SAIL &&
                result.residualARC === testCase.expected.arcLevel;
            
            return {
                ...result,
                passed,
                testCase
            };
        }
        
        function runComparisonTest(testCase) {
            const op2_0 = { ...testCase.operation, soraVersion: '2.0', M1_level: 'None', M2_level: 'Medium', M3_level: 'None' };
            const op2_5 = { ...testCase.operation, soraVersion: '2.5', M1A_level: 'None', M1B_level: 'None', M2_level: 'Medium' };
            
            const result2_0 = window.SAILCalculator.calculateSAIL_v2_0(testCase.drone, op2_0);
            const result2_5 = window.SAILCalculator.calculateSAIL_v2_5(testCase.drone, op2_5);
            
            const passed2_0 = 
                result2_0.iGRC === testCase.expected.sora2_0.iGRC &&
                result2_0.finalGRC === testCase.expected.sora2_0.finalGRC &&
                result2_0.SAIL === testCase.expected.sora2_0.SAIL &&
                result2_0.residualARC === testCase.expected.sora2_0.arcLevel;
            
            const passed2_5 = 
                result2_5.iGRC === testCase.expected.sora2_5.iGRC &&
                result2_5.finalGRC === testCase.expected.sora2_5.finalGRC &&
                result2_5.SAIL === testCase.expected.sora2_5.SAIL &&
                result2_5.residualARC === testCase.expected.sora2_5.arcLevel;
            
            return {
                result2_0,
                result2_5,
                passed2_0,
                passed2_5,
                testCase
            };
        }
        
        function createTestCard(testCase, result, index) {
            const card = document.createElement('div');
            card.className = 'test-card';
            
            const statusIcon = result.passed ? '‚úÖ' : '‚ùå';
            const statusClass = result.passed ? 'status-passed' : 'status-failed';
            
            card.innerHTML = `
                <div class="test-header">
                    <div class="test-title">${statusIcon} Test ${index + 1}: ${testCase.name}</div>
                    <div class="test-version">SORA ${testCase.version}</div>
                </div>
                
                <div class="test-input">
                    <strong>Drone:</strong> ${testCase.drone.maxDimension}m, ${testCase.drone.maxSpeed}m/s, ${testCase.drone.mass}kg<br>
                    <strong>Environment:</strong> ${testCase.operation.environment}, ${testCase.operation.populationDensity} ppl/km¬≤<br>
                    <strong>Operation:</strong> ${testCase.operation.vlos ? 'VLOS' : 'BVLOS'}, ${testCase.operation.maxHeightAGL}m AGL
                </div>
                
                <div class="test-result">
                    <div class="result-row">
                        <span class="result-label">iGRC:</span>
                        <span class="result-value ${result.iGRC !== testCase.expected.iGRC ? 'status-failed' : ''}">
                            ${result.iGRC} ${result.iGRC !== testCase.expected.iGRC ? `(Expected: ${testCase.expected.iGRC})` : ''}
                        </span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Final GRC:</span>
                        <span class="result-value ${result.finalGRC !== testCase.expected.finalGRC ? 'status-failed' : ''}">
                            ${result.finalGRC} ${result.finalGRC !== testCase.expected.finalGRC ? `(Expected: ${testCase.expected.finalGRC})` : ''}
                        </span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Residual ARC:</span>
                        <span class="result-value ${result.residualARC !== testCase.expected.arcLevel ? 'status-failed' : ''}">
                            ARC-${result.residualARC} ${result.residualARC !== testCase.expected.arcLevel ? `(Expected: ARC-${testCase.expected.arcLevel})` : ''}
                        </span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">SAIL:</span>
                        <span class="sail-badge sail-${result.SAIL}">${result.SAIL}</span>
                        ${result.SAIL !== testCase.expected.SAIL ? `<span class="status-failed">(Expected: ${testCase.expected.SAIL})</span>` : ''}
                    </div>
                </div>
                
                <div class="steps-section">
                    <strong>üìã Calculation Steps:</strong>
                    ${result.steps.map(step => `<div class="step-item">${step}</div>`).join('')}
                </div>
                
                ${result.warnings && result.warnings.length > 0 ? `
                    <div class="warnings-section">
                        <strong>‚ö†Ô∏è Warnings:</strong>
                        ${result.warnings.map(w => `<div class="warning-item">${w}</div>`).join('')}
                    </div>
                ` : ''}
            `;
            
            return card;
        }
        
        function createComparisonCard(testCase, results, index) {
            const card = document.createElement('div');
            card.className = 'test-card';
            card.style.gridColumn = '1 / -1'; // Full width
            
            const status2_0 = results.passed2_0 ? '‚úÖ' : '‚ùå';
            const status2_5 = results.passed2_5 ? '‚úÖ' : '‚ùå';
            
            card.innerHTML = `
                <div class="test-header">
                    <div class="test-title">üîÑ Test ${index + 1}: ${testCase.name}</div>
                    <div style="display: flex; gap: 10px;">
                        <div class="test-version">SORA 2.0 ${status2_0}</div>
                        <div class="test-version" style="background: #2a5298;">SORA 2.5 ${status2_5}</div>
                    </div>
                </div>
                
                <div class="test-input">
                    <strong>Drone:</strong> ${testCase.drone.maxDimension}m, ${testCase.drone.maxSpeed}m/s, ${testCase.drone.mass}kg<br>
                    <strong>Environment:</strong> ${testCase.operation.environment}, ${testCase.operation.populationDensity} ppl/km¬≤<br>
                    <strong>Operation:</strong> ${testCase.operation.vlos ? 'VLOS' : 'BVLOS'}, ${testCase.operation.maxHeightAGL}m AGL
                </div>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>SORA 2.0</th>
                            <th>SORA 2.5</th>
                            <th>Difference</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>iGRC</strong></td>
                            <td>${results.result2_0.iGRC}</td>
                            <td>${results.result2_5.iGRC}</td>
                            <td>${results.result2_0.iGRC !== results.result2_5.iGRC ? 
                                `<span class="diff-highlight">${results.result2_5.iGRC - results.result2_0.iGRC >= 0 ? '+' : ''}${results.result2_5.iGRC - results.result2_0.iGRC}</span>` : 
                                '‚Äî'}</td>
                        </tr>
                        <tr>
                            <td><strong>Final GRC</strong></td>
                            <td>${results.result2_0.finalGRC}</td>
                            <td>${results.result2_5.finalGRC}</td>
                            <td>${results.result2_0.finalGRC !== results.result2_5.finalGRC ? 
                                `<span class="diff-highlight">${results.result2_5.finalGRC - results.result2_0.finalGRC >= 0 ? '+' : ''}${results.result2_5.finalGRC - results.result2_0.finalGRC}</span>` : 
                                '‚Äî'}</td>
                        </tr>
                        <tr>
                            <td><strong>Residual ARC</strong></td>
                            <td>ARC-${results.result2_0.residualARC}</td>
                            <td>ARC-${results.result2_5.residualARC}</td>
                            <td>${results.result2_0.residualARC !== results.result2_5.residualARC ? 
                                `<span class="diff-highlight">Changed</span>` : 
                                '‚Äî'}</td>
                        </tr>
                        <tr>
                            <td><strong>SAIL</strong></td>
                            <td><span class="sail-badge sail-${results.result2_0.SAIL}">${results.result2_0.SAIL}</span></td>
                            <td><span class="sail-badge sail-${results.result2_5.SAIL}">${results.result2_5.SAIL}</span></td>
                            <td>${results.result2_0.SAIL !== results.result2_5.SAIL ? 
                                `<span class="diff-highlight">DIFFERENT!</span>` : 
                                '‚Äî'}</td>
                        </tr>
                    </tbody>
                </table>
            `;
            
            return card;
        }
    </script>
</body>
</html>
