File,Section,Severity,Problem,Recommended Fix,Tests Impacted,Official Reference
arc_calculator.py,calculate_arc_2_0 → AEC 1 (Uncontrolled/Rural),CRITICAL,"Initial ARC set to ARC-a when is_atypical_segregated=True. That contradicts the rule that atypical/segregated affects only the ARC floor (residual), not the initial AEC-derived ARC.","Always set initial ARC to ARC-b for AEC 1 (uncontrolled/rural), regardless of is_atypical_segregated. Keep the floor rule in _apply_strategic_mitigations so residual can reach ARC-a only if atypical/segregated.",Update Test 7 expected_initial from ARC-a → ARC-b; keep expected_residual ARC-a.,"JARUS SORA v2.0, Step #4 (ARC determination & strategic mitigations). See EASA eRules UAS consolidation referencing JAR_doc_06 §2.3.2."
arc_calculator.py,calculate_arc_2_5 → Near Aerodrome logic,MAJOR,Missing mapping for near-aerodrome operations in UNCONTROLLED airspace. Only the controlled case (AEC 7) is implemented.,Add branch for near-aerodrome AND uncontrolled airspace → AEC 5 with initial ARC-b (subject to local aerodrome procedures).,Add new unit test: 2.5 + uncontrolled + near aerodrome + altitude <120 m → Initial ARC-b; AEC 5.,"JARUS SORA v2.5 Main Body, Annex B Table B-1 (AEC mapping). Draft v2.5 public consultation PDF (Feb 2024) and CAA(UK) 2019/947 guidance citing SORA 2.5 Annexes."
arc_calculator.py,calculate_arc_2_5 → Uncontrolled ≥120 m,MAJOR,Returns ARC-b with a free-text note 'consult authority' but no deterministic policy. This creates inconsistent downstream behaviour.,"Keep initial ARC-b but add a structured flag in the response (e.g., requires_authority_approval=True) and surface it in notes. This matches the EU 120 m ceiling policy.",Add unit test to assert flag is set when altitude_agl_m ≥120 in uncontrolled airspace.,EU Reg. 2019/947 (120 m ceiling) and CAA(UK) 2019/947 consolidation; SORA 2.5 relies on competent authority approval for exceptions.
arc_calculator.py,calculate_arc_2_5 → Environment handling,MINOR,Enum keeps SUBURBAN but logic treats 2.5 as Urban vs Rural only. SUBURBAN input would be undefined for 2.5 path.,Normalize SUBURBAN→URBAN at the start of 2.5 calculation (or validate/raise) to keep behaviour deterministic.,Add test: 2.5 + SUBURBAN coerces to URBAN and follows AEC 4/6/8 accordingly.,JARUS SORA v2.5 Annex B simplifications (environment buckets reduced compared to 2.0).
arc_calculator.py,_apply_strategic_mitigations (floor rule),MINOR,"Function allows any string as 'strategic_mitigations', risking accidental over-reduction.","Validate against recognized SM identifiers (e.g., {SM1, SM2, SM3, SM4}); ignore unknown tokens.",Add test: unknown SM token does not change ARC.,JARUS SORA v2.0 §2.3.2 and v2.5 Annex B commentary on strategic mitigations scope.
arc_calculator.py,calculate_arc_2_0 & calculate_arc_2_5 → Notes,MINOR,Notes string does not explicitly state the AEC number as a dedicated field (only embedded in text).,"Include a dedicated field in ARCResponse (e.g., aec_code: 'AEC 4') to support UI filtering and backend logic.",Adjust existing tests to assert aec_code equals the expected AEC.,Traceability best-practices; aligns with SORA requirement to document the applicable AEC for the operation dossier.
arc_calculator.py,ARCRequest_2_0 & ARCRequest_2_5 (derived flags),MINOR,Derived 'is_controlled' uses A–E as controlled (correct) but this should be documented in code comments for auditability.,Add inline comment referencing ICAO/EASA treatment of classes A–E as controlled in EU context.,None.,"EASA Airspace classes—A–E controlled, F/G uncontrolled (EU practice)."
arc_calculator.py,Unit tests → coverage gaps,MINOR,No tests for Mode-S/TMZ precedence over near-aerodrome in 2.5; no test for 2.5 uncontrolled ≥120 m branch.,Add tests: (a) 2.5 + Mode-S + near aerodrome → AEC 2 wins; (b) 2.5 + uncontrolled + 130 m → flag requires_authority_approval=True.,New tests only.,Priority ordering in AEC decision tree (Mode‑S/TMZ highest). JARUS SORA v2.0 §2.3.2; v2.5 Annex B wording.
